<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://example.com">
  <title>Hexo</title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="description" content="Flume概述Flume是一个进行海量流式（streaming）事件数据采集的分布式系统。Flume多用于对软件系统的日志文件数据的采集，目前成为Apache软件基金会的顶级项目之一。 Flume是的一个分布式、高可用、高可靠的海量日志采集、聚合和传输的系统，支持在日志系统中定制各类数据发送方，用于收集数据，同时提供了对数据进行简单处理并写到各种数据接收方的能力。 Flume的设计原理是基于数据流">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2024/06/04/flume/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Flume概述Flume是一个进行海量流式（streaming）事件数据采集的分布式系统。Flume多用于对软件系统的日志文件数据的采集，目前成为Apache软件基金会的顶级项目之一。 Flume是的一个分布式、高可用、高可靠的海量日志采集、聚合和传输的系统，支持在日志系统中定制各类数据发送方，用于收集数据，同时提供了对数据进行简单处理并写到各种数据接收方的能力。 Flume的设计原理是基于数据流">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200327112206283.png">
<meta property="og:image" content="http://example.com/2024/06/04/flume/md%E5%9B%BE/flume.assets/image-20230303092506796.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200323103129436.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/UserGuide_image00.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200323142300139.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200110174336210.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200323153910638.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200323154036797.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200110173530605.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200110174126132.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200110174514218.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230114090311228.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230114093012740.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200323164045854.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200324142535996.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200324151344310.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200324151408108.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5C%E6%9C%BA%E6%88%BF%E8%B7%A8%E7%BD%91%E6%AE%B5flume%E4%B8%AD%E8%BD%AC%E4%BC%A0%E8%BE%93%E7%BD%91%E7%BB%9C%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5C%E6%B5%81%E9%87%8F%E6%B1%87%E8%81%9A%E4%BC%A0%E8%BE%93%E7%BD%91%E7%BB%9C%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Capp%E4%B8%8A%E6%8A%A5%E6%97%A5%E5%BF%97%E5%8F%8Aflume%E9%87%87%E9%9B%86%E5%85%A8%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200113212610717.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200113212850218.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200113213451217.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200113220257571.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230121151610824.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE%5Cflume.assets%5Cclip_image002.jpg">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128000603210.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128000918130.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128001034328.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128003257255.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128003317149.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130103523537.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130103553408.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130111311611.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130164206781.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130164421179.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230131134112881.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130171701412.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200326103901392.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200326111609055.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130172232611.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130173816550.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200112212041558.png">
<meta property="og:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200112212150353.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130235444507.png">
<meta property="og:image" content="http://example.com/2024/06/04/flume/md%E5%9B%BE/flume.assets/image-20230201000514636.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230201005947135.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230201010005829.png">
<meta property="og:image" content="http://example.com/2024/06/04/flume/md%E5%9B%BE/flume.assets/image-20230201010138833.png">
<meta property="og:image" content="http://example.com/2024/06/04/flume/md%E5%9B%BE/flume.assets/image-20230201010312246.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230201010531192.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230201010622186.png">
<meta property="og:image" content="http://example.com/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230131000318670.png">
<meta property="article:published_time" content="2024-06-04T11:33:10.200Z">
<meta property="article:modified_time" content="2024-06-04T12:11:48.000Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/md%E5%9B%BE/flume.assets/image-20200327112206283.png">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.a5fda8.css">
  <style type="text/css">
    
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

  
    
 	  <script src="/lib/clickLove.js"></script>
  
  


  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      


<div class="overlay" style="background: #4d4d4d;"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/img/head.jpg" class="js-avatar">
		</a>
		<hgroup>
			<h1 class="header-author"><a href="/">John Doe</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/" target="_blank">主页</a></li>
			
				<li><a href="https://zhousiwei.gitee.io/ibooks/" target="_blank">技术笔记</a></li>
			
				<li><a href="/tags/%E9%9A%8F%E7%AC%94/" target="_blank">随笔</a></li>
			
			</ul>
		</nav>
		<nav class="header-smart-menu">
			
				
					<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
				
			
				
					<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
				
			
				
					<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
				
			
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					
						<a class="github" href="#" 
												title="GitHub" target="_blank"><i class="icon-github"></i></a>
					
				
					
						<a class="github" href="#" 
												title="GitHub" target="_blank"><i class="icon-github"></i></a>
					
				
					
						<a class="gitee" href="#" 
												title="gitee" target="_blank"><i class="icon-gitee"></i></a>
					
				
					
						<a class="jianshu" href="#" 
												title="jianshu" target="_blank"><i class="icon-jianshu"></i></a>
					
				
			</div>
		
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
      
      <a class="forkMe" style="position:absolute;z-index:999;top:0;right:0.5em;" 
        href="https://github.com/JoeyBling/hexo-theme-yilia-plus" target="_blank">
        <img src="/img/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
      
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<a href="/">
					<img src="/img/head.jpg" class="js-avatar">
				</a>
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">John Doe</h1>
			</hgroup>
			
			
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						
						<a class="github" target="_blank" 
							href="#" title="GitHub"><i class="icon-github"></i></a>
						
					
						
						<a class="github" target="_blank" 
							href="#" title="GitHub"><i class="icon-github"></i></a>
						
					
						
						<a class="gitee" target="_blank" 
							href="#" title="gitee"><i class="icon-gitee"></i></a>
						
					
						
						<a class="jianshu" target="_blank" 
							href="#" title="jianshu"><i class="icon-jianshu"></i></a>
						
					
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 33.333333333333336%"><a href="/">主页</a></li>
		        
					<li style="width: 33.333333333333336%"><a target="_blank" rel="noopener" href="https://zhousiwei.gitee.io/ibooks/">技术笔记</a></li>
		        
					<li style="width: 33.333333333333336%"><a href="/tags/%E9%9A%8F%E7%AC%94/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1"
              class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            <article id="post-flume" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
  <div class="article-entry" itemprop="articleBody">
    
    <h1 id="Flume概述"><a href="#Flume概述" class="headerlink" title="Flume概述"></a>Flume概述</h1><p>Flume是一个进行海量流式（streaming）事件数据采集的分布式系统。Flume多用于对软件系统的日志文件数据的采集，目前成为Apache软件基金会的顶级项目之一。</p>
<p>Flume是的一个<code>分布式、高可用、高可靠</code>的海量<code>日志采集</code>、<code>聚合</code>和<code>传输</code>的系统，支持在日志系统中定制各类数据发送方，用于收集数据，同时提供了对数据进行<code>简单处理</code>并<code>写到</code>各种<code>数据接收方</code>的能力。</p>
<p>Flume的设计原理是基于<code>数据流</code>的，能够将不同数据源的海量日志数据进行高效<code>收集、聚合、移动</code>，最后存储到一个<code>中心化数据存储系统</code>中。 Flume能够做到近似实时的推送，并且可以满足数据量是持续且量级很大的情况。比如它可以收集社交网站日志，并将这些数量庞大的日志数据从网站服务器上汇集起来，存储到HDFS或 HBase分布式数据库中。</p>
<blockquote>
<p>•Flume可以将应用产生的数据存储到任何集中存储器中，比如HDFS,HBase</p>
<p>•数据缓存。当收集数据的速度超过将写入数据的时候，保证其能够在两者之间提供平衡。</p>
<p>•Flume的管道是基于事务，保证了数据在传送和接收时的一致性.</p>
<p>•Flume是可靠的，容错性高的，可升级的，易管理的,并且可定制的</p>
</blockquote>
<p>Flume的应用场景:比如一个<code>电商网站</code>，想从网站访问者中访问一些<code>特定的节点区域</code>来<code>分析消费者</code>的<code>购物意图和行为</code>。为了实现这一点，需要收集到消费者访问的页面以及点击的产品等日志信息，并移交到大数据 Hadoop平台上去分析，可以利用 Flume做到这一点。现在流行的内容推送，比如广告定点投放以及新闻私人定制也是基于这个道理。</p>
<h1 id="Flume架构"><a href="#Flume架构" class="headerlink" title="Flume架构"></a>Flume架构</h1><p><img src="/md%E5%9B%BE/flume.assets/image-20200327112206283.png" alt="image-20200327112206283"></p>
<img src="./md图/flume.assets/image-20230303092506796.png" alt="image-20230303092506796" style="zoom:50%;" />

<p> Flume采集系统以<code>Agent</code>为单位，一个Agent就是一个工作进程。一个完整的Agent由三个组件构成，它们分别是：</p>
<p>(1)Source：用于从<code>数据源接收数据</code>（即采集数据），需要<code>设置数据的来源类型</code>；</p>
<p>(2)Sink：用于<code>传递数据给目的地</code>（即保存数据），需要<code>设置数据的目的地类型</code>；</p>
<p>(3)Channel：用于<code>Source和Sink的连接</code>，并缓存传输的数据，需要<code>设置缓存类型</code>。</p>
<h2 id="1-Event"><a href="#1-Event" class="headerlink" title="1.Event"></a>1.Event</h2><p>事件是Flume内部数据传输的最基本单元，将传输的数据进行<code>封装</code>。事件本身是由一个<code>载有数据的字节数组</code>和<code>可选的headers头部信息</code>构成，如下图所示。Flume以事件的形式将数据从源头传输到最终的目的地。</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200323103129436.png" alt="image-20200323103129436"></p>
<h2 id="2-Agent"><a href="#2-Agent" class="headerlink" title="2.Agent"></a>2.Agent</h2><p>Flume Agent 是一个<code>JVM进程</code>，通过三个组件（<code>source</code>、<code>channel</code>、<code>sink</code>）将<code>事件流</code>从一个<code>外部数据源</code>收集并发送给<code>下一个目的地</code>。</p>
<h3 id="（1）Source"><a href="#（1）Source" class="headerlink" title="（1）Source"></a>（1）Source</h3><p>从<code>数据发生器接收数据</code>，并将数据以Flume的Event格式传递给<code>一个或多个</code>通道（Channel）</p>
<p>支持Source:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-source">Avro Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#thrift-source">Thrift Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#exec-source">Exec Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#jms-source">JMS Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#spooling-directory-source">Spooling Directory Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#taildir-source">Taildir Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#twitter-1-firehose-source-experimental">Twitter 1% firehose Source (experimental)</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#kafka-source">Kafka Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#netcat-tcp-source">NetCat TCP Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#netcat-udp-source">NetCat UDP Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#sequence-generator-source">Sequence Generator Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#syslog-sources">Syslog Sources</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#http-source">HTTP Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#stress-source">Stress Source</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#legacy-sources">Legacy Sources</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#custom-source">Custom Source</a></li>
</ul>
<p>常用source类型：</p>
<table>
<thead>
<tr>
<th><strong>序号</strong></th>
<th><strong>类型名称</strong></th>
<th><strong>功   能</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>spooldir</strong></td>
<td>数据来源于磁盘文件目录</td>
</tr>
<tr>
<td>2</td>
<td><strong>exec</strong></td>
<td>表明数据来源于Linux命令</td>
</tr>
<tr>
<td>3</td>
<td><strong>taildir</strong></td>
<td>表明数据来源于文件的实时新增内容</td>
</tr>
<tr>
<td>4</td>
<td>avro</td>
<td>表明数据来源于指定IP和端口发送的AVRO消息</td>
</tr>
<tr>
<td>5</td>
<td>thrift</td>
<td>表明数据来源于指定IP和端口发送的THRIFT消息</td>
</tr>
<tr>
<td>6</td>
<td>netcat</td>
<td>表明数据来源于指定IP和端口发送的netcat  TCP消息</td>
</tr>
<tr>
<td>7</td>
<td>netcatudp</td>
<td>表明数据来源于指定IP和端口发送的netcat UDP消息</td>
</tr>
</tbody></table>
<h3 id="（2）Channel"><a href="#（2）Channel" class="headerlink" title="（2）Channel"></a>（2）Channel</h3><p>**一种<code>短暂的存储容器</code>**，位于<code> Source和Sink之间</code>，起着桥梁的作用。 Channel将从Source处接收到的 Event格式的数据<code>缓存</code>起来，当Sink<code>成功</code>地将<code> Events发送</code>到下一跳的Channel或最终<code>目的地</code>后， Events从 Channel<code>移除</code>。Channel是一个完整的<code>事务</code>，这一点保证了数据在收发的时候的一致性。可以把 Channel看成一个<code>FIFO（先进先出）队列</code>，<code>当数据的获取速率超过流出速率时，将Event保存到队列中，再从队中一个个出来</code>。</p>
<p>有以下几种Channel：</p>
<ul>
<li><strong>Memory Channel</strong> 事件存储在可配置容量的内存队列中，队列容量即为可存储最大事件数量，适用于高吞吐量场景，在agent出现错误时有可能会丢失部分数据</li>
<li><strong>File Channel</strong> 基于文件系统的持久化存储</li>
<li>Spillable Memory Channel 内存和文件混合Channel，当内存队列满了之后，新的事件会存储在文件系统，目前处于实验阶段，不建议在生产环境中使用</li>
<li>JDBC Channel 事件存储在持久化的数据库中，目前只支持Derby</li>
<li>Kafka Channel 事件存储在Kafka集群中</li>
<li>Pseudo Transaction Channel 伪事务Channel，仅用于测试，不能在生产环境使用</li>
<li>Custom Channel 自定义Channel</li>
</ul>
<p>常用channel类型</p>
<table>
<thead>
<tr>
<th><strong>序号</strong></th>
<th><strong>类型名称</strong></th>
<th><strong>功   能</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>memory</strong></td>
<td>以内存作为数据的缓存，读写速度快，但数据可能会丢失</td>
</tr>
<tr>
<td>2</td>
<td><strong>file</strong></td>
<td>以磁盘文件作为数据的缓存，读写速度相对慢，但数据不会丢失</td>
</tr>
</tbody></table>
<h3 id="（3）Sink"><a href="#（3）Sink" class="headerlink" title="（3）Sink"></a>（3）Sink</h3><p>获取Channel暂时保存的数据并进行处理。sink从channel中<code>移除事件</code>，并将其<code>发送到下一个agent</code>（简称下一跳）或者事件的<code>最终目的地</code>，比如HDFS。</p>
<p>Sink分类：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hdfs-sink">HDFS Sink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hive-sink">Hive Sink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#logger-sink">Logger Sink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-sink">Avro Sink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#thrift-sink">Thrift Sink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#irc-sink">IRC Sink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#file-roll-sink">File Roll Sink</a> 将Events保存在本地文件系统</li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#null-sink">Null Sink</a> 抛弃从Channel接收的所有事件</li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hbasesinks">HBaseSinks</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#morphlinesolrsink">MorphlineSolrSink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#elasticsearchsink">ElasticSearchSink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#kite-dataset-sink">Kite Dataset Sink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#kafka-sink">Kafka Sink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#http-sink">HTTP Sink</a></li>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#custom-sink">Custom Sink</a></li>
</ul>
<p>常用sink类型</p>
<table>
<thead>
<tr>
<th><strong>序号</strong></th>
<th><strong>类型名称</strong></th>
<th><strong>功能</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>hdfs</strong></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td><strong>file_roll</strong></td>
<td>表明数据的目的地是系统的本地目录</td>
</tr>
<tr>
<td>3</td>
<td><strong>KafkaSink</strong></td>
<td>表明数据的目的地是Kafka的生产者</td>
</tr>
<tr>
<td>4</td>
<td><strong>avro</strong></td>
<td>表明采用的是AVRO消息方式传递数据到数据目的地，需指定数据目的地的主机名和端口</td>
</tr>
<tr>
<td>5</td>
<td>hbase</td>
<td>表明数据的目的地是HBase</td>
</tr>
<tr>
<td>6</td>
<td>asynchbase</td>
<td>表明以异步方式写数据到HBase</td>
</tr>
<tr>
<td>7</td>
<td>hive</td>
<td>表明数据的目的地是Hive</td>
</tr>
<tr>
<td>8</td>
<td>elasticsearch</td>
<td>表明数据的目的地是elasticsearch</td>
</tr>
</tbody></table>
<h2 id="3-数据流模型"><a href="#3-数据流模型" class="headerlink" title="3.数据流模型"></a>3.数据流模型</h2><p><img src="/md%E5%9B%BE/flume.assets/UserGuide_image00.png" alt="Agent component diagram"></p>
<p>过程简要说明如下:<br>（1）外部数据源（Web Server）将Flume可识别的 Event发送到 Source<br>（2） Source收到 Event事件后存储到一个或多个Channel通道中。<br>（3）Channel保留 Event直到Sink将其处理完毕。<br>（4）Sink从 Channel中取出数据，并将其传输至外部存储（HDFS）。</p>
<h3 id="4-可靠性"><a href="#4-可靠性" class="headerlink" title="4.可靠性"></a>4.可靠性</h3><p>事件在每个agent的<code>channel中短暂存储</code>，然后事件被发送到下一个agent或者最终目的地。事件<code>只有</code>在存储在下一个channel或者最终存储后<code>才</code>从当前的channel中删除。</p>
<p>Flume使用<code>事务</code>的办法来保证Events的可靠传递。<code>Source和Sink分别被封装在事务中</code>，事务由保存Event的存储或者Channel提供。这就保证了Event在数据流的点对点传输中是可靠的。在多跳的数据流中，上一跳的sink和下一跳的source均运行事务来保证数据被安全地存储到下一跳的channel中。</p>
<h1 id="零、Flume安装"><a href="#零、Flume安装" class="headerlink" title="零、Flume安装"></a>零、Flume安装</h1><p>Flume下载页面：<a target="_blank" rel="noopener" href="http://flume.apache.org/download.html">http://flume.apache.org/download.html</a></p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200323142300139.png" alt="image-20200323142300139"></p>
<p>将<a target="_blank" rel="noopener" href="http://www.apache.org/dyn/closer.lua/flume/1.9.0/apache-flume-1.9.0-bin.tar.gz"> apache-flume-1.9.0-bin.tar.gz</a>下载到CentOS系统中，对其解压</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压命令</span></span><br><span class="line">tar xzf apache-flume-1.9.0-bin.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加软连接</span></span><br><span class="line">ln -s apache-flume-1.9.0-bin flume</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Flume使用需要依赖JDK1.8以上环境，确保已安装</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将Flume安装目录配置到PATH中，方便在任意目录使用</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加以下内容</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">FLUME_HOME</span></span><br><span class="line">export FLUME_HOME=/export/server/flume</span><br><span class="line">export PATH=$PATH:$FLUME_HOME/bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">保存成功后刷新</span></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看是否设置成功</span></span><br><span class="line">echo $FLUME_HOME</span><br></pre></td></tr></table></figure>

<h1 id="一、入门使用示例"><a href="#一、入门使用示例" class="headerlink" title="一、入门使用示例"></a>一、入门使用示例</h1><h2 id="案例说明"><a href="#案例说明" class="headerlink" title="案例说明"></a>案例说明</h2><p>使用Flume监听某个端口，使用Netcat向这个端口发送数据，Flume将接收到的数据打印到控制台。</p>
<p><code>Netcat是一款TCP/UDP测试工具</code>，可以通过以下命令安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nc</span><br></pre></td></tr></table></figure>

<h2 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h2><ul>
<li><p><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#netcat-tcp-source">NetCat TCP Source</a></p>
<p>必须属性</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>channels</strong></td>
<td align="left">–</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><strong>type</strong></td>
<td align="left">–</td>
<td align="left"><code>netcat</code></td>
</tr>
<tr>
<td align="left"><strong>bind</strong></td>
<td align="left">–</td>
<td align="left">绑定的主机名或者IP地址</td>
</tr>
<tr>
<td align="left"><strong>port</strong></td>
<td align="left">–</td>
<td align="left">绑定端口</td>
</tr>
</tbody></table>
</li>
<li><p><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#memory-channel">Memory Channel</a></p>
<p>必须属性</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>type</strong></td>
<td align="left">–</td>
<td align="left"><code>memory</code></td>
</tr>
</tbody></table>
</li>
<li><p><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#logger-sink">Logger Sink</a></p>
<p>必须属性</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>channel</strong></td>
<td align="left">–</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><strong>type</strong></td>
<td align="left">–</td>
<td align="left"><code>logger</code></td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h2><p>在flume&#x2F;myconf目录下添加配置文件netcat-logger.conf</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example1-netcat-logger.conf: 单节点Flume配置</span></span><br><span class="line"><span class="comment"># 定义agent名称为a1</span></span><br><span class="line"><span class="comment"># 设置3个组件的名称</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">netcat</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#source和channel关联</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">100</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置sink类型为Logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="comment"># 将sink绑定到channel上</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>

<h2 id="启动flume"><a href="#启动flume" class="headerlink" title="启动flume"></a>启动flume</h2><p>查看Flume使用命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flume-ng help</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Usage: /opt/soft/apache-flume-1.9.0-bin/bin/flume-ng &lt;command&gt; [options]...</span><br><span class="line"></span><br><span class="line">commands:</span><br><span class="line">  help                      display this help text</span><br><span class="line">  agent                     run a Flume agent</span><br><span class="line">  avro-client               run an avro Flume client</span><br><span class="line">  version                   show Flume version info</span><br><span class="line"></span><br><span class="line">global options:</span><br><span class="line">  --conf,-c &lt;conf&gt;          use configs in &lt;conf&gt; directory</span><br><span class="line">  --classpath,-C &lt;cp&gt;       append to the classpath</span><br><span class="line">  --dryrun,-d               do not actually start Flume, just print the command</span><br><span class="line">  --plugins-path &lt;dirs&gt;     colon-separated list of plugins.d directories. See the</span><br><span class="line">                            plugins.d section in the user guide for more details.</span><br><span class="line">                            Default: $FLUME_HOME/plugins.d</span><br><span class="line">  -Dproperty=value          sets a Java system property value</span><br><span class="line">  -Xproperty=value          sets a Java -X option</span><br><span class="line"></span><br><span class="line">agent options:</span><br><span class="line">  --name,-n &lt;name&gt;          the name of this agent (required)</span><br><span class="line">  --conf-file,-f &lt;file&gt;     specify a config file (required if -z missing)</span><br><span class="line">  --zkConnString,-z &lt;str&gt;   specify the ZooKeeper connection to use (required if -f missing)</span><br><span class="line">  --zkBasePath,-p &lt;path&gt;    specify the base path in ZooKeeper for agent configs</span><br><span class="line">  --no-reload-conf          do not reload config file if changed</span><br><span class="line">  --help,-h                 display help text</span><br><span class="line"></span><br><span class="line">avro-client options:</span><br><span class="line">  --rpcProps,-P &lt;file&gt;   RPC client properties file with server connection params</span><br><span class="line">  --host,-H &lt;host&gt;       hostname to which events will be sent</span><br><span class="line">  --port,-p &lt;port&gt;       port of the avro source</span><br><span class="line">  --dirname &lt;dir&gt;        directory to stream to avro source</span><br><span class="line">  --filename,-F &lt;file&gt;   text file to stream to avro source (default: std input)</span><br><span class="line">  --headerFile,-R &lt;file&gt; File containing event headers as key/value pairs on each new line</span><br><span class="line">  --help,-h              display help text</span><br><span class="line"></span><br><span class="line">  Either --rpcProps or both --host and --port must be specified.</span><br><span class="line"></span><br><span class="line">Note that if &lt;conf&gt; directory is specified, then it is always included first</span><br><span class="line">in the classpath.</span><br></pre></td></tr></table></figure>

<p>启动agent</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">`flume-ng agent -n a1 -c conf -f example.conf -Dflume.root.logger=INFO,console`</span><br><span class="line"></span><br><span class="line">[root@node1 flume]</span><br><span class="line">bin/flume-ng agent -n a1 -c conf -f myconf/example1-netcat-logger.conf -Dflume.root.logger=INFO,console</span><br><span class="line"></span><br><span class="line">在工作环境中的启动命令一般为：</span><br><span class="line">nohup bin/flume-ng agent -n a1 -c conf -f myconf/example1-netcat-logger.conf 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">用 /dev/null 2&gt;&amp;1 这条命令的意思是将标准输出和错误输出全部重定向到/dev/null中,也就是将产生的所有信息丢弃</span><br></pre></td></tr></table></figure>



<p><img src="/md%E5%9B%BE/flume.assets/image-20200110174336210.png" alt="image-20200110174336210"></p>
<h2 id="（1）使用Netcat测试"><a href="#（1）使用Netcat测试" class="headerlink" title="（1）使用Netcat测试"></a>（1）使用Netcat测试</h2><p>从另一个终端启动Netcat连接到44444端口，发送一些字符串</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc node1 44444</span><br></pre></td></tr></table></figure>

<p><img src="/md%E5%9B%BE/flume.assets/image-20200323153910638.png" alt="image-20200323153910638"></p>
<p>观察agent控制台</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200323154036797.png" alt="image-20200323154036797"></p>
<p>从这里可以看到事件由头部和字节数组组成。</p>
<p><code>如果开启了防火墙，需要添加防火墙规则</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=44444/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>



<h2 id="（2）使用telnet测试"><a href="#（2）使用telnet测试" class="headerlink" title="（2）使用telnet测试"></a>（2）使用telnet测试</h2><p>如果没有安装telnet，检查源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list | grep telnet</span><br></pre></td></tr></table></figure>

<p><img src="/md%E5%9B%BE/flume.assets/image-20200110173530605.png" alt="image-20200110173530605"></p>
<p>安装telnet</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y telnet.x86_64</span><br><span class="line">yum install -y telnet-server.x86_64</span><br></pre></td></tr></table></figure>

<p>启动telnet</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet node1 44444</span><br></pre></td></tr></table></figure>

<p>在控制台输入内容</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200110174126132.png" alt="image-20200110174126132"></p>
<p>可以在flume窗口查看到消息</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200110174514218.png" alt="image-20200110174514218"></p>
<h1 id="二、exec-source测试"><a href="#二、exec-source测试" class="headerlink" title="二、exec_source测试"></a>二、exec_source测试</h1><p>企业中应用程序部署后会将日志写入到文件中，可以使用Flume从各个日志文件将日志收集到日志中心以便于查找和分析。</p>
<h2 id="工作机制："><a href="#工作机制：" class="headerlink" title="工作机制："></a><strong>工作机制</strong>：</h2><p><code>启动一个用户所指定的linux shell命令</code>；<br>采集这个linux shell命令的<code>标准输出</code>，作为<code>收集到的数据</code>，<code>转为event写入channel</code>；</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230114090311228.png" alt="image-20230114090311228"></p>
<h2 id="参数详解："><a href="#参数详解：" class="headerlink" title="参数详解："></a><strong>参数详解：</strong></h2><table>
<thead>
<tr>
<th><strong>channels</strong></th>
<th>–</th>
<th>本source要发往的channel</th>
</tr>
</thead>
<tbody><tr>
<td><strong>type</strong></td>
<td>–</td>
<td>本source的类别名称：exec</td>
</tr>
<tr>
<td><strong>command</strong></td>
<td>–</td>
<td>本source所要运行的linux命令,比如： tail  -F &#x2F;path&#x2F;file</td>
</tr>
<tr>
<td>shell</td>
<td>–</td>
<td>指定运行上述命令所用shell</td>
</tr>
<tr>
<td>restartThrottle</td>
<td>10000</td>
<td>命令die了以后，重启的时间间隔</td>
</tr>
<tr>
<td>restart</td>
<td>false</td>
<td>命令die了以后，是否要重启</td>
</tr>
<tr>
<td>logStdErr</td>
<td>false</td>
<td>是否收集命令的错误输出stderr</td>
</tr>
<tr>
<td>batchSize</td>
<td>20</td>
<td>提交的event批次大小</td>
</tr>
<tr>
<td>batchTimeout</td>
<td>3000</td>
<td>发往下游没完成前，等待的时间</td>
</tr>
<tr>
<td>selector.type</td>
<td>replicating</td>
<td>指定channel选择器：replicating  or multiplexing</td>
</tr>
<tr>
<td>selector.*</td>
<td></td>
<td>选择器的具体参数</td>
</tr>
<tr>
<td>interceptors</td>
<td>–</td>
<td>指定拦截器</td>
</tr>
<tr>
<td>interceptors.*</td>
<td></td>
<td>指定的拦截器的具体参数</td>
</tr>
</tbody></table>
<h2 id="配置文件："><a href="#配置文件：" class="headerlink" title="配置文件："></a><strong>配置文件：</strong></h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example2-exec-source-logger.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">exec</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.command</span> = <span class="string">tail -F /export/data/flume-example-data/shell/access.log </span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>

<h2 id="启动测试："><a href="#启动测试：" class="headerlink" title="启动测试："></a><strong>启动测试：</strong></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.准备一个日志文件</span><br><span class="line">2.写一个脚本模拟往日志文件中持续写入数据</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10000&#125;; </span><br><span class="line"><span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$&#123;i&#125;</span> “bigdata <span class="built_in">log</span>”  &gt;&gt;  access.log ; </span><br><span class="line"><span class="built_in">sleep</span> 0.5; </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">3.创建一个flume自定义配置文件</span><br><span class="line">4.启动flume采集</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flume-ng agent -n a1 -c conf/ -f myconf/example2-exec-source-logger.conf -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>

<h1 id="三、spooldir-source测试"><a href="#三、spooldir-source测试" class="headerlink" title="三、spooldir_source测试"></a>三、spooldir_source测试</h1><h2 id="工作机制：-1"><a href="#工作机制：-1" class="headerlink" title="工作机制："></a><strong>工作机制：</strong></h2><p><code>监视一个指定的文件夹</code>，如果文件夹下<code>有没采集过的新文件</code>，则将这些<code>新文件中的数据采集</code>，并<code>转成event写入channel</code>；<br>注意：spooling目录中的文件<code>必须是不可变的</code>（数据是静态的），而且是<code>不能重名</code>的！否则，source会loudly fail！（<code>抛异常</code>）</p>
<h2 id="参数详解：-1"><a href="#参数详解：-1" class="headerlink" title="参数详解："></a><strong>参数详解：</strong></h2><table>
<thead>
<tr>
<th><strong>Property Name</strong></th>
<th><strong>Default</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>channels</strong></td>
<td>–</td>
<td></td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>–</td>
<td>The component type name, needs to be spooldir.</td>
</tr>
<tr>
<td><strong>spoolDir</strong></td>
<td>–</td>
<td>The directory from which to read files from.</td>
</tr>
<tr>
<td>fileSuffix</td>
<td>.COMPLETED</td>
<td>&#x3D;&#x3D;采集完成的文件，添加什么后缀名&#x3D;&#x3D;</td>
</tr>
<tr>
<td>deletePolicy</td>
<td>never</td>
<td>&#x3D;&#x3D;是否删除采完的文件: never or immediate&#x3D;&#x3D;</td>
</tr>
<tr>
<td>fileHeader</td>
<td>false</td>
<td>&#x3D;&#x3D;是否将所采集文件的绝对路径添加到header中&#x3D;&#x3D;</td>
</tr>
<tr>
<td>fileHeaderKey</td>
<td>file</td>
<td>&#x3D;&#x3D;上述header的key名称&#x3D;&#x3D;</td>
</tr>
<tr>
<td>basenameHeader</td>
<td>false</td>
<td>&#x3D;&#x3D;是否将文件名添加到header&#x3D;&#x3D;</td>
</tr>
<tr>
<td>basenameHeaderKey</td>
<td>basename</td>
<td>&#x3D;&#x3D;上述header的key名称&#x3D;&#x3D;</td>
</tr>
<tr>
<td>includePattern</td>
<td>^.*$</td>
<td>指定需要采集的文件名的正则表达式</td>
</tr>
<tr>
<td>ignorePattern</td>
<td>^$</td>
<td>指定要排除的文件名的正则表达式  如果一个文件名即符合includePattern又匹配ignorePattern，则该文件不采</td>
</tr>
<tr>
<td>trackerDir</td>
<td>.flumespool</td>
<td>记录元数据的目录所在路径，可以用绝对路径也可以用相对路径（相对于采集目录）</td>
</tr>
<tr>
<td>trackingPolicy</td>
<td>rename</td>
<td>采集进度跟踪策略，有两种：  “rename”和  “tracker_dir”. 本参数只在deletePolicy&#x3D;never时才生效   “rename”- 采完的文件根据filesuffix重命名   “tracker_dir” - 采完的文件会在trackerDir目录中生成一个同名的空文件</td>
</tr>
<tr>
<td>consumeOrder</td>
<td>oldest</td>
<td>采集顺序： oldest, youngest and random.   oldest和youngest情况下，可能会带来一定效率的损失；（需要对文件夹中所有文件进行一次扫描以寻找最old或最young的）</td>
</tr>
<tr>
<td>pollDelay</td>
<td>500</td>
<td>Delay (in milliseconds) used when polling for new  files.</td>
</tr>
<tr>
<td>recursiveDirectorySearch</td>
<td>false</td>
<td>Whether to monitor sub directories for new files to read.</td>
</tr>
<tr>
<td>maxBackoff</td>
<td>4000</td>
<td>The maximum time (in millis) to wait between  consecutive attempts to write to the channel(s) if the channel is full. The  source will start at a low backoff and increase it exponentially each time  the channel throws a ChannelException, upto the value specified by this  parameter.</td>
</tr>
<tr>
<td>batchSize</td>
<td>100</td>
<td>&#x3D;&#x3D;一次传输到channel的event条数（一批）&#x3D;&#x3D;</td>
</tr>
<tr>
<td>inputCharset</td>
<td>UTF-8</td>
<td>Character set used by deserializers that treat the  input file as text.</td>
</tr>
<tr>
<td>decodeErrorPolicy</td>
<td>FAIL</td>
<td>What to do when we see a non-decodable character in the  input file. FAIL: Throw an exception and fail to parse the  file. REPLACE: Replace the unparseable character with the  “replacement character” char, typically Unicode U+FFFD. IGNORE: Drop the unparseable character sequence.</td>
</tr>
<tr>
<td>deserializer</td>
<td>LINE</td>
<td>Specify the deserializer used to parse the file into  events. Defaults to parsing each line as an event. The class specified must  implementEventDeserializer.Builder.</td>
</tr>
<tr>
<td>deserializer.*</td>
<td></td>
<td>Varies per event deserializer.</td>
</tr>
<tr>
<td>bufferMaxLines</td>
<td>–</td>
<td>(Obselete) This option is now ignored.</td>
</tr>
<tr>
<td>bufferMaxLineLength</td>
<td>5000</td>
<td>(Deprecated) Maximum length of a line in the commit  buffer. Use deserializer.maxLineLength instead.</td>
</tr>
<tr>
<td>selector.type</td>
<td>replicating</td>
<td>replicating or multiplexing</td>
</tr>
<tr>
<td>selector.*</td>
<td></td>
<td>Depends on the selector.type value</td>
</tr>
<tr>
<td>interceptors</td>
<td>–</td>
<td>Space-separated list of interceptors</td>
</tr>
<tr>
<td>interceptors.*</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="配置文件：-1"><a href="#配置文件：-1" class="headerlink" title="配置文件："></a><strong>配置文件：</strong></h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example3-spooldir-source.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">spooldir</span></span><br><span class="line"><span class="attr">a1.sources.r1.spoolDir</span> = <span class="string">/export/data/flume-example-data/spooldir </span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>

<h2 id="启动测试：-1"><a href="#启动测试：-1" class="headerlink" title="启动测试："></a><strong>启动测试：</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flume-ng agent -n a1 -c conf -f myconf/example3-spooldir-source.conf -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>

<p>注意：spooldir source 与exec source不同，spooldir source本身是可靠的，会记录崩溃之前的采集位置。</p>
<h1 id="四、taildir-source测试"><a href="#四、taildir-source测试" class="headerlink" title="四、taildir_source测试"></a>四、taildir_source测试</h1><h2 id="工作机制：-2"><a href="#工作机制：-2" class="headerlink" title="工作机制："></a><strong>工作机制：</strong></h2><p><code>监视指定目录下的一批文件</code>，只要某个文件中<code>有新写入的行</code>，则会被<code>tail</code>到<br>它会<code>记录每一个文件所tail到的位置</code>，记录到一个指定的<code>positionfile</code>保存目录中，<code>格式为json</code>（如果需要的时候，可以人为修改，就可以让source从任意指定的位置开始读取数据）<br>所以，这个source真的像官网所吹的，是可靠的reliable！<br>它对采集完成的文件，不会做任何修改（比如重命名，删除…..）</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230114093012740.png" alt="image-20230114093012740"></p>
<p>taildir source会把读到的数据<code>成功写入channel后</code>，<code>再更新记录偏移量</code>，这种机制，能保证数据不会漏采（丢失），但是有<code>可能会产生数据重复</code>–&gt;<code>已经读取但是偏移量还没更新</code>。</p>
<h2 id="参数详解：-2"><a href="#参数详解：-2" class="headerlink" title="参数详解："></a><strong>参数详解：</strong></h2><table>
<thead>
<tr>
<th><strong>Property Name</strong></th>
<th><strong>Default</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>channels</strong></td>
<td>–</td>
<td>所要写往的channel</td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>–</td>
<td>本source的别名： &#x3D;&#x3D;TAILDIR&#x3D;&#x3D;</td>
</tr>
<tr>
<td><strong>filegroups</strong></td>
<td>–</td>
<td>&#x3D;&#x3D;空格分割的组名，每一组代表着一批文件  g1 g2&#x3D;&#x3D;</td>
</tr>
<tr>
<td><strong>filegroups.<filegroupName></strong></td>
<td>–</td>
<td>&#x3D;&#x3D;每个文件组的绝路路径，文件名可用正则表达式&#x3D;&#x3D;</td>
</tr>
<tr>
<td>positionFile</td>
<td>&#x3D;&#x3D;~&#x2F;.flume&#x2F;taildir_position.json&#x3D;&#x3D;</td>
<td>&#x3D;&#x3D;记录偏移量位置的文件所在路径&#x3D;&#x3D;</td>
</tr>
<tr>
<td>headers.<filegroupName>.<headerKey></td>
<td>–</td>
<td>Header value which is  the set with header key. Multiple headers can be specified for one file  group.</td>
</tr>
<tr>
<td>byteOffsetHeader</td>
<td>false</td>
<td>Whether to add the byte  offset of a tailed line to a header called ‘byteoffset’.</td>
</tr>
<tr>
<td>skipToEnd</td>
<td>false</td>
<td>Whether to skip the  position to EOF in the case of files not written on the position file.</td>
</tr>
<tr>
<td>idleTimeout</td>
<td>120000</td>
<td>关闭非活动文件的时延。如果被关闭的这个文件又在某个时间有了新增行,会被此source检测到，并重新打开</td>
</tr>
<tr>
<td>writePosInterval</td>
<td>3000</td>
<td>3s 记录一次偏移量到positionfile</td>
</tr>
<tr>
<td>batchSize</td>
<td>100</td>
<td>提交event到channel的批次最大条数</td>
</tr>
<tr>
<td>maxBatchCount</td>
<td>Long.MAX_VALUE</td>
<td>控制在一个文件上连续读取的最大批次个数（如果某个文件正在被高速写入，那就应该让这个参数调为最大值，以让source可以集中精力专采这个文件）</td>
</tr>
<tr>
<td>backoffSleepIncrement</td>
<td>1000</td>
<td>The increment for time  delay before reattempting to poll for new data, when the last attempt did not  find any new data.</td>
</tr>
<tr>
<td>maxBackoffSleep</td>
<td>5000</td>
<td>The max time delay  between each reattempt to poll for new data, when the last attempt did not  find any new data.</td>
</tr>
<tr>
<td>cachePatternMatching</td>
<td>true</td>
<td>Listing directories and  applying the filename regex pattern may be time consuming for directories  containing thousands of files. Caching the list of matching files can improve  performance. The order in which files are consumed will also be cached.  Requires that the file system keeps track of modification times with at least  a 1-second granularity.</td>
</tr>
<tr>
<td>fileHeader</td>
<td>false</td>
<td>Whether to add a header  storing the absolute path filename.</td>
</tr>
<tr>
<td>fileHeaderKey</td>
<td>file</td>
<td>Header key to use when  appending absolute path filename to event header.</td>
</tr>
</tbody></table>
<h2 id="配置文件：-2"><a href="#配置文件：-2" class="headerlink" title="配置文件："></a><strong>配置文件：</strong></h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example4-taildir-source.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">TAILDIR</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.positionFile</span> = <span class="string">/export/data/flume-example-data/flumedata/taildir_position.json</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups</span> = <span class="string">g1 g2</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups.g1</span> = <span class="string">/export/data/flume-example-data/weblog/web.*</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups.g2</span> = <span class="string">/export/data/flume-example-data/wxlog/wx.*</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.fileHeader</span> = <span class="string">true</span></span><br><span class="line"><span class="comment">#动态的header-keys eg：filepath=/../../../</span></span><br><span class="line"><span class="attr">a1.sources.r1.fileHeaderKey</span> = <span class="string">filepath</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#写死的header-keys（静态的） eg:a1 = aa1</span></span><br><span class="line"><span class="attr">a1.sources.r1.headers.g1.a1</span> = <span class="string">aa1</span></span><br><span class="line"><span class="attr">a1.sources.r1.headers.g1.b1</span> = <span class="string">bb1</span></span><br><span class="line"><span class="attr">a1.sources.r1.headers.g2.a2</span> = <span class="string">aa2</span></span><br><span class="line"><span class="attr">a1.sources.r1.headers.g2.b2</span> = <span class="string">bb2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.maxBatchCount</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">10000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成测试数据</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..1000&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;webweb111 <span class="variable">$RANDOM</span>&quot;</span> &gt;&gt; /export/data/flume-example-data/weblog/web-access.log</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;webweb222 <span class="variable">$RANDOM</span>&quot;</span> &gt;&gt; /export/data/flume-example-data/weblog/web-access.log.1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;wxwxwx333 <span class="variable">$RANDOM</span>&quot;</span> &gt;&gt; /export/data/flume-example-data/wxlog/wx-access.log</span><br><span class="line"><span class="built_in">sleep</span> 0.1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="启动测试：-2"><a href="#启动测试：-2" class="headerlink" title="启动测试："></a><strong>启动测试：</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flume-ng agent -n a1 -c conf/ -f  myconf/example4-taildir-source.conf -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>

<p>经过人为破坏测试，发现， this source还是真正挺reliable的，不会丢失数据，但在极端情况下可能会产生重复数据。</p>
<p>查看位置文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;inode&quot;</span><span class="punctuation">:</span><span class="number">2111303</span><span class="punctuation">,</span><span class="attr">&quot;pos&quot;</span><span class="punctuation">:</span><span class="number">2866</span><span class="punctuation">,</span><span class="attr">&quot;file&quot;</span><span class="punctuation">:</span><span class="string">&quot;/export/data/flume-example-data/weblog/web-access.log.1&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;inode&quot;</span><span class="punctuation">:</span><span class="number">2114106</span><span class="punctuation">,</span><span class="attr">&quot;pos&quot;</span><span class="punctuation">:</span><span class="number">56122</span><span class="punctuation">,</span><span class="attr">&quot;file&quot;</span><span class="punctuation">:</span><span class="string">&quot;/export/data/flume-example-data/weblog/web-access.log&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;inode&quot;</span><span class="punctuation">:</span><span class="number">54224093</span><span class="punctuation">,</span><span class="attr">&quot;pos&quot;</span><span class="punctuation">:</span><span class="number">52553</span><span class="punctuation">,</span><span class="attr">&quot;file&quot;</span><span class="punctuation">:</span><span class="string">&quot;/export/data/flume-example-data/wxlog/wx-access.log&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>



<h1 id="五、avro-source"><a href="#五、avro-source" class="headerlink" title="五、avro source"></a>五、avro source</h1><h2 id="基本介绍："><a href="#基本介绍：" class="headerlink" title="基本介绍："></a><strong>基本介绍：</strong></h2><p>Avro source 是通过<code>监听一个网络端口来接收数据</code>，而且接受的数据必须是使用<code>avro序列化框架</code>序列化后的数据（必须是：avro序列化流）；Avro是一种序列化框架，<code>跨语言的</code>；</p>
<blockquote>
<p>扩展：什么是序列化，什么是序列化框架？</p>
<p>序列化： <code>是将一个有复杂结构的数据块（对象）变成扁平的（线性的）二进制序列</code></p>
<p>序列化框架： 一套现成的软件，可以按照既定策略，将对象转成二进制序列</p>
<p>比如： jdk就有： ObjectOutputStream</p>
<p>​       	 hadoop就有： Writable</p>
<p>​    		跨平台的序列化框架： avro</p>
</blockquote>
<h2 id="工作机制：-3"><a href="#工作机制：-3" class="headerlink" title="工作机制："></a><strong>工作机制：</strong></h2><p><code>启动一个网络服务，监听一个端口，收集端口上收到的avro序列化数据流</code></p>
<p>该source中拥有avro的<code>反序列化器</code>，能够将收到的<code>二进制流进行正确反序列化</code>，并装入一个<code>event写入channel</code></p>
<h2 id="参数详解：-3"><a href="#参数详解：-3" class="headerlink" title="参数详解："></a><strong>参数详解：</strong></h2><table>
<thead>
<tr>
<th><strong>Property Name</strong></th>
<th><strong>Default</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>channels</strong></td>
<td>–</td>
<td></td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>–</td>
<td>本source的别名： &#x3D;&#x3D;avro&#x3D;&#x3D;</td>
</tr>
<tr>
<td><strong>bind</strong></td>
<td>–</td>
<td>&#x3D;&#x3D;要绑定的地址&#x3D;&#x3D;</td>
</tr>
<tr>
<td><strong>port</strong></td>
<td>–</td>
<td>&#x3D;&#x3D;要绑定的端口号&#x3D;&#x3D;</td>
</tr>
<tr>
<td><strong>threads</strong></td>
<td>–</td>
<td>&#x3D;&#x3D;<strong>服务的最大线程数（最好大于source所对接的上游发送者数量）</strong>&#x3D;&#x3D;</td>
</tr>
<tr>
<td>selector.type</td>
<td></td>
<td></td>
</tr>
<tr>
<td>selector.*</td>
<td></td>
<td></td>
</tr>
<tr>
<td>interceptors</td>
<td>–</td>
<td>Space-separated list of interceptors</td>
</tr>
<tr>
<td>interceptors.*</td>
<td></td>
<td></td>
</tr>
<tr>
<td>compression-type</td>
<td>none</td>
<td>压缩类型：跟发过来的数据是否压缩要匹配：none | deflate</td>
</tr>
<tr>
<td>ssl</td>
<td>false</td>
<td>Set this to true to enable SSL encryption. If SSL is enabled,  you must also specify a “keystore” and a “keystore-password”, either through  component level parameters (see below) or as global SSL parameters (see <a href="file:///D:/install-pkgs/apache-flume-1.9.0-bin/docs/FlumeUserGuide.html#ssl-tls-support">SSL&#x2F;TLS support</a> section).</td>
</tr>
<tr>
<td>keystore</td>
<td>–</td>
<td>This is the path to a Java keystore file. If not specified here,  then the global keystore will be used (if defined, otherwise configuration  error).</td>
</tr>
<tr>
<td>keystore-password</td>
<td>–</td>
<td>The password for the Java keystore. If not specified here, then  the global keystore password will be used (if defined, otherwise  configuration error).</td>
</tr>
<tr>
<td>keystore-type</td>
<td>JKS</td>
<td>The type of the Java keystore. This can be “JKS” or “PKCS12”. If  not specified here, then the global keystore type will be used (if defined,  otherwise the default is JKS).</td>
</tr>
<tr>
<td>exclude-protocols</td>
<td>SSLv3</td>
<td>Space-separated list of SSL&#x2F;TLS protocols to exclude. SSLv3 will  always be excluded in addition to the protocols specified.</td>
</tr>
<tr>
<td>include-protocols</td>
<td>–</td>
<td>Space-separated list of SSL&#x2F;TLS protocols to include. The  enabled protocols will be the included protocols without the excluded  protocols. If included-protocols is empty, it includes every supported  protocols.</td>
</tr>
<tr>
<td>exclude-cipher-suites</td>
<td>–</td>
<td>Space-separated list of cipher suites to exclude.</td>
</tr>
<tr>
<td>include-cipher-suites</td>
<td>–</td>
<td>Space-separated list of cipher suites to include. The enabled  cipher suites will be the included cipher suites without the excluded cipher  suites. If included-cipher-suites is empty, it includes every supported  cipher suites.</td>
</tr>
<tr>
<td>ipFilter</td>
<td>false</td>
<td>Set this to true to enable ipFiltering for netty</td>
</tr>
<tr>
<td>ipFilterRules</td>
<td>–</td>
<td>Define N netty ipFilter pattern rules with this config.</td>
</tr>
</tbody></table>
<h2 id="配置文件：-3"><a href="#配置文件：-3" class="headerlink" title="配置文件："></a><strong>配置文件：</strong></h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example5-avro-source.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">4141</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">200</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>

<h2 id="启动测试：-3"><a href="#启动测试：-3" class="headerlink" title="启动测试："></a><strong>启动测试：</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">启动agent：</span><br><span class="line"></span><br><span class="line">bin/flume-ng agent -c conf -f  myconf/example5-avro-source.conf -n a1 -Dflume.root.logger=INFO,console  </span><br><span class="line"></span><br><span class="line">新建`avro-log.txt`，用一个客户端去给启动好的source发送avro序列化数据：</span><br><span class="line"></span><br><span class="line">bin/flume-ng avro-client --host node1  --port 4141  -F /export/data/flume-example-data/avro-log.txt</span><br></pre></td></tr></table></figure>



<h1 id="六、使用File-Channel实现数据持久化"><a href="#六、使用File-Channel实现数据持久化" class="headerlink" title="六、使用File Channel实现数据持久化"></a>六、使用File Channel实现数据持久化</h1><p>使用组件</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#file-channel">File Channel</a></li>
</ul>
<p>属性设置</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>type</strong></td>
<td align="left">–</td>
<td align="left"><code>file</code></td>
</tr>
<tr>
<td align="left">checkpointDir</td>
<td align="left">&#x3D;&#x3D;~&#x2F;.flume&#x2F;file-channel&#x2F;checkpoint&#x3D;&#x3D;</td>
<td align="left">&#x3D;&#x3D;检查点文件存放路径&#x3D;&#x3D;</td>
</tr>
<tr>
<td align="left">dataDirs</td>
<td align="left">&#x3D;&#x3D;~&#x2F;.flume&#x2F;file-channel&#x2F;data&#x3D;&#x3D;</td>
<td align="left">&#x3D;&#x3D;日志存储路径，多个路径使用逗号分隔. 使用不同的磁盘上的多个路径能提高file channel的性能&#x3D;&#x3D;</td>
</tr>
</tbody></table>
<p>添加配置文件file-channel.conf，添加一个FileChannel</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example6-file-channel.conf</span></span><br><span class="line"><span class="comment"># 定义agent名称为a1</span></span><br><span class="line"><span class="comment"># 设置3个组件的名称</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="comment"># 多个channel使用空格分隔</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1 c2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">netcat</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置sink类型为Logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">100</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置FileChannel,checkpointDir为检查点文件存储目录，dataDirs为日志数据存储目录，</span></span><br><span class="line"><span class="attr">a1.channels.c2.type</span> = <span class="string">file</span></span><br><span class="line"><span class="attr">a1.channels.c2.checkpointDir</span> = <span class="string">/export/data/flume-example-data/flumedata/checkpoint_filechannel</span></span><br><span class="line"><span class="attr">a1.channels.c2.dataDirs</span> = <span class="string">/export/data/flume-example-data/flumedata/data_filechannel</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 将source和sink绑定到channel上</span></span><br><span class="line"><span class="comment"># source同时绑定到c1和c2上</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1 c2</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>

<p>为了方便日志打印，可以将<code>-Dflume.root.logger=INFO,console</code>添加在conf的环境配置中，从模板复制一份配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp flume-env.sh.template flume-env.sh</span><br><span class="line">vi flume-env.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加JAVA_OPTS</span></span><br><span class="line">export JAVA_OPTS=&quot;-Dflume.root.logger=INFO,console&quot;</span><br></pre></td></tr></table></figure>

<p>启动Flume</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flume-ng agent -n a1 -c conf -f myconf/example6-file-channel.conf -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>



<p>通过Netcat发送数据，此时发送到c2的数据没有被消费，关闭Flume，修改配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将sink绑定到c2上</span></span><br><span class="line">a1.sinks.k1.channel = c2</span><br></pre></td></tr></table></figure>

<p>重启Flume，可以看到会重新消费c2的数据</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200323164045854.png" alt="image-20200323164045854"></p>
<h1 id="七、利用avro-source和avro-sink实现agent级联"><a href="#七、利用avro-source和avro-sink实现agent级联" class="headerlink" title="七、利用avro source和avro sink实现agent级联"></a>七、利用avro source和avro sink实现agent级联</h1><h2 id="基本介绍：-1"><a href="#基本介绍：-1" class="headerlink" title="基本介绍："></a><strong>基本介绍：</strong></h2><p>级联的场景属于跨网络中转传输</p>
<h2 id="多个agent模型"><a href="#多个agent模型" class="headerlink" title="多个agent模型"></a>多个agent模型</h2><p>可以将多个Flume agent 程序<code>连接在一起</code>，其中一个<code>agent的sink</code>将数据发送到另一个<code>agent的source</code>。Avro文件格式是使用<code>Flume通过网络发送数据的标准方法</code>。</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200324142535996.png" alt="image-20200324142535996"></p>
<p>从<code>多个Web服务器</code>收集日志，发送到<code>一个或多个集中处理</code>的<code>agent</code>，之后<code>再发往日志存储中心</code>：</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200324151344310.png" alt="image-20200324151344310"></p>
<p><code>同样的日志发送到不同的目的地</code>：</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200324151408108.png" alt="image-20200324151408108"></p>
<h2 id="需求说明："><a href="#需求说明：" class="headerlink" title="需求说明："></a><strong>需求说明：</strong></h2><h3 id="（1）机房跨网段flume中转传输网络示意图："><a href="#（1）机房跨网段flume中转传输网络示意图：" class="headerlink" title="（1）机房跨网段flume中转传输网络示意图："></a>（1）机房跨网段flume中转传输网络示意图：</h3><p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5C%E6%9C%BA%E6%88%BF%E8%B7%A8%E7%BD%91%E6%AE%B5flume%E4%B8%AD%E8%BD%AC%E4%BC%A0%E8%BE%93%E7%BD%91%E7%BB%9C%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="机房跨网段flume中转传输网络示意图"></p>
<h3 id="（2）流量汇聚传输网络示意图："><a href="#（2）流量汇聚传输网络示意图：" class="headerlink" title="（2）流量汇聚传输网络示意图："></a>（2）流量汇聚传输网络示意图：</h3><p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5C%E6%B5%81%E9%87%8F%E6%B1%87%E8%81%9A%E4%BC%A0%E8%BE%93%E7%BD%91%E7%BB%9C%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="流量汇聚传输网络示意图"></p>
<p><code>小文件频繁写入hdfs，性能消耗巨大</code></p>
<h3 id="（3）app上报日志及flume采集全流程示意图"><a href="#（3）app上报日志及flume采集全流程示意图" class="headerlink" title="（3）app上报日志及flume采集全流程示意图"></a>（3）app上报日志及flume采集全流程示意图</h3><p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Capp%E4%B8%8A%E6%8A%A5%E6%97%A5%E5%BF%97%E5%8F%8Aflume%E9%87%87%E9%9B%86%E5%85%A8%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="app上报日志及flume采集全流程示意图"></p>
<h2 id="配置文件：-4"><a href="#配置文件：-4" class="headerlink" title="配置文件："></a><strong>配置文件：</strong></h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#上游服务器配置 example7-1-taildir-f-avro.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">TAILDIR</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.positionFile</span> = <span class="string">/export/data/flume-example-data/flumedata/taildir_position.json</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups</span> = <span class="string">g1 g2</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups.g1</span> = <span class="string">/export/data/flume-example-data/weblog/web.*</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups.g2</span> = <span class="string">/export/data/flume-example-data/wxlog/wx.*</span></span><br><span class="line"><span class="comment">#提高吞吐量</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="comment">#动态的header-keys eg：filepath=/../../../</span></span><br><span class="line"><span class="attr">a1.sources.r1.fileHeaderKey</span> = <span class="string">filepath</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#拦截器配置，添加header=timestamp</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors</span> = <span class="string">i1</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.type</span> = <span class="string">timestamp</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.headerName</span> = <span class="string">timestamp</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">file</span></span><br><span class="line"><span class="comment">#本机数据汇集检查点、event存储目录</span></span><br><span class="line"><span class="attr">a1.channels.c1.checkpointDir</span> = <span class="string">/export/data/flume-example-data/flumedata/checkpoint</span></span><br><span class="line"><span class="attr">a1.channels.c1.dataDirs</span> = <span class="string">/export/data/flume-example-data/flumedata/data</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">2000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sinks.k1.batch-size</span> = <span class="string">1000</span></span><br><span class="line"><span class="comment">#下游目标主机、端口</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hostname</span> = <span class="string">node3</span></span><br><span class="line"><span class="attr">a1.sinks.k1.port</span> = <span class="string">44444</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下游服务器配置 example7-2-avro-f-hdfs.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#下游数据汇集avro source</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sources.r1.threads</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">file</span></span><br><span class="line"><span class="attr">a1.channels.c1.checkpointDir</span> = <span class="string">/export/data/flume-example-data/flumedata/checkpoint</span></span><br><span class="line"><span class="attr">a1.channels.c1.dataDirs</span> = <span class="string">/export/data/flume-example-data/flumedata/data</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">2000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#hdfs sink</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.path</span> = <span class="string">hdfs://node1:8020/logdata/%Y-%m-%d/%H/</span></span><br><span class="line"><span class="comment">#eg：文件名 logdata_34438hxfd.log，在滚动时，logdata_34438hxfd.log.tmp</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.filePrefix</span> = <span class="string">logdata_</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileSuffix</span> = <span class="string">.log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#三个条件没有优先级，谁先达到就进行滚动</span></span><br><span class="line"><span class="comment">#按时间间隔滚动</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollInterval</span> = <span class="string">0</span></span><br><span class="line"><span class="comment">#按文件大小滚动 256MB</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollSize</span> = <span class="string">268435456</span></span><br><span class="line"><span class="comment">#按event条数滚动</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollCount</span> = <span class="string">100000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.codeC</span> = <span class="string">gzip</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileType</span> = <span class="string">CompressedStream</span></span><br></pre></td></tr></table></figure>

<h2 id="级联案例操作手册"><a href="#级联案例操作手册" class="headerlink" title="级联案例操作手册"></a>级联案例操作手册</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">级联案例操作手册</span><br><span class="line"></span><br><span class="line">-- 1. 启动hdfs，并检查工作状态</span><br><span class="line">-- 2. 把案例的上游配置文件，保存到node1,node2上</span><br><span class="line">-- 3. 把案例的下游配置文件，保存到node3上</span><br><span class="line"></span><br><span class="line">-- 4. 启动下游node3上的flume agent</span><br><span class="line">bin/flume-ng agent -n a1 -c conf/ -f myconf/example7-2-avro-f-hdfs.conf -Dflume.root.logger=DEBUG,console</span><br><span class="line"></span><br><span class="line">-- 5. （在node1和node2上）准备两个日志目录来生成模拟日志数据</span><br><span class="line">mkdir /export/data/flume-example-data/weblog/</span><br><span class="line">mkdir /export/data/flume-example-data/wxlog/</span><br><span class="line"></span><br><span class="line">-- 6.（在node1和node2上）利用shell脚本生成日志数据  </span><br><span class="line">vim avro-hdfs.sh</span><br><span class="line"></span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line">echo webwebwebwebweb &gt;&gt; /export/data/flume-example-data/weblog/web-access.log</span><br><span class="line">echo wxwxwxwxwxwxwx  &gt;&gt; /export/data/flume-example-data/wxlog/wx-access.log </span><br><span class="line">sleep 0.01</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">-- 7.启动node1和node2上的flume agent</span><br><span class="line">nohup bin/flume-ng agent -n a1 -c conf/ -f myconf/example7-1-taildir-f-avro.conf 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#复习提纲</span></span><br><span class="line">1.flume是什么？</span><br><span class="line">2.flume怎么工作的？</span><br><span class="line">3.flume的核心架构？</span><br><span class="line"></span><br><span class="line">4.flume中的一些核心概念理解：<span class="built_in">source</span>、channel、sink、channel selector、sink processor、interceptor、event、transaction</span><br><span class="line"></span><br><span class="line">5.flume中的事务控制是如何设计的</span><br><span class="line">6.flume怎么用？步骤是怎样的？</span><br><span class="line">7.flume在大数据系统中，处于哪个环节？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8.什么是业务系统？举例说明？</span><br><span class="line">9.大数据系统和业务系统是什么关系？</span><br><span class="line">10.什么是序列化？avro序列化跟serializable/writable/kryo有何不同？</span><br><span class="line">11.常见的<span class="built_in">source</span>有哪些？分别是怎么工作的？</span><br><span class="line">12.taildir <span class="built_in">source</span>为什么是可以用于生产环境的？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.分布式的，高可用的，数据采集传输系统</span><br><span class="line"></span><br><span class="line">2.有三大组件，<span class="built_in">source</span>负责读入数据，sink负责写出数据，channel在<span class="built_in">source</span>和sink之间做缓冲，做解耦</span><br><span class="line">  flume通过启动一个agent来工作</span><br><span class="line">  agent和agent之间可以级联，甚至组成复杂的拓扑结构</span><br><span class="line"></span><br><span class="line">3.<span class="built_in">source</span>、sink、channel</span><br><span class="line"></span><br><span class="line">4.<span class="built_in">source</span>：源组件</span><br><span class="line">  channel：通道，缓冲</span><br><span class="line">  sink：下沉组件，写出</span><br><span class="line">  channel selector：<span class="built_in">source</span>数据如何分发到所连接的多个channel</span><br><span class="line">  sink processor：协调一个sink组如何去channel中获取数据写出</span><br><span class="line">  interceptort：拦截器，工作在<span class="built_in">source</span>写数据到channel之前，可以对event进行加工处理</span><br><span class="line"></span><br><span class="line">5.flume有两个独立的事务控制</span><br><span class="line">  <span class="built_in">source</span>--》channel</span><br><span class="line">  channel--》sink</span><br><span class="line">  能实现最好的效果：at least once</span><br><span class="line">  一个事务的生命周期：start开启事务，commit提交事务，rollback回滚</span><br><span class="line">  上述步骤知识事务控制中的经典设计，每一个步骤做些什么，由相应组件的实现类来实现</span><br><span class="line"></span><br><span class="line">6.安装--》配置文件（选择组件）--》启动</span><br><span class="line"></span><br><span class="line">7.数据采集（汇聚）环节</span><br><span class="line">  数据感知层</span><br><span class="line"></span><br><span class="line">8.公司提供业务功能的软件系统</span><br><span class="line">  不同行业有不同的业务，那就需要不同的功能</span><br><span class="line">  比如：京东、淘宝等，属于电商行业，都需要一个系统为客户提供购物平台（web网页、app等）</span><br><span class="line">  头条、知乎、豆瓣...（内容媒体）</span><br><span class="line">  网上营业厅</span><br><span class="line">  </span><br><span class="line">9.业务系统往往是大数据系统的数据来源，大数据系统的处理结果，是对业务系统优化、设计的数据支撑</span><br><span class="line"></span><br><span class="line">12.可靠的---会记录数据源读取的偏移量</span><br></pre></td></tr></table></figure>



<h1 id="八、拦截器"><a href="#八、拦截器" class="headerlink" title="八、拦截器"></a>八、拦截器</h1><p>拦截器可以修改或者丢弃事件，Flume支持链式调用拦截器，拦截器定义在source中</p>
<h2 id="（1）Host-Interceptor"><a href="#（1）Host-Interceptor" class="headerlink" title="（1）Host Interceptor"></a>（1）Host Interceptor</h2><p>这个拦截器将运行agent的hostname 或者 IP地址写入到事件的headers中</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>type</strong></td>
<td align="left">–</td>
<td align="left"><code>host</code></td>
</tr>
<tr>
<td align="left">preserveExisting</td>
<td align="left">false</td>
<td align="left">如果header已经存在host, 是否要保留 - true保留原始的，false写入当前机器</td>
</tr>
<tr>
<td align="left">useIP</td>
<td align="left">true</td>
<td align="left">true为IP地址, false为 hostname.</td>
</tr>
<tr>
<td align="left">hostHeader</td>
<td align="left">host</td>
<td align="left">header中key的名称</td>
</tr>
</tbody></table>
<p>在myconf中添加example8-interceptor.conf</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example8-interceptor.conf</span></span><br><span class="line"><span class="comment"># 定义agent名称为a1</span></span><br><span class="line"><span class="comment"># 设置3个组件的名称</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">netcat</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="comment"># 配置拦截器为host</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors</span> = <span class="string">i1 </span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.type</span> = <span class="string">host</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置sink类型为Logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">100</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 将source和sink绑定到channel上</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>

<p>启动flume</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flume-ng agent -n a1 -c conf -f myconf/example8-interceptor.conf -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>

<h2 id="（2）Timestamp-Interceptor"><a href="#（2）Timestamp-Interceptor" class="headerlink" title="（2）Timestamp Interceptor"></a>（2）Timestamp Interceptor</h2><p>这个拦截器将当前时间写入到事件的headers中</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>type</strong></td>
<td align="left">–</td>
<td align="left"><code>timestamp</code></td>
</tr>
<tr>
<td align="left">headerName</td>
<td align="left">timestamp</td>
<td align="left">header中key的名称</td>
</tr>
<tr>
<td align="left">preserveExisting</td>
<td align="left">false</td>
<td align="left">If the timestamp already exists, should it be preserved - true or false</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a1.sources.r1.interceptors = i1 i2</span><br><span class="line">a1.sources.r1.interceptors.i1.type = host</span><br><span class="line">a1.sources.r1.interceptors.i2.type = timestamp</span><br></pre></td></tr></table></figure>

<p><img src="/md%E5%9B%BE/flume.assets/image-20200113212610717.png" alt="image-20200113212610717"></p>
<h2 id="（3）Static-Interceptor"><a href="#（3）Static-Interceptor" class="headerlink" title="（3）Static Interceptor"></a>（3）Static Interceptor</h2><p>运行用户对所有的事件添加固定的header</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>type</strong></td>
<td align="left">–</td>
<td align="left"><code>static</code></td>
</tr>
<tr>
<td align="left">preserveExisting</td>
<td align="left">true</td>
<td align="left">If configured header already exists, should it be preserved - true or false</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">key</td>
<td align="left">header 中key名称</td>
</tr>
<tr>
<td align="left">value</td>
<td align="left">value</td>
<td align="left">header 中value值</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a1.sources.r1.interceptors = i1 i2 i3</span><br><span class="line">a1.sources.r1.interceptors.i1.type = host</span><br><span class="line">a1.sources.r1.interceptors.i2.type = timestamp</span><br><span class="line">a1.sources.r1.interceptors.i3.type = static</span><br><span class="line">a1.sources.r1.interceptors.i3.key = datacenter</span><br><span class="line">a1.sources.r1.interceptors.i3.value = NEW_YORK</span><br></pre></td></tr></table></figure>

<p><img src="/md%E5%9B%BE/flume.assets/image-20200113212850218.png" alt="image-20200113212850218"></p>
<h2 id="（4）UUID-Interceptor"><a href="#（4）UUID-Interceptor" class="headerlink" title="（4）UUID Interceptor"></a>（4）UUID Interceptor</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a1.sources.r1.interceptors = i1 i2 i3 i4</span><br><span class="line">a1.sources.r1.interceptors.i1.type = host</span><br><span class="line">a1.sources.r1.interceptors.i2.type = timestamp</span><br><span class="line">a1.sources.r1.interceptors.i3.type = static</span><br><span class="line">a1.sources.r1.interceptors.i3.key = datacenter</span><br><span class="line">a1.sources.r1.interceptors.i3.value = NEW_YORK</span><br><span class="line">a1.sources.r1.interceptors.i4.type = org.apache.flume.sink.solr.morphline.UUIDInterceptor$Builder</span><br></pre></td></tr></table></figure>

<p><img src="/md%E5%9B%BE/flume.assets/image-20200113213451217.png" alt="image-20200113213451217"></p>
<h2 id="（5）Search-and-Replace-Interceptor"><a href="#（5）Search-and-Replace-Interceptor" class="headerlink" title="（5）Search and Replace Interceptor"></a>（5）Search and Replace Interceptor</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a1.sources.r1.interceptors = i1 i2 i3 i4 i5</span><br><span class="line">a1.sources.r1.interceptors.i1.type = host</span><br><span class="line">a1.sources.r1.interceptors.i2.type = timestamp</span><br><span class="line">a1.sources.r1.interceptors.i3.type = static</span><br><span class="line">a1.sources.r1.interceptors.i3.key = datacenter</span><br><span class="line">a1.sources.r1.interceptors.i3.value = NEW_YORK</span><br><span class="line">a1.sources.r1.interceptors.i4.type = org.apache.flume.sink.solr.morphline.UUIDInterceptor$Builder</span><br><span class="line">a1.sources.r1.interceptors.i5.type = search_replace</span><br><span class="line">a1.sources.r1.interceptors.i5.searchPattern = \\d&#123;6&#125;</span><br><span class="line">a1.sources.r1.interceptors.i5.replaceString = ******1234</span><br></pre></td></tr></table></figure>

<p><img src="/md%E5%9B%BE/flume.assets/image-20200113220257571.png" alt="image-20200113220257571"></p>
<h2 id="（6）自定义拦截器"><a href="#（6）自定义拦截器" class="headerlink" title="（6）自定义拦截器"></a>（6）自定义拦截器</h2><p>新建工程，添加pom引用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flume<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flume-ng-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加自定义拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.google.gson.reflect.TypeToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.Context;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.Event;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.interceptor.Interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventTimestampInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    String timeStampFiledName;</span><br><span class="line">    String toEncryFieldName;</span><br><span class="line">    String keyName;</span><br><span class="line">    Gson gson;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EventTimestampInterceptor</span><span class="params">(String timeStampFiledName,String toEncryFieldName,String keyName)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.timeStampFiledName = timeStampFiledName;</span><br><span class="line">        <span class="built_in">this</span>.toEncryFieldName = toEncryFieldName;</span><br><span class="line">        <span class="built_in">this</span>.keyName = keyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化工作所在的方法</span></span><br><span class="line"><span class="comment">     * 在拦截操作之前，会被调用一次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> &#123;</span><br><span class="line">        gson = <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截操作的具体逻辑所在方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Event <span class="title function_">intercept</span><span class="params">(Event event)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] body = event.getBody();</span><br><span class="line">        <span class="type">String</span> <span class="variable">lineJson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取时间戳，放入header</span></span><br><span class="line">        Map&lt;String,Object&gt; map = gson.fromJson(lineJson, <span class="keyword">new</span> <span class="title class_">TypeToken</span>&lt;HashMap&lt;String,Object&gt;&gt;()&#123;&#125;.getType());</span><br><span class="line">        <span class="type">Double</span> <span class="variable">ts</span> <span class="operator">=</span> (Double)map.get(timeStampFiledName);</span><br><span class="line">        event.getHeaders().put(keyName,ts.longValue()+<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将账号字段进行加密</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> (String) map.get(toEncryFieldName);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> DigestUtils.md5Hex(s);</span><br><span class="line">        map.put(toEncryFieldName,s1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将加密处理后的日志内容（map中），重新恢复成json，并set到event的body中</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">newJson</span> <span class="operator">=</span> gson.toJson(map);</span><br><span class="line">        event.setBody(newJson.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> event;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Event&gt; <span class="title function_">intercept</span><span class="params">(List&lt;Event&gt; list)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Event event : list) &#123;</span><br><span class="line">            intercept(event);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * agent关闭时，会调用该方法来做一些清理工作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EventTimestampInterceptorBuilder</span> <span class="keyword">implements</span> <span class="title class_">Builder</span>&#123;</span><br><span class="line"></span><br><span class="line">        String timeStampFiledName;</span><br><span class="line">        String toEncryFieldName;</span><br><span class="line">        String keyName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 构造拦截器实例对象的方法</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> Interceptor <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EventTimestampInterceptor</span>(timeStampFiledName,toEncryFieldName,keyName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 从配置文件中获取配置参数的方法</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">            timeStampFiledName = context.getString(<span class="string">&quot;tsFiledName&quot;</span>);</span><br><span class="line">            toEncryFieldName = context.getString(<span class="string">&quot;toEncryFieldName&quot;</span>);</span><br><span class="line">            keyName = context.getString(<span class="string">&quot;keyName&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将项目打成jar包后复制到Flume安装目录的lib目录中</p>
<p>修改上游服务器配置 taildir-f-avro.conf为taildir-f-avro-interceptor.conf</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#上游服务器配置example9-1-taildir-f-avro-interceptor.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">TAILDIR</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.positionFile</span> = <span class="string">/export/data/flume-example-data/flumedata/taildir_position.json</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups</span> = <span class="string">g1</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups.g1</span> = <span class="string">/export/data/flume-example-data/app/event.*</span></span><br><span class="line"><span class="comment">#提高吞吐量</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="comment">#动态的header-keys eg：filepath=/../../../</span></span><br><span class="line"><span class="attr">a1.sources.r1.fileHeaderKey</span> = <span class="string">filepath</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#拦截器配置,添加自定义拦截器</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors</span> = <span class="string">i1</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.type</span> = <span class="string">ccjz.rgzn.flume.EventTimestampInterceptor$EventTimestampInterceptorBuilder</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.tsFiledName</span> = <span class="string">timeStamp</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.keyName</span> = <span class="string">timestamp</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.toEncryFieldName</span> = <span class="string">account</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">file</span></span><br><span class="line"><span class="comment">#本机数据汇集检查点、event存储目录</span></span><br><span class="line"><span class="attr">a1.channels.c1.checkpointDir</span> = <span class="string">/export/data/flume-example-data/flumedata/checkpoint</span></span><br><span class="line"><span class="attr">a1.channels.c1.dataDirs</span> = <span class="string">/export/data/flume-example-data/flumedata/data</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">2000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sinks.k1.batch-size</span> = <span class="string">1000</span></span><br><span class="line"><span class="comment">#下游目标主机、端口</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hostname</span> = <span class="string">node3</span></span><br><span class="line"><span class="attr">a1.sinks.k1.port</span> = <span class="string">44444</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下游服务器配置 example9-2-avro-f-hdfs-interceptor.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#下游数据汇集avro source</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sources.r1.threads</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">file</span></span><br><span class="line"><span class="attr">a1.channels.c1.checkpointDir</span> = <span class="string">/export/data/flume-example-data/flumedata/checkpoint</span></span><br><span class="line"><span class="attr">a1.channels.c1.dataDirs</span> = <span class="string">/export/data/flume-example-data/flumedata/data</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">2000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#hdfs sink</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.path</span> = <span class="string">hdfs://node1:8020/logdata-interceptor/%Y-%m-%d/%H/</span></span><br><span class="line"><span class="comment">#eg：文件名 logdata_34438hxfd.log，在滚动时，logdata_34438hxfd.log.tmp</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.filePrefix</span> = <span class="string">logdata_</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileSuffix</span> = <span class="string">.log</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">#三个条件没有优先级，谁先达到就进行滚动</span></span><br><span class="line"><span class="comment">#按时间间隔滚动</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollInterval</span> = <span class="string">0</span></span><br><span class="line"><span class="comment">#按文件大小滚动 256MB</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollSize</span> = <span class="string">268435456</span></span><br><span class="line"><span class="comment">#按event条数滚动</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollCount</span> = <span class="string">100000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.codeC</span> = <span class="string">gzip</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileType</span> = <span class="string">CompressedStream</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">自定义拦截器-级联案例操作手册</span><br><span class="line"></span><br><span class="line">-- 1. 启动hdfs，并检查工作状态</span><br><span class="line">-- 2. 把案例的上游配置文件，保存到node1,node2上,并将自定义的拦截器jar包保存到node1和node2flume的lib中</span><br><span class="line">-- 3. 把案例的下游配置文件，保存到node3上</span><br><span class="line"></span><br><span class="line">-- 4. 启动下游node3上的flume agent</span><br><span class="line">bin/flume-ng agent -n a1 -c conf/ -f myconf/example9-2-avro-f-hdfs-interceptor.conf -Dflume.root.logger=DEBUG,console</span><br><span class="line"></span><br><span class="line">-- 5. （在node1和node2上）上传两个日志目录来生成模拟日志数据</span><br><span class="line">mkdir /export/data/flume-example-data/app/</span><br><span class="line">mkdir /export/data/flume-example-data/app/</span><br><span class="line"></span><br><span class="line">-- 6.（在node1和node2上）修改配置文件，加大flume启动内存(选做)</span><br><span class="line">mv flume-env.sh.template flume-env.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生产环境建议4G，测试环境以本机内存为参考</span></span><br><span class="line">export JAVA_OPTS=&quot;-Xms100m -Xmx2000m -Dcom.sun.management.jmxremote&quot;</span><br><span class="line"></span><br><span class="line">-- 7.启动node1和node2上的flume agent</span><br><span class="line">nohup bin/flume-ng agent -n a1 -c conf/ -f myconf/example9-1-taildir-f-avro-interceptor.conf 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">--8.去hdfs上查看是否采集到数据</span><br><span class="line">hadoop fs -text /logdata-interceptor/../../.. | tail</span><br></pre></td></tr></table></figure>

<h1 id="九、Flume常用组件详解：channel"><a href="#九、Flume常用组件详解：channel" class="headerlink" title="九、Flume常用组件详解：channel"></a>九、Flume常用组件详解：channel</h1><p>channel是agent中用来缓存event的repository（池，仓库）</p>
<p>source往channel中添加event</p>
<p>sink从channel中取并移除event</p>
<p>channel跟事务控制有极大关系；</p>
<p>channel 有容量大小、可靠性级别、事务容量等特性；</p>
<h2 id="（1）memory-channel"><a href="#（1）memory-channel" class="headerlink" title="（1）memory channel"></a>（1）memory channel</h2><h3 id="特性："><a href="#特性：" class="headerlink" title="特性："></a>特性：</h3><p>事件被存储在实现配置好容量的内存（队列）中。速度快，但可靠性较低，有可能会丢失数据</p>
<h3 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h3><table>
<thead>
<tr>
<th><strong>Property Name</strong></th>
<th><strong>Default</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>type</strong></td>
<td>–</td>
<td>别名： memory</td>
</tr>
<tr>
<td>capacity</td>
<td>100</td>
<td>能存储的最大事件event数</td>
</tr>
<tr>
<td>transactionCapacity</td>
<td>100</td>
<td>最大事务控制容量</td>
</tr>
<tr>
<td>keep-alive</td>
<td>3</td>
<td>添加或移除event的超时时间</td>
</tr>
<tr>
<td>byteCapacityBufferPercentage</td>
<td>20</td>
<td>除了body以外的字节所能占用的容量百分比</td>
</tr>
<tr>
<td>byteCapacity</td>
<td>see description</td>
<td>channel中最大的总byte数（只计算body）</td>
</tr>
</tbody></table>
<p>配置示例</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">10000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">10000</span></span><br><span class="line"><span class="attr">a1.channels.c1.byteCapacityBufferPercentage</span> = <span class="string">20</span></span><br><span class="line"><span class="attr">a1.channels.c1.byteCapacity</span> = <span class="string">800000</span></span><br></pre></td></tr></table></figure>

<p>MemoryChannel的逻辑相对简单，主要是通过MemoryTransaction中的putList、takeList与MemoryChannel中的queue打交道，这里的queue相当于持久化层，只不过放到了内存中，如果是FileChannel的话，会把这个queue放到本地文件中。下面表示了Event在一个使用了MemoryChannel的agent中数据流向：</p>
<p><strong>source —&gt; putList —&gt; queue —&gt; takeList —&gt; sink</strong></p>
<p>还需要注意的一点是，这里的事务可以嵌套使用，如下图：</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230121151610824.png" alt="image-20230121151610824"></p>
<p>当有两个agent级连时，sink的事务中包含了一个source的事务，这也应证了前面所说的：</p>
<p><strong>在任何时刻，Event至少在一个Channel中是完整有效的</strong></p>
<h2 id="（2）file-channel"><a href="#（2）file-channel" class="headerlink" title="（2）file channel"></a>（2）file channel</h2><h3 id="特性：-1"><a href="#特性：-1" class="headerlink" title="特性："></a>特性：</h3><p>event被缓存在本地磁盘文件中</p>
<p>可靠性高，不会丢失</p>
<p>但在极端情况下可能会重复数据</p>
<h3 id="参数：-1"><a href="#参数：-1" class="headerlink" title="参数："></a>参数：</h3><table>
<thead>
<tr>
<th><strong>Property Name   Default</strong></th>
<th>Default</th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>type</strong></td>
<td>–</td>
<td>别名： file.</td>
</tr>
<tr>
<td>checkpointDir</td>
<td>~&#x2F;.flume&#x2F;file-channel&#x2F;checkpoint</td>
<td>Checkpoint信息保存目录</td>
</tr>
<tr>
<td>useDualCheckpoints</td>
<td>false</td>
<td>Checkpoint是否双重checkpoint机制</td>
</tr>
<tr>
<td>backupCheckpointDir</td>
<td>–</td>
<td>备份checkpoint的保存目录</td>
</tr>
<tr>
<td>dataDirs</td>
<td>~&#x2F;.flume&#x2F;file-channel&#x2F;data</td>
<td>Event数据缓存目录</td>
</tr>
<tr>
<td>transactionCapacity</td>
<td>10000</td>
<td>事务管理容量</td>
</tr>
<tr>
<td>checkpointInterval</td>
<td>30000</td>
<td>记录checkpoint信息的时间间隔</td>
</tr>
<tr>
<td>maxFileSize</td>
<td>2146435071</td>
<td>控制一个数据文件的大小规格</td>
</tr>
<tr>
<td>minimumRequiredSpace</td>
<td>524288000</td>
<td>所需的最低磁盘空间，低于则停止接收新数据</td>
</tr>
<tr>
<td>capacity</td>
<td>1000000</td>
<td>最大event缓存数</td>
</tr>
<tr>
<td>keep-alive</td>
<td>3</td>
<td>等待添加数据的最大时间</td>
</tr>
</tbody></table>
<h3 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">TAILDIR</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.positionFile</span> = <span class="string">/root/taildir_chkp/taildir_position.json</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups</span> = <span class="string">f1</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups.f1</span> = <span class="string">/root/weblog/access.log</span></span><br><span class="line"><span class="attr">a1.sources.r1.fileHeader</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">a1.sources.ri.maxBatchCount</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">file</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">100</span></span><br><span class="line"><span class="attr">a1.channels.c1.checkpointDir</span> = <span class="string">/root/flume_chkp</span></span><br><span class="line"><span class="attr">a1.channels.c1.dataDirs</span> = <span class="string">/root/flume_data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c</span></span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>在使用taildir source 和  file channel的情况下，经过反复各种人为破坏，发现，没有数据丢失的现象发生；</p>
<p>但是，如果时间点掐的比较好(sink 取了一批数据写出，但还没来得及向channel提交事务)，会产生数据重复的现象！</p>
<h1 id="十、Flume常用组件详解：sink"><a href="#十、Flume常用组件详解：sink" class="headerlink" title="十、Flume常用组件详解：sink"></a>十、Flume常用组件详解：sink</h1><p>sink是从channel中获取、移除数据，并输出到下游（可能是下一级agent，也可能是最终目标存储系统）</p>
<h2 id="（1）hdfs-sink"><a href="#（1）hdfs-sink" class="headerlink" title="（1）hdfs sink"></a>（1）hdfs sink</h2><h3 id="特性：-2"><a href="#特性：-2" class="headerlink" title="特性："></a>特性：</h3><p>数据被最终发往hdfs</p>
<p>可以生成text文件或 sequence 文件，而且支持压缩；</p>
<p>支持生成文件的周期性roll机制：基于文件size，或者时间间隔，或者event数量；</p>
<p>目标路径，可以使用动态通配符替换，比如用%D代表当前日期；</p>
<p>当然，它也能从event的header中，取到一些标记来作为通配符替换；</p>
<p>header:{type&#x3D;acb}</p>
<p>&#x2F;weblog&#x2F;%{type}&#x2F;%D&#x2F; 就会被替换成： &#x2F;weblog&#x2F;abc&#x2F;19-06-09&#x2F;</p>
<h3 id="参数：-2"><a href="#参数：-2" class="headerlink" title="参数："></a>参数：</h3><table>
<thead>
<tr>
<th><strong>Name</strong></th>
<th><strong>Default</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>channel</strong></td>
<td>–</td>
<td>从哪个channel取数据</td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>–</td>
<td>别名： hdfs</td>
</tr>
<tr>
<td><strong>hdfs.path</strong></td>
<td>–</td>
<td>目标hdfs存储路径（URI）</td>
</tr>
<tr>
<td>hdfs.filePrefix</td>
<td>FlumeData</td>
<td>指定生成的文件名前缀</td>
</tr>
<tr>
<td>hdfs.fileSuffix</td>
<td>–</td>
<td>后缀</td>
</tr>
<tr>
<td>hdfs.inUsePrefix</td>
<td>–</td>
<td>正在写入的文件的前缀标识</td>
</tr>
<tr>
<td>hdfs.inUseSuffix</td>
<td>.tmp</td>
<td>正在写入的文件的后缀标识</td>
</tr>
<tr>
<td>hdfs.rollInterval</td>
<td>30</td>
<td>切换文件的条件：间隔时间；为0则不生效（秒）</td>
</tr>
<tr>
<td>hdfs.rollSize</td>
<td>134217728</td>
<td>切换文件的条件：文件大小；为0则不生效</td>
</tr>
<tr>
<td>hdfs.rollCount</td>
<td>10</td>
<td>切换文件的条件：event条数；为0则不生效</td>
</tr>
<tr>
<td>hdfs.idleTimeout</td>
<td>0</td>
<td>不活跃文件的关闭超时时长；0则不自动关闭</td>
</tr>
<tr>
<td>hdfs.batchSize</td>
<td>100</td>
<td>从channel中取一批数据的最大大小；</td>
</tr>
<tr>
<td>hdfs.codeC</td>
<td>–</td>
<td>压缩编码: gzip, bzip2, lzo,  lzop, snappy</td>
</tr>
<tr>
<td>hdfs.fileType</td>
<td>SequenceFile</td>
<td>目标文件格式: SequenceFile, DataStream or CompressedStream   注意：DataStream 不能支持压缩  CompressedStream 必须设置压缩编码  SequenceFile 可压缩可不压缩</td>
</tr>
<tr>
<td>hdfs.maxOpenFiles</td>
<td>5000</td>
<td>允许同时最多打开的文件数；如果超出，则会关闭最早打开的</td>
</tr>
<tr>
<td>hdfs.minBlockReplicas</td>
<td>–</td>
<td>目标文件的block副本数</td>
</tr>
<tr>
<td>hdfs.writeFormat</td>
<td>Writable</td>
<td>指定sequence file中的对象类型；支持Text和Writable  同时请使用Text，否则后续数据处理平台可能无法解析</td>
</tr>
<tr>
<td>hdfs.threadsPoolSize</td>
<td>10</td>
<td>操作HDFS时的线程池大小</td>
</tr>
<tr>
<td>hdfs.rollTimerPoolSize</td>
<td>1</td>
<td>检查文件是否需要被roll的线程数</td>
</tr>
<tr>
<td>hdfs.kerberosPrincipal</td>
<td>–</td>
<td>Kerberos user principal for accessing secure HDFS</td>
</tr>
<tr>
<td>hdfs.kerberosKeytab</td>
<td>–</td>
<td>Kerberos keytab for accessing secure HDFS</td>
</tr>
<tr>
<td>hdfs.proxyUser</td>
<td></td>
<td></td>
</tr>
<tr>
<td>hdfs.round</td>
<td>false</td>
<td>目录通配符切换是是否需要切掉尾数</td>
</tr>
<tr>
<td>hdfs.roundValue</td>
<td>10</td>
<td>时间尾数切掉多少</td>
</tr>
<tr>
<td>hdfs.roundUnit</td>
<td>minute</td>
<td>时间尾数切掉大小的单位- second, minute or hour.</td>
</tr>
<tr>
<td>hdfs.timeZone</td>
<td>Local Time</td>
<td>时间通配符所使用的时区</td>
</tr>
<tr>
<td>hdfs.useLocalTimeStamp</td>
<td>&#x3D;&#x3D;false&#x3D;&#x3D;</td>
<td>&#x3D;&#x3D;所用的时间是否要从agent sink本地获取&#x3D;&#x3D;</td>
</tr>
<tr>
<td>hdfs.closeTries</td>
<td>0</td>
<td>重命名已完成文件的重试次数；0则一直尝试重命名</td>
</tr>
<tr>
<td>hdfs.retryInterval</td>
<td>180</td>
<td>关闭一个文件的重试时间间隔</td>
</tr>
<tr>
<td>serializer</td>
<td>TEXT</td>
<td>将channel中的event body解析成什么格式：Text| avro_event ； 也可以使用自定义的序列化器</td>
</tr>
<tr>
<td>serializer.*</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>小  提  示：什么叫做URI</th>
<th><img src="/.%5Cmd%E5%9B%BE%5Cflume.assets%5Cclip_image002.jpg" alt="img"></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="配置示例："><a href="#配置示例：" class="headerlink" title="配置示例："></a>配置示例：</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 定义</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## source</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">exec</span></span><br><span class="line"><span class="attr">a1.sources.r1.command</span> = <span class="string">tail -F /root/logs/a.log</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors</span> = <span class="string">i1</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.type</span> = <span class="string">timestamp</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## channel</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">100000000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## sink</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.path</span> = <span class="string">hdfs://node1:8020/logdata/%&#123;b&#125;/%Y-%m-%d/%H-%M</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.round</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.roundValue</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.roundUnit</span> = <span class="string">minute</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.filePrefix</span> = <span class="string">doit_</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileSuffix</span> = <span class="string">.log.gz</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollInterval</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollSize</span> = <span class="string">102400</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollCount</span> = <span class="string">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileType</span> = <span class="string">CompressedStream</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.codeC</span> = <span class="string">gzip</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.writeFormat</span> = <span class="string">Text</span></span><br></pre></td></tr></table></figure>



<h3 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h3><ol>
<li>启动hdfs</li>
<li>清除以前的taildirsource产生的偏移量记录文件、filechannel缓存的数据目录和checkpoint目录</li>
<li>启动agent</li>
<li>用for循环脚本往日志文件中不断写入新的数据</li>
<li>到hdfs中观察结果</li>
</ol>
<h2 id="2-avro-sink"><a href="#2-avro-sink" class="headerlink" title="(2)avro sink"></a>(2)avro sink</h2><h3 id="特性：-3"><a href="#特性：-3" class="headerlink" title="特性："></a>特性：</h3><p>avro sink用来向avro source发送avro序列化数据，这样就可以实现agent之间的级联</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128000603210.png" alt="image-20230128000603210"></p>
<h3 id="参数：-3"><a href="#参数：-3" class="headerlink" title="参数："></a>参数：</h3><table>
<thead>
<tr>
<th><strong>Property Name</strong></th>
<th><strong>Default</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>channel</strong></td>
<td>–</td>
<td></td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>–</td>
<td>The component type name,  needs to be avro.</td>
</tr>
<tr>
<td><strong>hostname</strong></td>
<td>–</td>
<td>目标avro source的主机</td>
</tr>
<tr>
<td><strong>port</strong></td>
<td>–</td>
<td>目标avro source的绑定端口</td>
</tr>
<tr>
<td>batch-size</td>
<td>100</td>
<td>number of event to batch  together for send.</td>
</tr>
<tr>
<td>connect-timeout</td>
<td>20000</td>
<td>连接超时时间</td>
</tr>
<tr>
<td>request-timeout</td>
<td>20000</td>
<td>请求超时时间</td>
</tr>
<tr>
<td>reset-connection-interval</td>
<td>none</td>
<td>Amount of time (s)  before the connection to the next hop is reset. This will force the Avro Sink  to reconnect to the next hop. This will allow the sink to connect to hosts  behind a hardware load-balancer when news hosts are added without having to  restart the agent.</td>
</tr>
<tr>
<td>compression-type</td>
<td>none</td>
<td>This can be “none” or “deflate”. The  compression-type must match the compression-type of matching AvroSource</td>
</tr>
<tr>
<td>compression-level</td>
<td>6</td>
<td>The level of compression  to compress event. 0 &#x3D; no compression and 1-9 is compression. The higher the  number the more compression</td>
</tr>
<tr>
<td>ssl</td>
<td>false</td>
<td>Set to true to enable  SSL for this AvroSink. When configuring SSL, you can optionally set a “truststore”, “truststore-password”, “truststore-type”, and specify whether to “trust-all-certs”.</td>
</tr>
<tr>
<td>trust-all-certs</td>
<td>false</td>
<td>If this is set to true,  SSL server certificates for remote servers (Avro Sources) will not be  checked. This should NOT be used in production because it makes it easier for  an attacker to execute a man-in-the-middle attack and “listen in” on  the encrypted connection.</td>
</tr>
<tr>
<td>truststore</td>
<td>–</td>
<td>The path to a custom  Java truststore file. Flume uses the certificate authority information in  this file to determine whether the remote Avro Source’s SSL authentication credentials should be trusted. If not  specified, then the global keystore will be used. If the global keystore not  specified either, then the default Java JSSE certificate authority files  (typically “jssecacerts” or “cacerts” in the Oracle JRE) will be used.</td>
</tr>
<tr>
<td>truststore-password</td>
<td>–</td>
<td>The password for the  truststore. If not specified, then the global keystore password will be used  (if defined).</td>
</tr>
<tr>
<td>truststore-type</td>
<td>JKS</td>
<td>The type of the Java  truststore. This can be “JKS” or other supported Java truststore type. If not specified, then  the global keystore type will be used (if defined, otherwise the defautl is  JKS).</td>
</tr>
<tr>
<td>exclude-protocols</td>
<td>SSLv3</td>
<td>Space-separated list of  SSL&#x2F;TLS protocols to exclude. SSLv3 will always be excluded in addition to  the protocols specified.</td>
</tr>
<tr>
<td>maxIoWorkers</td>
<td>2 * the number of  available processors in the machine</td>
<td>The maximum number of  I&#x2F;O worker threads. This is configured on the NettyAvroRpcClient  NioClientSocketChannelFactory.</td>
</tr>
</tbody></table>
<h3 id="配置示例：-1"><a href="#配置示例：-1" class="headerlink" title="配置示例："></a>配置示例：</h3><p>级联配置，需要至少两个flume agent来演示</p>
<p>在C703上，配置avro sink 发送者</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## c703 ##</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">s1</span></span><br><span class="line"><span class="attr">a1.sources.s1.type</span> = <span class="string">exec</span></span><br><span class="line"><span class="attr">a1.sources.s1.command</span> = <span class="string">tail -F /root/weblog/access.log</span></span><br><span class="line"><span class="attr">a1.sources.s1.channels</span> = <span class="string">c1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hostname</span> = <span class="string">c701</span></span><br><span class="line"><span class="attr">a1.sinks.k1.port</span> = <span class="string">4545</span></span><br></pre></td></tr></table></figure>



<p>在C701上，配置avro source 接收者</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## c701 ##</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">s1</span></span><br><span class="line"><span class="attr">a1.sources.s1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sources.s1.hostname</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.s1.port</span> = <span class="string">4545</span></span><br><span class="line"><span class="attr">a1.sources.s1.channel</span> = <span class="string">c1</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>



<h3 id="启动测试：-4"><a href="#启动测试：-4" class="headerlink" title="启动测试："></a>启动测试：</h3><p>先在C701上启动接受者avro source（服务）</p>
<p><em>bin&#x2F;flume-ng agent -n a1 -c conf&#x2F; -f myconf&#x2F;avro-mem-logger.conf -Dflume.root.logger&#x3D;INFO,console</em></p>
<p>再在C703上启动发送者avro sink（客户端）</p>
<p><em>bin&#x2F;flume-ng agent -n a1 -c conf&#x2F; -f myconf&#x2F;tail-mem-avro.conf -Dflume.root.logger&#x3D;INFO,console</em></p>
<h1 id="十一、Channel选择器（channel-selector）"><a href="#十一、Channel选择器（channel-selector）" class="headerlink" title="十一、Channel选择器（channel selector）"></a>十一、Channel选择器（channel selector）</h1><p>一个source可以对接多个channel</p>
<p>那么，source的数据如何在多个channel之间传递，就由selector来控制</p>
<p>配置应该挂载到source组件上</p>
<h2 id="1-Replicating-Channel-Selector（复制选择器）"><a href="#1-Replicating-Channel-Selector（复制选择器）" class="headerlink" title="(1)Replicating Channel Selector（复制选择器）"></a>(1)Replicating Channel Selector（复制选择器）</h2><p><code>replicating selector就是默认的选择器</code></p>
<p>官网配置参考</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128000918130.png" alt="image-20230128000918130"></p>
<h3 id="目标场景："><a href="#目标场景：" class="headerlink" title="目标场景："></a>目标场景：</h3><p>selector将event复制，分发给所有下游节点</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128001034328.png" alt="image-20230128001034328"></p>
<h3 id="可选属性如下"><a href="#可选属性如下" class="headerlink" title="可选属性如下"></a>可选属性如下</h3><table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">selector.type</td>
<td align="left">replicating</td>
<td align="left"><code>replicating</code></td>
</tr>
<tr>
<td align="left">selector.optional</td>
<td align="left">–</td>
<td align="left"><code>optional</code></td>
</tr>
</tbody></table>
<h3 id="使用案例："><a href="#使用案例：" class="headerlink" title="使用案例："></a>使用案例：</h3><p>下面的配置中，c2是一个可选的channel，写入c2失败的话会被忽略，c1没有标记为可选，如果写入c1失败会导致事务的失败</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example10-channel-replicating.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1 k2</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1 c2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">exec</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1 c2</span></span><br><span class="line"><span class="attr">a1.sources.r1.command</span> = <span class="string">tail -F /export/data/flume-example-data/logdata/access.log</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.sources.r1.selector.type</span> = <span class="string">replicating</span></span><br><span class="line"><span class="attr">a1.sources.r1.selector.optional</span> = <span class="string">c2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c2.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c2.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c2.transactionCapacity</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.path</span> = <span class="string">hdfs://node1:8020/logdata_c1/%Y-%m-%d/%H/</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.filePrefix</span> = <span class="string">logdata_</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileSuffix</span> = <span class="string">.log</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollInterval</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollSize</span> = <span class="string">268435456</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollCount</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileType</span> = <span class="string">DataStream</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.useLocalTimeStamp</span> = <span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k2.channel</span> = <span class="string">c2</span></span><br><span class="line"><span class="attr">a1.sinks.k2.type</span> = <span class="string">hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.path</span> = <span class="string">hdfs://node1:8020/logdata_c2/%Y-%m-%d/%H/</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.filePrefix</span> = <span class="string">logdata_</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.fileSuffix</span> = <span class="string">.log</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.rollInterval</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.rollSize</span> = <span class="string">268435456</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.rollCount</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.fileType</span> = <span class="string">DataStream</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.useLocalTimeStamp</span> = <span class="string">true</span></span><br></pre></td></tr></table></figure>

<h2 id="（2）Multiplexing-Channel-Selector（多路选择器）"><a href="#（2）Multiplexing-Channel-Selector（多路选择器）" class="headerlink" title="（2）Multiplexing Channel Selector（多路选择器）"></a>（2）Multiplexing Channel Selector（多路选择器）</h2><p>multiplexing selector可以根据event中的一个<code>指定key的value</code>来决定这条消息会写入哪个channel，具体在选择时，需要配置一个映射关系，比如</p>
<p><code>a1.sources.r1.selector.mapping.CZ=c1</code> ; 就意味着<code>header中的value为CZ的话</code>，这条消息就会被<code>写入c1这个channel</code></p>
<p>multiplexing selector官方配置参考</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128003257255.png" alt="image-20230128003257255"></p>
<h3 id="目标场景"><a href="#目标场景" class="headerlink" title="目标场景"></a>目标场景</h3><p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230128003317149.png" alt="image-20230128003317149"></p>
<h3 id="多路channel选择器，可选属性如下"><a href="#多路channel选择器，可选属性如下" class="headerlink" title="多路channel选择器，可选属性如下"></a>多路channel选择器，可选属性如下</h3><table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">selector.type</td>
<td align="left">replicating</td>
<td align="left"><code>multiplexing</code></td>
</tr>
<tr>
<td align="left">selector.header</td>
<td align="left">flume.selector.header</td>
<td align="left">键值Key</td>
</tr>
<tr>
<td align="left">selector.default</td>
<td align="left">–</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">selector.mapping.*</td>
<td align="left">–</td>
<td align="left">路由</td>
</tr>
</tbody></table>
<h3 id="使用案例：-1"><a href="#使用案例：-1" class="headerlink" title="使用案例："></a>使用案例：</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example11-channel-Multiplexing.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1 c2</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1 k2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">TAILDIR</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1 c2</span></span><br><span class="line"><span class="attr">a1.sources.r1.positionFile</span> = <span class="string">/export/data/flume-example-data/flumedata/taildir_position.json</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups</span> = <span class="string">g1 g2</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups.g1</span> = <span class="string">/export/data/flume-example-data/weblog/web.*</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups.g2</span> = <span class="string">/export/data/flume-example-data/wxlog/wx.*</span></span><br><span class="line"><span class="attr">a1.sources.r1.headers.g1.logtype</span> = <span class="string">web</span></span><br><span class="line"><span class="attr">a1.sources.r1.headers.g2.logtype</span> = <span class="string">wx</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.selector.type</span> = <span class="string">multiplexing</span></span><br><span class="line"><span class="attr">a1.sources.r1.selector.header</span> = <span class="string">logtype</span></span><br><span class="line"><span class="attr">a1.sources.r1.selector.mapping.web</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.selector.mapping.wx</span> = <span class="string">c2</span></span><br><span class="line"><span class="attr">a1.sources.r1.selector.default</span> = <span class="string">c2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c2.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c2.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c2.transactionCapacity</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.path</span> = <span class="string">hdfs://node1:8020/%&#123;logtype&#125;/%Y-%m-%d/%H/</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.filePrefix</span> = <span class="string">logdata_</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileSuffix</span> = <span class="string">.log</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollInterval</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollSize</span> = <span class="string">268435456</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollCount</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileType</span> = <span class="string">DataStream</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.useLocalTimeStamp</span> = <span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k2.channel</span> = <span class="string">c2</span></span><br><span class="line"><span class="attr">a1.sinks.k2.type</span> = <span class="string">hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.path</span> = <span class="string">hdfs://node1:8020/%&#123;logtype&#125;/%Y-%m-%d/%H/</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.filePrefix</span> = <span class="string">logdata_</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.fileSuffix</span> = <span class="string">.log</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.rollInterval</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.rollSize</span> = <span class="string">268435456</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.rollCount</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.fileType</span> = <span class="string">DataStream</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hdfs.useLocalTimeStamp</span> = <span class="string">true</span></span><br></pre></td></tr></table></figure>

<p><strong>这里通过事件的header值来判断将事件发送到哪个channel，还可以配合拦截器一起使用。</strong></p>
<h1 id="十二、Sink处理器（sink-processor）"><a href="#十二、Sink处理器（sink-processor）" class="headerlink" title="十二、Sink处理器（sink processor）"></a>十二、Sink处理器（sink processor）</h1><p>一个agent中，<code>多个sink可以被组装到一个sink组</code>，而<code>数据在组内多个sink之间发送</code>，由sink processor来决定</p>
<p><code>Sink processor在flume中有3种</code>：</p>
<p><code>第一种</code>： <code>默认</code>的，不需要专门去配置的；相当于负载均衡，但是sink不需要创建group；</p>
<p><code>第二种</code>： <code>failover sink processor </code>自动失败切换，需要将<code>多个sink创建成group</code></p>
<p><code>第三种</code>： <code>load_balance sink processor </code>负载均衡，需要将<code>多个sink创建成group</code></p>
<p>可以将多个sink放入到一个组中，Sink处理器能够对一个组中所有的sink进行负载均衡，在一个sink出现临时错误时进行故障转移。</p>
<p>必须设置属性：</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>sinks</strong></td>
<td align="left">–</td>
<td align="left">组中多个sink使用空格分隔</td>
</tr>
<tr>
<td align="left"><strong>processor.type</strong></td>
<td align="left"><code>default</code></td>
<td align="left"><code>default</code>, <code>failover</code> 或<code>load_balance</code></td>
</tr>
</tbody></table>
<p>举例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a1.sinkgroups = g1</span><br><span class="line">a1.sinkgroups.g1.sinks = k1 k2</span><br><span class="line">a1.sinkgroups.g1.processor.type = failover</span><br></pre></td></tr></table></figure>

<h2 id="（1）Default-Sink-Processor"><a href="#（1）Default-Sink-Processor" class="headerlink" title="（1）Default Sink Processor"></a>（1）Default Sink Processor</h2><p>默认的Sink处理器只支持单个Sink</p>
<h2 id="（2）Failover-Sink-Processor"><a href="#（2）Failover-Sink-Processor" class="headerlink" title="（2）Failover Sink Processor"></a>（2）Failover Sink Processor</h2><p>一组中只有优先级高的那个sink在工作，另一个是等待中</p>
<p>如果高优先级的sink发送数据失败，则专用低优先级的sink去工作，并且，<code>在配置时间penalty之后，还会尝试用高优先级的去发送数据。</code></p>
<p>故障转移处理器维护了一个带有优先级的sink列表，故障转移机制将失败的sink放入到一个冷却池中，如果sink成功发送了事件，将其放入到活跃池中，<code>sink可以设置优先级，数字越高，优先级越高</code>，如果一个sink发送事件失败，下一个有更高优先级的sink将被用来发送事件，比如，<code>优先级100的比优先级80的先被使用，如果没有设置优先级，按配置文件中配置的顺序决定。</code>设置属性如下：</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>sinks</strong></td>
<td align="left">–</td>
<td align="left">组内多个sinks空格分隔</td>
</tr>
<tr>
<td align="left"><strong>processor.type</strong></td>
<td align="left"><code>default</code></td>
<td align="left"><code>failover</code></td>
</tr>
<tr>
<td align="left"><strong>processor.priority.</strong></td>
<td align="left">–</td>
<td align="left">优先级</td>
</tr>
<tr>
<td align="left">processor.maxpenalty</td>
<td align="left">30000</td>
<td align="left">失败sink的最大冷却时间</td>
</tr>
</tbody></table>
<p>示例如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">a1.sinkgroups</span> = <span class="string">g1</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.sinks</span> = <span class="string">k1 k2</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.type</span> = <span class="string">failover</span></span><br><span class="line"><span class="comment">## 对两个sink分配不同的优先级</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.priority.k1</span> = <span class="string">200</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.priority.k2</span> = <span class="string">100</span></span><br><span class="line"><span class="comment">## 主sink失败后，停用惩罚时间</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.maxpenalty</span> = <span class="string">5000</span></span><br></pre></td></tr></table></figure>

<p><code>优先级高的sink如果失败，则processor会激活优先级第二的sink</code>；</p>
<p><code>然后经过指定惩罚时间后，processor会再次尝试激活优先级高的sink</code>；</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130103523537.png" alt="image-20230130103523537"></p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130103553408.png" alt="image-20230130103553408"></p>
<h3 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h3><h4 id="（1）上游flume配置（node1）"><a href="#（1）上游flume配置（node1）" class="headerlink" title="（1）上游flume配置（node1）"></a>（1）上游flume配置（node1）</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example12-1-sink-failover.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1 k2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">exec</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.command</span> = <span class="string">tail -F /export/data/flume-example-data/logdata/access.log</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hostname</span> = <span class="string">node2</span></span><br><span class="line"><span class="attr">a1.sinks.k1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sinks.k1.batch-size</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k2.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k2.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hostname</span> = <span class="string">node3</span></span><br><span class="line"><span class="attr">a1.sinks.k2.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sinks.k2.batch-size</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinkgroups</span> = <span class="string">g1</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.sinks</span> = <span class="string">k1 k2</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.type</span> = <span class="string">failover</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.priority.k1</span> = <span class="string">200</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.priority.k2</span> = <span class="string">100</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.maxpenalty</span> = <span class="string">5000</span></span><br></pre></td></tr></table></figure>

<h4 id="（2）下游flume配置（node2-node3）"><a href="#（2）下游flume配置（node2-node3）" class="headerlink" title="（2）下游flume配置（node2 node3）"></a>（2）下游flume配置（node2 node3）</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example12-2-sink-failover.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sources.r1.threads</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>



<h2 id="（3）Load-balancing-Sink-Processor"><a href="#（3）Load-balancing-Sink-Processor" class="headerlink" title="（3）Load balancing Sink Processor"></a>（3）Load balancing Sink Processor</h2><p>允许channel中的数据<code>在一组sink中的多个sink之间进行交替</code>，交替策略有：</p>
<p>**<code>round_robin</code>**（轮询算法）</p>
<p>**<code>random</code>**（随机）</p>
<p>负载均衡处理器，可以通过轮询或者随机的方式进行负载均衡，也可以通过<code>继承AbstractSinkSelector </code>自定义负载均衡，设置属性如下：</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>processor.sinks</strong></td>
<td align="left">–</td>
<td align="left">组内多个sinks空格分隔</td>
</tr>
<tr>
<td align="left"><strong>processor.type</strong></td>
<td align="left"><code>default</code></td>
<td align="left"><code>load_balance</code></td>
</tr>
<tr>
<td align="left">processor.backoff</td>
<td align="left">false</td>
<td align="left">是否将失败的sink加入黑名单</td>
</tr>
<tr>
<td align="left">processor.selector</td>
<td align="left"><code>round_robin</code></td>
<td align="left">轮询机制:<code>round_robin</code>, <code>random</code> 或者自定义</td>
</tr>
<tr>
<td align="left">processor.selector.maxTimeOut</td>
<td align="left">30000</td>
<td align="left">黑名单有效时间（单位毫秒）</td>
</tr>
</tbody></table>
<p>示例如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a1.sinkgroups = g1</span><br><span class="line">a1.sinkgroups.g1.sinks = k1 k2</span><br><span class="line">a1.sinkgroups.g1.processor.type = load_balance</span><br><span class="line">a1.sinkgroups.g1.processor.backoff = true</span><br><span class="line">a1.sinkgroups.g1.processor.selector = round_robin</span><br></pre></td></tr></table></figure>

<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130111311611.png" alt="image-20230130111311611"></p>
<h3 id="实例：-1"><a href="#实例：-1" class="headerlink" title="实例："></a>实例：</h3><h4 id="（1）上游flume配置（node1）-1"><a href="#（1）上游flume配置（node1）-1" class="headerlink" title="（1）上游flume配置（node1）"></a>（1）上游flume配置（node1）</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example13-1-sink-loadbalance.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1 k2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">exec</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.command</span> = <span class="string">tail -F /export/data/flume-example-data/logdata/access.log</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hostname</span> = <span class="string">node2</span></span><br><span class="line"><span class="attr">a1.sinks.k1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sinks.k1.batch-size</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k2.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k2.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hostname</span> = <span class="string">node3</span></span><br><span class="line"><span class="attr">a1.sinks.k2.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sinks.k2.batch-size</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinkgroups</span> = <span class="string">g1</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.sinks</span> = <span class="string">k1 k2</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.type</span> = <span class="string">load_balance</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.backoff</span> = <span class="string">true </span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.selector</span> = <span class="string">round_robin</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="（2）下游flume配置（node2-node3）-1"><a href="#（2）下游flume配置（node2-node3）-1" class="headerlink" title="（2）下游flume配置（node2 node3）"></a>（2）下游flume配置（node2 node3）</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example13-2-sink-loadbalance.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sources.r1.threads</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">logger</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>



<h1 id="十三、flume进阶"><a href="#十三、flume进阶" class="headerlink" title="十三、flume进阶"></a>十三、flume进阶</h1><h2 id="（1）flume-事务机制"><a href="#（1）flume-事务机制" class="headerlink" title="（1）flume 事务机制"></a>（1）flume 事务机制</h2><p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130164206781.png" alt="image-20230130164206781"></p>
<h4 id="Delivery-保证"><a href="#Delivery-保证" class="headerlink" title="Delivery 保证"></a>Delivery 保证</h4><p>认识 Flume 对<code>事件投递的可靠性保证</code>是非常重要的，它往往是我们是否使用 Flume 来解决问题的决定因素之一。</p>
<p>消息投递的可靠保证有三种：</p>
<ul>
<li>At-least-once<code>（至少一次）</code>:在大多数的真实应用场景，我们希望不丢失事件。这种类型的保障称为 at-least-once，意思是<code>所有的事件都得到了处理，而一些事件还可能被处理多次</code>。这表示<code>计数结果可能大于正确值</code>，<code>但绝不会小于正确值</code>。也就是说，计数程序在发生故障后可能多算，但是绝不会少算。</li>
<li>At-most-once<code>（最多一次）</code>:这其实是没有正确性保障的委婉说法——当任务故障时，最简单的做法是什么都不干，<code>既不恢复丢失的状态，也不重播丢失的数据</code>。At-most-once 语义的含义是最多处理一次事件。例如：UDP，不提供任何一致性保障。</li>
<li>Exactly-once<code>（精确一次</code>）:<code>恰好处理一次是最严格的保证</code>，也是最难实现的。恰好处理一次语义不仅仅意味着没有事件丢失，还意味着针对每一个数据，内部状态仅仅更新一次。这指的是系统保证在发生故障后得到的计数结果与正确值一致。</li>
</ul>
<p>基本上所有工具的使用用户都希望工具框架能保证消息<code> Exactly-once</code> ，这样就<code>不必</code>在设计实现上<code>考虑</code>消息的<code>丢失或者重复</code>的处理场景。但是事实上很少有工具和框架能做到这一点，真正能做到这一点所付出的成本往往很大，或者带来的额外影响反而让你觉得不值得。假设 Flume 真的做到了 Exactly-once ，那势必降低了稳定性和吞吐量，所以 Flume 选择的策略是<code>At-least-once</code>。</p>
<p>当然这里的 At-least-once 需要加上引号，并不是说用上 Flume 的随便哪个组件组成一个实例，运行过程中就能保存消息不会丢失。事实上 At-least-once 原则只是说的是 <code>Source 、 Channel 和 Sink 三者之间上下投递消息的保证</code>。而当你选择 MemoryChannel 时，实例如果异常挂了再重启，在 channel 中的未被 sink 所消费的残留数据也就丢失了，从而<code>没办法保证整条链路</code>的<code> At-least-once</code>。</p>
<p>Flume 的 At-least-once 保证的实现基础是建立了<code>自身的 Transaction 机制</code>。</p>
<p>Flume 的 Transaction 有4个生命周期函数，分别是 <code>start、 commit、rollback 和 close</code>。</p>
<p>当 Source 往 Channel 批量投递事件时首先调用<code> start 开启事务</code>,<code>批量put </code>完事件后通过<code>commit</code>来提交事务，<code>如果 commit 异常则 rollback</code> ，然后 <code>close 事务</code>，最后 Source 将刚才提交的一批消息事件向源服务 ack（比如 kafka 提交新的 offset ）。Sink 消费 Channel 也是相同的模式，唯一的区别就是 Sink 需要在向目标源完成写入之后才对事务进行 commit。</p>
<p>两个组件的相同做法都是只有向下游成功投递了消息才会向上游 ack，从而保证了数据能 At-least-once 向下投递。</p>
<h2 id="（2）flume-agent-内部机制"><a href="#（2）flume-agent-内部机制" class="headerlink" title="（2）flume agent 内部机制"></a>（2）flume agent 内部机制</h2><p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130164421179.png" alt="image-20230130164421179"></p>
<p>组件：</p>
<h4 id="1、ChannelSelector"><a href="#1、ChannelSelector" class="headerlink" title="1、ChannelSelector"></a>1、ChannelSelector</h4><p>ChannelSelector 的作用就是选出 Event 将要被发往哪个 Channel。其共有两种类型，分别是 Replicating（复制）和 Multiplexing（多路复用）。 ReplicatingSelector 会将同一个 Event 发往所有的 Channel，Multiplexing 会根据相应的原则，将不同的 Event 发往不同的 Channel。</p>
<h4 id="2、SinkProcessor"><a href="#2、SinkProcessor" class="headerlink" title="2、SinkProcessor"></a>2、SinkProcessor</h4><p>(1) SinkProcessor 共 有 三 种 类 型 ， 分 别 是 DefaultSinkProcessor 、    LoadBalancingSinkProcessor 和 FailoverSinkProcessor。</p>
<p>(2) DefaultSinkProcessor 对应的是单个的 Sink，<br>LoadBalancingSinkProcessor 和 FailoverSinkProcessor 对应的是 Sink Group。</p>
<p>(3) LoadBalancingSinkProcessor 可以实现负载均衡的功能，FailoverSinkProcessor 可以实现故障转移的功能。</p>
<h2 id="（3）flume监控及ganglia监控"><a href="#（3）flume监控及ganglia监控" class="headerlink" title="（3）flume监控及ganglia监控"></a>（3）flume监控及ganglia监控</h2><h3 id="1）flume监控"><a href="#1）flume监控" class="headerlink" title="1）flume监控"></a>1）flume监控</h3><p>FLUME在运行时，状态是否正常，吞吐量是否正常，需要监控</p>
<p>Flume自身具有向外提交状态数据的功能；<strong>但是它本身没有一个完善的监控平台；</strong></p>
<p>开启内置监控功能，<strong>启动时加入参数：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dflume.monitoring.type=http -Dflume.monitoring.port=34545</span><br></pre></td></tr></table></figure>

<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230131134112881.png" alt="image-20230131134112881"></p>
<h3 id="2）ganglia监控"><a href="#2）ganglia监控" class="headerlink" title="2）ganglia监控"></a>2）ganglia监控</h3><p>将监控数据发往<strong>ganglia</strong>进行展现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dflume.monitoring.type=ganglia -Dflume.monitoring.port=34890</span><br></pre></td></tr></table></figure>

<p>Ganglia是一个通用的集群运维监控系统；</p>
<p>它在各台需要监控状态信息的机器上安装“探针”，然后这些“探针”会收集所在机器上的各种状态信息<strong>（cpu负载，内存负载，磁盘IO负载，网络IO负载，以及各类应用软件的状态信息）</strong>，然后汇聚到它的中心汇聚点，并提供<strong>web页面进行图形可视化查看</strong></p>
<p><em><strong>各种应用软件的态，是不会被ganglia的“探针”获取到的；而是由应用软件自身开发相应功能，将自身需要被监控的状态数据，提交给ganglia；</strong></em></p>
<p>Ganglia是UC Berkeley发起的一个开源集群监视项目，设计用于测量数以千计的节点。Ganglia的核心包含<strong>gmond（监控守护进程）</strong>、<strong>gmetad（元数据守护进程）</strong>以及一个<strong>Web前端</strong>。主要是用来监控系统性能，如：cpu 、mem、硬盘利用率， I&#x2F;O负载、网络流量情况等，通过曲线很容易见到每个节点的工作状态，对合理调整、分配系统资源，提高系统整体性能起到重要作用。</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130171701412.png" alt="image-20230130171701412"></p>
<h3 id="3）Ganglia安装"><a href="#3）Ganglia安装" class="headerlink" title="3）Ganglia安装"></a>3）Ganglia安装</h3><p><strong>中心节点的安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- epel包的安装：yum install -y epel-release(解决不能yum安装某些安装包的问题)</span><br><span class="line">- gmetad的安装：yum install -y ganglia-gmetad</span><br><span class="line">- gmond的安装：yum install -y ganglia-gmond</span><br><span class="line">- rrdtool的安装：yum install -y rrdtool</span><br><span class="line">- httpd服务器的安装：yum install -y httpd</span><br><span class="line">- ganglia-web及php安装：yum install -y ganglia-web php</span><br></pre></td></tr></table></figure>

<p><strong>被监测节点的安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- epel包的安装：yum install -y epel-release(解决不能yum安装某些安装包的问题)</span><br><span class="line">- gmond的安装：yum install -y gmond(提示找不到，感觉应该换成上面那个yum install -y ganglia-gmond)</span><br></pre></td></tr></table></figure>

<h3 id="4）Ganglia配置"><a href="#4）Ganglia配置" class="headerlink" title="4）Ganglia配置"></a>4）Ganglia配置</h3><p><strong>中心节点的配置</strong><br>安装目录说明</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- ganglia配置文件目录：/etc/ganglia</span><br><span class="line">- rrd数据库存放目录：/var/lib/ganglia/rrds</span><br><span class="line">- ganglia-web安装目录：/usr/share/ganglia</span><br><span class="line">- ganglia-web配置目录：/etc/httpd/conf.d/ganglia.conf</span><br></pre></td></tr></table></figure>

<p>相关配置文件修改<br>将ganglia-web的站点目录连接到httpd主站点目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"> <span class="built_in">ln</span> -s /usr/share/ganglia /var/www/html</span></span><br></pre></td></tr></table></figure>

<p>修改httpd主站点目录下ganglia站点目录的访问权限<br>将ganglia站点目录访问权限改为apache:apache，否则会报错</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"> <span class="built_in">chown</span> -R apache:apache /var/www/html/ganglia</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"> <span class="built_in">chmod</span> -R 755 /var/www/html/ganglia</span></span><br></pre></td></tr></table></figure>

<p>修改rrd数据库存放目录访问权限<br>将rrd数据库存放目录访问权限改为nobody:nobody,否则会报错</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"> <span class="built_in">chown</span> -R nobody:nobody /var/lib/ganglia/rrds</span></span><br></pre></td></tr></table></figure>

<p>修改ganglia-web的访问权限：<br>修改&#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;ganglia.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Alias /ganglia /usr/share/ganglia</span><br><span class="line">&lt;Location /ganglia&gt; </span><br><span class="line"> Require all granted</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">Require ip 10.1.2.3</span></span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">Require host example.org</span></span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>

<p>修改dwoo下面的权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /var/lib/ganglia/dwoo/compiled</span><br><span class="line">chmod 777 /var/lib/ganglia/dwoo/cache</span><br></pre></td></tr></table></figure>

<p>配置&#x2F;etc&#x2F;ganglia&#x2F;gmetad.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data_source  &quot;my cluster&quot; 192.168.88.161:8649(注意是所有节点都加上，如master:8649 slave0x:8649)</span><br><span class="line"> </span><br><span class="line">setuid_username nobody</span><br></pre></td></tr></table></figure>

<p>配置&#x2F;etc&#x2F;ganglia&#x2F;gmond.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cluster &#123; </span><br><span class="line">  name = &quot;node1&quot;</span><br><span class="line">  ... </span><br><span class="line">&#125; </span><br><span class="line">udp_send_channel &#123; </span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">the host <span class="built_in">who</span> gather this cluster<span class="string">&#x27;s monitoring data and send these data   to gmetad node</span></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash"><span class="string">注释掉多播模式的,以下出现这个都要注释掉</span></span></span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash"><span class="string">mcast_join = 239.2.11.71</span></span></span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash"><span class="string">添加单播模式的</span></span></span><br><span class="line"> host = 192.168.88.161</span><br><span class="line"> port = 8649 </span><br><span class="line">&#125; </span><br><span class="line">udp_recv_channel &#123; </span><br><span class="line">  bind = 192.168.88.161</span><br><span class="line">  port = 8649 </span><br><span class="line">&#125; </span><br><span class="line">tcp_accept_channel &#123; </span><br><span class="line">  port = 8649 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>被监测节点的配置</strong><br>配置&#x2F;etc&#x2F;ganglia&#x2F;gmond.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cluster &#123; </span><br><span class="line">  name = &quot;hadoop cluster&quot;</span><br><span class="line">  ... </span><br><span class="line">&#125; </span><br><span class="line">udp_send_channel &#123; </span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">the host <span class="built_in">who</span> gather this cluster<span class="string">&#x27;s monitoring data and send these data   to gmetad node</span></span></span><br><span class="line"> host = 192.168.88.161  </span><br><span class="line"> port = 8649 </span><br><span class="line">&#125; </span><br><span class="line">udp_recv_channel &#123; </span><br><span class="line">  port = 8649 </span><br><span class="line">&#125; </span><br><span class="line">tcp_accept_channel &#123; </span><br><span class="line">  port = 8649 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5）Ganglia启动"><a href="#5）Ganglia启动" class="headerlink" title="5）Ganglia启动"></a>5）Ganglia启动</h3><p><strong>中心节点的启动</strong><br>start httpd, gmetad, gmond</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl start httpd.service</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl start gmetad.service</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl start gmond.service</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl <span class="built_in">enable</span> httpd.service</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl <span class="built_in">enable</span> gmetad.service</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl <span class="built_in">enable</span> gmond.service</span></span><br></pre></td></tr></table></figure>

<p><strong>被监测节点的启动</strong><br>start gmond</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl start gmond.service</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl <span class="built_in">enable</span> gmond.service</span></span><br></pre></td></tr></table></figure>

<p><strong>关闭selinux</strong></p>
<p>vi &#x2F;etc&#x2F;selinux&#x2F;config，把SELINUX&#x3D;enforcing改成SELINUX&#x3D;disable；该方法需要重启机器。<br>可以使用命令setenforce 0来关闭selinux而不需要重启，刷新页面，即可访问；不过此法只是权宜之计，如果想永久修改selinux设置，还是要使用第一种方法</p>
<p><strong>开启防火墙</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p><strong>访问网页</strong><br>浏览器访问 {namenode的ip}&#x2F;ganglia即可 </p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200326103901392.png" alt="image-20200326103901392"></p>
<h3 id="6）添加Flume监控"><a href="#6）添加Flume监控" class="headerlink" title="6）添加Flume监控"></a>6）添加Flume监控</h3><p>修改flume-env.sh配置，添加虚拟机选项</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=&quot;-Dflume.monitoring.type=ganglia -Dflume.monitoring.hosts=192.168.88.161:8649 -Xms100m -Xmx200m&quot;</span><br></pre></td></tr></table></figure>

<p>启动flume</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flume-ng agent -n a1 -c conf -f example.conf -Dflume.monitoring.type=ganglia -Dflume.monitoring.hosts=192.168.88.161:8649</span><br></pre></td></tr></table></figure>

<p>查看ganglia页面</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200326111609055.png" alt="image-20200326111609055"></p>
<table>
<thead>
<tr>
<th>字段（图表名称）</th>
<th>字段含义</th>
</tr>
</thead>
<tbody><tr>
<td>EventPutAttemptCount</td>
<td>source尝试写入channel的事件总数量</td>
</tr>
<tr>
<td>EventPutSuccessCount</td>
<td>成功写入channel且提交的事件总数量</td>
</tr>
<tr>
<td>EventTakeAttemptCount</td>
<td>sink尝试从channel拉取事件的总数量。这不意味着每次事件都被返回，因为sink拉取的时候channel可能没有任何数据。</td>
</tr>
<tr>
<td>EventTakeSuccessCount</td>
<td>sink成功读取的事件的总数量</td>
</tr>
<tr>
<td>StartTime</td>
<td>channel启动的时间（毫秒）</td>
</tr>
<tr>
<td>StopTime</td>
<td>channel停止的时间（毫秒）</td>
</tr>
<tr>
<td>ChannelSize</td>
<td>目前channel中事件的总数量</td>
</tr>
<tr>
<td>ChannelFillPercentage</td>
<td>channel占用百分比</td>
</tr>
<tr>
<td>ChannelCapacity</td>
<td>channel的容量</td>
</tr>
</tbody></table>
<h2 id="（4）flume调优"><a href="#（4）flume调优" class="headerlink" title="（4）flume调优"></a>（4）flume调优</h2><p>flume-ng agent包括source、channel、sink三个部分，这三部分都运行在JVM上，而JVM运行在linux操作系统之上。因此，对于flume的性能调优，就是对这三部分及影响因素调优。</p>
<h3 id="1）source的配置"><a href="#1）source的配置" class="headerlink" title="1）source的配置"></a>1）source的配置</h3><p>项目中采用的是 taildir source，他的读取速度能够跟上命令行写入日志的速度，故并未做特殊的处理。</p>
<h3 id="2）channel的配置"><a href="#2）channel的配置" class="headerlink" title="2）channel的配置"></a>2）channel的配置</h3><p>可选的channel配置一般有两种，一是memory channel，二是file channel。</p>
<p><code>建议在内存足够的情况下，优先选择memory channel</code>。</p>
<p>尝试过<code>相同配置下</code>使用file channel和memory channel，<code>file channel明显速度较慢</code>，并且会<code>生成log</code>的文件，应该是用作缓存，当source已经接收但是还未写入sink时的event都会存在这个文件中。</p>
<p>这样的好处是保证数据不会丢失，所以<code>当对数据的丢失情况非常敏感且对实时性没有太大要求的时候</code>，还是使用file memory吧。</p>
<p>一开始的memory channel配置用的是默认的，然后控制台报出了如下警告：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARN：The channel is full or unexpected failure. The <span class="built_in">source</span> will try again after 1000 ms</span><br></pre></td></tr></table></figure>

<p>这个是因为当前被采集的文件过大，可以通过增大keep-alive的值解决。深层的原因是文件采集的速度和sink的速度没有匹配好。</p>
<p>所以memory channel有三个比较重要的参数需要配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#channel中最多缓存多少</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">5000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#channel一次最多吐给sink多少</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">2000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#event的活跃时间</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.keep-alive</span> = <span class="string">10</span></span><br></pre></td></tr></table></figure>

<h3 id="3）sink的配置"><a href="#3）sink的配置" class="headerlink" title="3）sink的配置"></a>3）sink的配置</h3><p>可以通过压缩来节省空间和网络流量，但是会增加cpu的消耗。</p>
<p>batch：size越大性能越好，但是太大会影响时效性，一般batch size和源数据端的大小相同。</p>
<h3 id="4）java内存的配置"><a href="#4）java内存的配置" class="headerlink" title="4）java内存的配置"></a>4）java内存的配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_OPTS=<span class="string">&quot;-Xms512m -Xmx2048m&quot;</span></span><br></pre></td></tr></table></figure>

<p>主要涉及Xms和Xmx两个参数，可以根据实际的服务器的内存大小进行设计。</p>
<h3 id="5）OS内核参数的配置"><a href="#5）OS内核参数的配置" class="headerlink" title="5）OS内核参数的配置"></a>5）OS内核参数的配置</h3><p>如果单台服务器启动的flume agent过多的话，默认的内核参数设置偏小，需要调整。（待补充，暂时还未涉及）。</p>
<h3 id="6）调优实战案例"><a href="#6）调优实战案例" class="headerlink" title="6）调优实战案例"></a>6）调优实战案例</h3><p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130172232611.png" alt="image-20230130172232611"></p>
<h4 id="agent层的调试数据"><a href="#agent层的调试数据" class="headerlink" title="agent层的调试数据"></a><strong>agent</strong>层的调试数据</h4><table>
<thead>
<tr>
<th align="center">优化方法</th>
<th align="center">java环境</th>
<th align="center">channel类型</th>
<th align="center">sink类型与个数</th>
<th align="center">压缩</th>
<th align="center">source接收到条数&amp;速度</th>
<th align="center">channel已写入 &amp;channel占用率</th>
<th align="center">sink输出量</th>
<th align="center">sink输出速度</th>
<th align="center">cpu占用</th>
<th align="center">内存占用</th>
<th align="center">总结</th>
</tr>
</thead>
<tbody><tr>
<td align="center">无</td>
<td align="center">默认</td>
<td align="center">file 100w</td>
<td align="center">负载均衡 2个avro  sink</td>
<td align="center">否</td>
<td align="center">2472192 1373&#x2F;s</td>
<td align="center">2473728 0.02%</td>
<td align="center">2360100</td>
<td align="center">1311&#x2F;s</td>
<td align="center">约35%</td>
<td align="center">8.6G</td>
<td align="center">传输效率很低</td>
</tr>
<tr>
<td align="center">优化java配置,启用2G内存</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 100w</td>
<td align="center">负载均衡 2个avro  sink</td>
<td align="center">否</td>
<td align="center">6226688 3459&#x2F;s</td>
<td align="center">6227712 99.90%</td>
<td align="center">5228000</td>
<td align="center">2904&#x2F;s</td>
<td align="center">约30%</td>
<td align="center">8.6G</td>
<td align="center">传输效率有较大提升</td>
</tr>
<tr>
<td align="center">avro压缩传输</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 100w</td>
<td align="center">负载均衡 2个avro  sink</td>
<td align="center">是</td>
<td align="center">5076224 2820&#x2F;s</td>
<td align="center">5077504 99.90%</td>
<td align="center">4077800</td>
<td align="center">2265&#x2F;s</td>
<td align="center">约47%</td>
<td align="center">10.4G</td>
<td align="center">传输效率不升反降</td>
</tr>
<tr>
<td align="center">采用memory channel</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">memory 100w</td>
<td align="center">负载均衡 2个avro  sink</td>
<td align="center">是</td>
<td align="center">6767104 3759&#x2F;s</td>
<td align="center">6771968 99.90%</td>
<td align="center">5772200</td>
<td align="center">3207&#x2F;s</td>
<td align="center">100%-200%</td>
<td align="center">10.4G</td>
<td align="center">传输效率有少量提升，但是cpu压力很大</td>
</tr>
<tr>
<td align="center">数据不传输到L2，直接sink到本地</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 100w</td>
<td align="center">负载均衡 2个file  sink</td>
<td align="center">否</td>
<td align="center">5761280 3201&#x2F;s</td>
<td align="center">5762816 0.00%</td>
<td align="center">5761662</td>
<td align="center">3201&#x2F;s</td>
<td align="center">10%-50%</td>
<td align="center">10.4G</td>
<td align="center">channel无堆积，但是传输量无明显提升</td>
</tr>
<tr>
<td align="center">将数据传给8个Sink组成的L2</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 100w</td>
<td align="center">负载均衡 8个avro  sink</td>
<td align="center">否</td>
<td align="center">1423616 791&#x2F;s</td>
<td align="center">1393664 99.90%</td>
<td align="center">393700</td>
<td align="center">218&#x2F;s</td>
<td align="center">5%</td>
<td align="center">10.4G</td>
<td align="center">传输效率极低</td>
</tr>
<tr>
<td align="center">优化avro-avro传输，avro sink配置maxIoWorkers128，L2的avro source threads设为1000</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 100w</td>
<td align="center">负载均衡 2个file  sink</td>
<td align="center">否</td>
<td align="center">2971392 1651&#x2F;s</td>
<td align="center">2972416 99.90%</td>
<td align="center">1972500</td>
<td align="center">1095&#x2F;s</td>
<td align="center">5%-20%</td>
<td align="center">10.4G</td>
<td align="center">传输效率不升反降</td>
</tr>
<tr>
<td align="center">将L2数据sink到本地</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 100w</td>
<td align="center">负载均衡 2个avro  sink</td>
<td align="center">否</td>
<td align="center">6279168 3488&#x2F;s</td>
<td align="center">6280448 99.90%</td>
<td align="center">5280500</td>
<td align="center">2934&#x2F;s</td>
<td align="center">约30%</td>
<td align="center">10.4G</td>
<td align="center">传输效率无明显提升</td>
</tr>
<tr>
<td align="center">增大java内存 增大avro sink batchsize 启用压缩 启用memorychannel</td>
<td align="center">Xms8g Xmx8g Xss256k Xmn3g</td>
<td align="center">memory 100w</td>
<td align="center">负载均衡 2个avro  sink</td>
<td align="center">是</td>
<td align="center">5640704 3134&#x2F;s</td>
<td align="center">5643776 99.90%</td>
<td align="center">4644000</td>
<td align="center">2580&#x2F;s</td>
<td align="center">30%</td>
<td align="center">16.5G</td>
<td align="center">传输效率无明显提升</td>
</tr>
<tr>
<td align="center">增加jvm内存到8G，filechannel设为1000w容量</td>
<td align="center">Xms8g Xmx8g Xss256k Xmn3g</td>
<td align="center">file 1000w</td>
<td align="center">负载均衡 2个file  sink</td>
<td align="center">否</td>
<td align="center">7330816 4073&#x2F;s</td>
<td align="center">7332096 48%</td>
<td align="center">2519000</td>
<td align="center">1399&#x2F;s</td>
<td align="center">2%-16%</td>
<td align="center">16.5G</td>
<td align="center">传输效率不升反降</td>
</tr>
<tr>
<td align="center">在上一种方法的基础上增加avro batchsize为2000</td>
<td align="center">Xms8g Xmx8g Xss256k Xmn3g</td>
<td align="center">file 2000w</td>
<td align="center">负载均衡 2个avro  sink</td>
<td align="center">否</td>
<td align="center">8168960 4538&#x2F;s</td>
<td align="center">8170496 69%</td>
<td align="center">1270000</td>
<td align="center">706&#x2F;s</td>
<td align="center">10%-20%</td>
<td align="center">16.5G</td>
<td align="center">传输效率极低</td>
</tr>
<tr>
<td align="center">4个sink无组策略</td>
<td align="center">Xms8g Xmx8g Xss256k Xmn3g</td>
<td align="center">file 2000w</td>
<td align="center">无组策略 4个avro  sink</td>
<td align="center">否</td>
<td align="center">7222272 4012&#x2F;s</td>
<td align="center">7223808 0.02%</td>
<td align="center">7222272</td>
<td align="center">4012&#x2F;s</td>
<td align="center">30%-50%</td>
<td align="center">16.6G</td>
<td align="center">取消负载均衡，效率有较大提升666</td>
</tr>
<tr>
<td align="center">8个sink无组策略</td>
<td align="center">Xms8g Xmx8g Xss256k Xmn3g</td>
<td align="center">file 2000w</td>
<td align="center">无组策略 8个avro  sink</td>
<td align="center">否</td>
<td align="center">7034624 3908&#x2F;s</td>
<td align="center">7035648 0.03614%</td>
<td align="center">7032034</td>
<td align="center">3906&#x2F;s</td>
<td align="center">30%-50%</td>
<td align="center">16.6G</td>
<td align="center">无组策略的情况下，8个sink和4个sink效率无差</td>
</tr>
<tr>
<td align="center">4个sink无组策略  memrorychannel</td>
<td align="center">Xms8g Xmx8g Xss256k Xmn3g</td>
<td align="center">memory 100w</td>
<td align="center">无组策略 4个avro  sink</td>
<td align="center">否</td>
<td align="center">17435648 9686&#x2F;s</td>
<td align="center">17441536 47.56%</td>
<td align="center">12678000</td>
<td align="center">7043&#x2F;s</td>
<td align="center">100%-500%</td>
<td align="center">16.6G</td>
<td align="center">cpu压力很大</td>
</tr>
<tr>
<td align="center">2个sink无组策略  memrorychannel L2的内存channel扩大到1亿</td>
<td align="center">Xms8g Xmx8g Xss256k Xmn3g</td>
<td align="center">memory 100w</td>
<td align="center">无组策略 4个avro  sink</td>
<td align="center">否</td>
<td align="center">18679438 10337&#x2F;s</td>
<td align="center">18684778 0.00256%</td>
<td align="center">18683444</td>
<td align="center">10448&#x2F;s</td>
<td align="center">10%-20%</td>
<td align="center">16.6G</td>
<td align="center">此为目前传输最快的方案</td>
</tr>
<tr>
<td align="center">8个sink无组策略，2G内存</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 2000w</td>
<td align="center">无组策略 8个avro  sink</td>
<td align="center">否</td>
<td align="center">7067392 3926&#x2F;s</td>
<td align="center">7068416 0.00256%</td>
<td align="center">7067212</td>
<td align="center">3926&#x2F;s</td>
<td align="center">30%-40%</td>
<td align="center">10.8G</td>
<td align="center">jvm2G内存已经够用</td>
</tr>
<tr>
<td align="center">8个sink无组策略，2G内存,压缩</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 2000w</td>
<td align="center">无组策略 8个avro  sink</td>
<td align="center">是</td>
<td align="center">7362048 4090&#x2F;s</td>
<td align="center">7363072 0.0055%</td>
<td align="center">7361995</td>
<td align="center">4090&#x2F;s</td>
<td align="center">50%-100%</td>
<td align="center">10.6G</td>
<td align="center">L1到L2压缩对传输速度无太大提升，增大了CPU负担</td>
</tr>
<tr>
<td align="center">4个sink无组策略，2G内存,压缩</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 2000w</td>
<td align="center">无组策略 4个avro  sink</td>
<td align="center">是</td>
<td align="center">7501056 4167&#x2F;s</td>
<td align="center">7502592 0.01664</td>
<td align="center">8036352</td>
<td align="center">4464&#x2F;s</td>
<td align="center">40%-50%</td>
<td align="center">10.5G</td>
<td align="center">从channel获取的数量大于channel写入的数量，说明此时的瓶颈在channel写入</td>
</tr>
<tr>
<td align="center">4个sink无组策略，2G内存,不压缩</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 2000w</td>
<td align="center">无组策略 4个avro  sink</td>
<td align="center">否</td>
<td align="center">7745792 4303&#x2F;s</td>
<td align="center">7747328 0.02688</td>
<td align="center">7741952</td>
<td align="center">4301&#x2F;s</td>
<td align="center">50%-100%</td>
<td align="center">10.5G</td>
<td align="center">L1到L2压缩对传输速度无太大提升，增大了CPU负担</td>
</tr>
<tr>
<td align="center">8个sink无组策略，发送到4个L2，每个L2有两个source，两个channel</td>
<td align="center">Xms2g Xmx2g Xss256k Xmn1g</td>
<td align="center">file 2000w</td>
<td align="center">无组策略 8个avro  sink</td>
<td align="center">否</td>
<td align="center">6734336 3741&#x2F;s</td>
<td align="center">6735360 0.00177</td>
<td align="center">6735006</td>
<td align="center">3742&#x2F;s</td>
<td align="center">30%-50%</td>
<td align="center">10.8G</td>
<td align="center">发给同一机器的两个avro source无性能提升</td>
</tr>
</tbody></table>
<h4 id="collector层的调试数据"><a href="#collector层的调试数据" class="headerlink" title="collector层的调试数据"></a>collector层的调试数据</h4><table>
<thead>
<tr>
<th align="center">优化方法</th>
<th align="center">java环境</th>
<th align="center">channel类型</th>
<th align="center">sink类型与个数</th>
<th>压缩</th>
<th align="center">source接收到条数&amp;速度</th>
<th align="center">channel已写入 &amp;channel占用率</th>
<th align="center">sink输出量</th>
<th align="center">sink输出速度</th>
<th align="center">cpu占用</th>
<th align="center">内存占用</th>
<th align="center">总结</th>
</tr>
</thead>
<tbody><tr>
<td align="center">正常传输</td>
<td align="center">Xms20g Xmx20g Xss256k Xmn8g</td>
<td align="center">file 100w</td>
<td align="center">无组策略 1个kafka  sink</td>
<td>否</td>
<td align="center">3099048 1722&#x2F;s</td>
<td align="center">3095238 99.90%</td>
<td align="center">2144761</td>
<td align="center">1192&#x2F;s</td>
<td align="center">2%-5%</td>
<td align="center">25.6G</td>
<td align="center">输出速度  不够</td>
</tr>
<tr>
<td align="center">增加到4个sink，filechannel容量扩大</td>
<td align="center">Xms20g Xmx20g Xss256k Xmn8g</td>
<td align="center">file 1亿</td>
<td align="center">无组策略 4个kafka  sink</td>
<td>否</td>
<td align="center">18850000 10472&#x2F;s</td>
<td align="center">18850000 9.86%</td>
<td align="center">8970971</td>
<td align="center">4984&#x2F;s</td>
<td align="center">50%-100%</td>
<td align="center">25.6G</td>
<td align="center">速度提升  约4倍</td>
</tr>
<tr>
<td align="center">使用memory channel</td>
<td align="center">Xms20g Xmx20g Xss256k Xmn8g</td>
<td align="center">memory 1000w</td>
<td align="center">无组策略 4个kafka  sink</td>
<td>否</td>
<td align="center">17794000 9886&#x2F;s</td>
<td align="center">17744000 99.95%</td>
<td align="center">7745000</td>
<td align="center">4303&#x2F;s</td>
<td align="center">100%-800%</td>
<td align="center">25.6G</td>
<td align="center">相比使用file channel无性能提升</td>
</tr>
<tr>
<td align="center">增加到8个sink</td>
<td align="center">Xms20g Xmx20g Xss256k Xmn8g</td>
<td align="center">file 1亿</td>
<td align="center">无组策略 8个kafka  sink</td>
<td>否</td>
<td align="center">19251655 10695&#x2F;s</td>
<td align="center">19249668 2%</td>
<td align="center">17148675</td>
<td align="center">9527&#x2F;s</td>
<td align="center">100%-150%</td>
<td align="center">26.8G</td>
<td align="center">8个sink传输比1个速度提升约8倍</td>
</tr>
</tbody></table>
<h5 id="agent到collector启用zlib压缩前后的网络带宽情况"><a href="#agent到collector启用zlib压缩前后的网络带宽情况" class="headerlink" title="agent到collector启用zlib压缩前后的网络带宽情况"></a>agent到collector启用zlib压缩前后的网络带宽情况</h5><p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130173816550.png" alt="image-20230130173816550"></p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a><strong>总结：</strong></h4><p>1、<code>默认jvm环境只使用了20m内存</code>，需要调整，扩大到<code>2G基本够用</code>，不需要过大； </p>
<p>2、<code>collector到kafka</code>，启用的<code>sink越多</code>，<code>传输越快</code>； </p>
<p>3、如果collector到kafka通路受阻，使数据堆积在channel中，如果channel堆满，则会<code>影响agent到collector的传输</code>； </p>
<p>4、agent到collector如果配置了组策略（sink group），则一个组策略只启动一个传输线程，多个sink成一组则传输效率远不如sink各传各的，一个sink相当于一个传输线程； </p>
<p>5、通路不受阻的情况下，<code>memoryChannel传输效率</code>比fileChannel<code>高</code>很多，不过对<code>cpu、内存</code>的<code>要求会很高</code>； </p>
<p>6、<code>avro压缩传输对传输效率没有太大提升</code>，反而<code>增大cpu负担</code>,但是会<code>大大降低网络带宽</code>； </p>
<p>7、在网络带宽受限的情况下，增加sink、改用memory channel等方法都不能增加传输效率； </p>
<p>8、影响flume传输性能的<strong>主要因素有，jvm内存、网络带宽、channel类型、sink个数、是否压缩、机器硬件性能</strong>，各条件需要做一个综合的性能平衡，某一个环节出现瓶颈就会影响整个系统的传输性能。</p>
<h1 id="十四、使用Flume导入数据到HDFS"><a href="#十四、使用Flume导入数据到HDFS" class="headerlink" title="十四、使用Flume导入数据到HDFS"></a>十四、使用Flume导入数据到HDFS</h1><p>数据导出到HDFS需要使用HDFS Sink，需要配置属性如下：</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>channel</strong></td>
<td align="left">–</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><strong>type</strong></td>
<td align="left">–</td>
<td align="left"><code>hdfs</code></td>
</tr>
<tr>
<td align="left"><strong>hdfs.path</strong></td>
<td align="left">–</td>
<td align="left">HDFS 文件路径 (例如 hdfs:&#x2F;&#x2F;namenode&#x2F;flume&#x2F;webdata&#x2F;)</td>
</tr>
<tr>
<td align="left">hdfs.fileType</td>
<td align="left">SequenceFile</td>
<td align="left">文件格式:  <code>SequenceFile</code>, <code>DataStream</code> or <code>CompressedStream</code> (1)DataStream 不会压缩输出文件且不用设置 codeC (2)CompressedStream 需要设置 hdfs.codeC</td>
</tr>
<tr>
<td align="left">hdfs.codeC</td>
<td align="left"></td>
<td align="left">压缩格式 : gzip, bzip2, lzo, lzop, snappy</td>
</tr>
</tbody></table>
<p>注：使用HDFS Sink需要用到Hadoop的多个包，可以在装有Hadoop的主机上运行Flume，如果是单独部署的Flume，可以通过多个Agent的形式将单独部署的Flume Agent 日志数据发送到装有Hadoop的Flume Agent上。</p>
<p>创建hdfs.conf </p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义agent名称为a1</span></span><br><span class="line"><span class="comment"># 设置3个组件的名称</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置source类型为NetCat,监听地址为本机，端口为44444</span></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">netcat</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">localhost</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置sink类型为hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.path</span> = <span class="string">hdfs://node01:9000/user/flume/logs</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileType</span> = <span class="string">DataStream</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置channel类型为内存，内存队列最大容量为1000，一个事务中从source接收的Events数量或者发送给sink的Events数量最大为100</span></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">memory</span></span><br><span class="line"><span class="attr">a1.channels.c1.capacity</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">100</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 将source和sink绑定到channel上</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br></pre></td></tr></table></figure>

<p>启动flume</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flume-ng agent --conf conf/ --conf-file conf/hdfs.conf -Dfile.root.logger=debug,info,console --name hdfs</span><br></pre></td></tr></table></figure>

<p>注：如果出现<code>com.google.common.base.Preconditions.checkArgument</code> 查看下<code>flume/lib</code>目录下</p>
<p>的<code>guava.jar</code>版本是否与<code>hadoop/share/hadoop/common/lib</code>中的版本是否一致，不一致拷贝新版</p>
<p>重新运行</p>
<p><img src="/md%E5%9B%BE/flume.assets/image-20200112212041558.png" alt="image-20200112212041558"></p>
<p>在后台查看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -cat /user/flume/messages/flume-.1578835130630</span><br></pre></td></tr></table></figure>



<p><img src="/md%E5%9B%BE/flume.assets/image-20200112212150353.png" alt="image-20200112212150353"></p>
<h1 id="十五、Flume-SDK"><a href="#十五、Flume-SDK" class="headerlink" title="十五、Flume SDK"></a>十五、Flume SDK</h1><h2 id="（1）自定义Source"><a href="#（1）自定义Source" class="headerlink" title="（1）自定义Source"></a>（1）自定义Source</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySource</span> <span class="keyword">extends</span> <span class="title class_">AbstractSource</span> <span class="keyword">implements</span> <span class="title class_">Configurable</span>, PollableSource &#123;</span><br><span class="line">  <span class="keyword">private</span> String myProp;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">myProp</span> <span class="operator">=</span> context.getString(<span class="string">&quot;myProp&quot;</span>, <span class="string">&quot;defaultValue&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Process the myProp value (e.g. validation, convert to another type, ...)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Store myProp for later retrieval by process() method</span></span><br><span class="line">    <span class="built_in">this</span>.myProp = myProp;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Initialize the connection to the external client</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span> <span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Disconnect from external client and do any additional cleanup</span></span><br><span class="line">    <span class="comment">// (e.g. releasing resources or nulling-out field values) ..</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Status <span class="title function_">process</span><span class="params">()</span> <span class="keyword">throws</span> EventDeliveryException &#123;</span><br><span class="line">    <span class="type">Status</span> <span class="variable">status</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// This try clause includes whatever Channel/Event operations you want to do</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Receive new data</span></span><br><span class="line">      <span class="type">Event</span> <span class="variable">e</span> <span class="operator">=</span> getSomeData();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Store the Event into this Source&#x27;s associated Channel(s)</span></span><br><span class="line">      getChannelProcessor().processEvent(e);</span><br><span class="line"></span><br><span class="line">      status = Status.READY;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">      <span class="comment">// Log exception, handle individual exceptions as needed</span></span><br><span class="line"></span><br><span class="line">      status = Status.BACKOFF;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// re-throw all Errors</span></span><br><span class="line">      <span class="keyword">if</span> (t <span class="keyword">instanceof</span> Error) &#123;</span><br><span class="line">        <span class="keyword">throw</span> (Error)t;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      txn.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加MySource"><a href="#添加MySource" class="headerlink" title="添加MySource"></a>添加MySource</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.flume.source;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flume.Context;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.Event;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.EventDeliveryException;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.PollableSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.conf.Configurable;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.event.SimpleEvent;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.source.AbstractSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySource</span> <span class="keyword">extends</span> <span class="title class_">AbstractSource</span> <span class="keyword">implements</span> <span class="title class_">Configurable</span>, PollableSource &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理数据</span></span><br><span class="line">    <span class="keyword">public</span> Status <span class="title function_">process</span><span class="params">()</span> <span class="keyword">throws</span> EventDeliveryException &#123;</span><br><span class="line">        <span class="type">Status</span> <span class="variable">status</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 接收新数据</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="type">Event</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleEvent</span>();</span><br><span class="line">                e.setBody((<span class="string">&quot;data:&quot;</span>+i).getBytes());</span><br><span class="line">                <span class="comment">// 将数据存储到与Source关联的Channel中</span></span><br><span class="line">                getChannelProcessor().processEvent(e);</span><br><span class="line">                status = Status.READY;</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            <span class="comment">// 打印日志</span></span><br><span class="line">            status = Status.BACKOFF;</span><br><span class="line">            <span class="comment">// 抛出异常</span></span><br><span class="line">            <span class="keyword">if</span> (t <span class="keyword">instanceof</span> Error) &#123;</span><br><span class="line">                <span class="keyword">throw</span> (Error)t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getBackOffSleepIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getMaxBackOffSleepInterval</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(Context context)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="添加mySourceAgent-conf"><a href="#添加mySourceAgent-conf" class="headerlink" title="添加mySourceAgent.conf"></a>添加mySourceAgent.conf</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义agent名称为a1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置3个组件的名称</span></span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置<span class="built_in">source</span>类型为mysource</span></span><br><span class="line">a1.sources.r1.type = com.itheima.flume.source.MySource</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置sink类型为Logger</span></span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置channel类型为内存，内存队列最大容量为1000，一个事务中从<span class="built_in">source</span>接收的Events数量或者发送给sink的Events数量最大为100</span></span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将<span class="built_in">source</span>和sink绑定到channel上</span></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br></pre></td></tr></table></figure>

<h3 id="启动Flume"><a href="#启动Flume" class="headerlink" title="启动Flume"></a>启动Flume</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flume-ng agent -n a1 -c conf -f mySourceAgent.conf</span><br></pre></td></tr></table></figure>



<h2 id="（2）自定义Sink"><a href="#（2）自定义Sink" class="headerlink" title="（2）自定义Sink"></a>（2）自定义Sink</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySink</span> <span class="keyword">extends</span> <span class="title class_">AbstractSink</span> <span class="keyword">implements</span> <span class="title class_">Configurable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String myProp;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">myProp</span> <span class="operator">=</span> context.getString(<span class="string">&quot;myProp&quot;</span>, <span class="string">&quot;defaultValue&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Process the myProp value (e.g. validation)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Store myProp for later retrieval by process() method</span></span><br><span class="line">    <span class="built_in">this</span>.myProp = myProp;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Initialize the connection to the external repository (e.g. HDFS) that</span></span><br><span class="line">    <span class="comment">// this Sink will forward Events to ..</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span> <span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Disconnect from the external respository and do any</span></span><br><span class="line">    <span class="comment">// additional cleanup (e.g. releasing resources or nulling-out</span></span><br><span class="line">    <span class="comment">// field values) ..</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Status <span class="title function_">process</span><span class="params">()</span> <span class="keyword">throws</span> EventDeliveryException &#123;</span><br><span class="line">    <span class="type">Status</span> <span class="variable">status</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start transaction</span></span><br><span class="line">    <span class="type">Channel</span> <span class="variable">ch</span> <span class="operator">=</span> getChannel();</span><br><span class="line">    <span class="type">Transaction</span> <span class="variable">txn</span> <span class="operator">=</span> ch.getTransaction();</span><br><span class="line">    txn.begin();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// This try clause includes whatever Channel operations you want to do</span></span><br><span class="line"></span><br><span class="line">      <span class="type">Event</span> <span class="variable">event</span> <span class="operator">=</span> ch.take();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Send the Event to the external repository.</span></span><br><span class="line">      <span class="comment">// storeSomeData(e);</span></span><br><span class="line"></span><br><span class="line">      txn.commit();</span><br><span class="line">      status = Status.READY;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">      txn.rollback();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Log exception, handle individual exceptions as needed</span></span><br><span class="line"></span><br><span class="line">      status = Status.BACKOFF;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// re-throw all Errors</span></span><br><span class="line">      <span class="keyword">if</span> (t <span class="keyword">instanceof</span> Error) &#123;</span><br><span class="line">        <span class="keyword">throw</span> (Error)t;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加MySink，可以参考LoggerSink"><a href="#添加MySink，可以参考LoggerSink" class="headerlink" title="添加MySink，可以参考LoggerSink"></a>添加MySink，可以参考LoggerSink</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.flume.sink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flume.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.conf.Configurable;</span><br><span class="line"><span class="keyword">import</span> org.apache.flume.sink.AbstractSink;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySink</span> <span class="keyword">extends</span> <span class="title class_">AbstractSink</span> <span class="keyword">implements</span> <span class="title class_">Configurable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory</span><br><span class="line">            .getLogger(MySink.class);</span><br><span class="line">    <span class="keyword">public</span> Status <span class="title function_">process</span><span class="params">()</span> <span class="keyword">throws</span> EventDeliveryException &#123;</span><br><span class="line">        <span class="type">Status</span> <span class="variable">status</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// 开启事务</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">ch</span> <span class="operator">=</span> getChannel();</span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">txn</span> <span class="operator">=</span> ch.getTransaction();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            txn.begin();</span><br><span class="line">            <span class="comment">// 从channel中获取数据</span></span><br><span class="line">            <span class="type">Event</span> <span class="variable">event</span> <span class="operator">=</span> ch.take();</span><br><span class="line">            <span class="keyword">if</span>(event==<span class="literal">null</span>)&#123;</span><br><span class="line">                status = Status.BACKOFF;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 将事件发送到外部存储</span></span><br><span class="line">            <span class="comment">// storeSomeData(e);</span></span><br><span class="line">            <span class="comment">// 打印事件</span></span><br><span class="line">            logger.info(<span class="keyword">new</span> <span class="title class_">String</span>(event.getBody()));</span><br><span class="line">            <span class="comment">// 提交事务</span></span><br><span class="line">            txn.commit();</span><br><span class="line">            status = Status.READY;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            txn.rollback();</span><br><span class="line">            <span class="comment">// 打印异常日志</span></span><br><span class="line">            status = Status.BACKOFF;</span><br><span class="line">            <span class="comment">// 抛出异常</span></span><br><span class="line">            <span class="keyword">if</span> (t <span class="keyword">instanceof</span> Error) &#123;</span><br><span class="line">                <span class="keyword">throw</span> (Error)t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            txn.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(Context context)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改上面的mySourceAgent-conf"><a href="#修改上面的mySourceAgent-conf" class="headerlink" title="修改上面的mySourceAgent.conf"></a>修改上面的mySourceAgent.conf</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义agent名称为a1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置3个组件的名称</span></span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置<span class="built_in">source</span>类型为mysource</span></span><br><span class="line">a1.sources.r1.type = com.itheima.flume.source.MySource</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置sink类型为MySink</span></span><br><span class="line">a1.sinks.k1.type = com.itheima.flume.sink.MySink</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置channel类型为内存，内存队列最大容量为1000，一个事务中从<span class="built_in">source</span>接收的Events数量或者发送给sink的Events数量最大为100</span></span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将<span class="built_in">source</span>和sink绑定到channel上</span></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br></pre></td></tr></table></figure>



<h1 id="十六、Flume-综合实战案例"><a href="#十六、Flume-综合实战案例" class="headerlink" title="十六、Flume 综合实战案例"></a>十六、Flume 综合实战案例</h1><h2 id="（1）案例场景"><a href="#（1）案例场景" class="headerlink" title="（1）案例场景"></a>（1）案例场景</h2><p>A、B、C等日志服务机器实时生产日志，日志的内容分为多种类型：</p>
<p>  APP端用户行为日志</p>
<p>  微信小程序端用户行为日志</p>
<p>  PC端用户行为日志</p>
<h3 id="需求："><a href="#需求：" class="headerlink" title="需求："></a><strong>需求：</strong></h3><p>把日志服务器中的各类日志数据采集汇总到一个中转agent上，然后分类写入hdfs中。</p>
<p>在hdfs中要求的目录为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/source/logs/app_log/20160101/**</span><br><span class="line"></span><br><span class="line">/source/logs/wxapp_log/20160101/**</span><br><span class="line"></span><br><span class="line">/source/logs/pcweb_log/20160101/**</span><br></pre></td></tr></table></figure>

<p><em><strong>并要求可以按指定的字段名，将对应字段内容加密！</strong></em></p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230130235444507.png" alt="image-20230130235444507"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">linux命令操作替换jar包中的文件：</span><br><span class="line"></span><br><span class="line">显示jar中的文件列表：  jar -tvf xx.jar</span><br><span class="line"></span><br><span class="line">解压jar中的指定文件：  jar -xvf xx.jar yy.properties</span><br><span class="line"></span><br><span class="line">更新jar中的指定文件：  jar -uvf xx.jar yy.properties</span><br></pre></td></tr></table></figure>

<h2 id="（2）实现思路"><a href="#（2）实现思路" class="headerlink" title="（2）实现思路"></a>（2）实现思路</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1. 每台日志服务器上部署一个flume agent - - -&gt; 上游，每个agent配置2个source对应2类数据</span><br><span class="line"></span><br><span class="line">2. 上游的agent在采集数据时，添加一个header，指定数据的类别</span><br><span class="line"></span><br><span class="line">3. 上游的agent要配置两个avro sink，各自对接一个下级的agent</span><br><span class="line"></span><br><span class="line">4. 上游还要配置sink processor，fail over sink processor，控制两个sink中只有一个avro sink在工作，如果失败再切换到另一个avro sink</span><br><span class="line"></span><br><span class="line">5. 上游还要配置字段加密拦截器</span><br><span class="line"></span><br><span class="line">6. 下游配置两个flume agent，使用avro source接收数据</span><br><span class="line"></span><br><span class="line">7. 下游的hdfs sink，目录配置使用动态通配符，取到event中的类别header，以便于将不同类别数据写入不同hdfs目录 </span><br></pre></td></tr></table></figure>

<h2 id="（3）操作步骤"><a href="#（3）操作步骤" class="headerlink" title="（3）操作步骤"></a>（3）操作步骤</h2><h3 id="1）部署行为日志生产模拟器"><a href="#1）部署行为日志生产模拟器" class="headerlink" title="1）部署行为日志生产模拟器"></a>1）部署行为日志生产模拟器</h3><p><strong>1.准备一个mysql服务器，并创建一个库：realtimedw</strong></p>
<img src=".\md图/flume.assets\image-20230201000514636.png" alt="image-20230201000514636" style="zoom:80%;" />

<p><strong>2.将realtimedw.sql这个脚本，导入到realtimedw库中</strong></p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230201005947135.png" alt="image-20230201005947135"></p>
<p><strong>3.将t_md_areas.sql这个脚本，导入到realtimedw库中</strong></p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230201010005829.png" alt="image-20230201010005829"></p>
<p><strong>4.准备其他数据文件目录</strong></p>
<p>新建目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/export/data/flume-example-data/loginit</span><br></pre></td></tr></table></figure>

<img src=".\md图/flume.assets\image-20230201010138833.png" alt="image-20230201010138833" style="zoom:80%;" />

<p><strong>5.修改jar包中的配置文件</strong></p>
<p><strong>log_gen_app.jar包中的配置文件修改</strong></p>
<ul>
<li>other.properties</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#logger,kafka</span></span><br><span class="line"><span class="attr">sink.type</span>=<span class="string">logger</span></span><br><span class="line"><span class="comment">#roll console dayroll</span></span><br><span class="line"><span class="attr">logger.type</span>=<span class="string">dayroll</span></span><br><span class="line"></span><br><span class="line"><span class="attr">initdata.releasechannel</span>=<span class="string">/export/data/flume-example-data/loginit/releasechannel.txt</span></span><br><span class="line"><span class="attr">initdata.phoneinfo</span>=<span class="string">/export/data/flume-example-data/loginit/phoneinfo.txt</span></span><br><span class="line"><span class="attr">initdata.eventIds</span>=<span class="string">/export/data/flume-example-data/loginit/eventIds.txt</span></span><br><span class="line"><span class="attr">init.user.area</span>=<span class="string">/export/data/flume-example-data/loginit/area.txt</span></span><br><span class="line"></span><br><span class="line"><span class="attr">db.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/realtimedw?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password</span>=<span class="string">hadoop</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># max concurrent accessor amount</span></span><br><span class="line"><span class="attr">online.max.num</span>=<span class="string">1000</span></span><br></pre></td></tr></table></figure>

<ul>
<li>log4j.properties</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">INFO,trace</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.appender.trace</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.trace.Threshold</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.appender.trace.ImmediateFlush</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">log4j.appender.trace.Target</span>=<span class="string">System.out</span></span><br><span class="line"><span class="attr">log4j.appender.trace.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.trace.layout.ConversionPattern</span>=<span class="string">[%-5p] %d(%r) --&gt; [%t] %l: %m %x %n</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.logger.console</span> = <span class="string">INFO,console</span></span><br><span class="line"><span class="attr">log4j.additivity.console</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">log4j.appender.console</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.console.Threshold</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.appender.console.ImmediateFlush</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">log4j.appender.console.Target</span>=<span class="string">System.out</span></span><br><span class="line"><span class="attr">log4j.appender.console.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.console.layout.ConversionPattern</span>=<span class="string">%m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># log4j.logger.roll = INFO,rollingFile</span></span><br><span class="line"><span class="comment"># log4j.additivity.roll=false</span></span><br><span class="line"><span class="comment"># log4j.appender.rollingFile=org.apache.log4j.RollingFileAppender</span></span><br><span class="line"><span class="comment"># log4j.appender.rollingFile.Threshold=DEBUG</span></span><br><span class="line"><span class="comment"># log4j.appender.rollingFile.ImmediateFlush=true</span></span><br><span class="line"><span class="comment"># log4j.appender.rollingFile.Append=true</span></span><br><span class="line"><span class="comment"># log4j.appender.rollingFile.File=/loggen/logdata/wx/event.log</span></span><br><span class="line"><span class="comment"># log4j.appender.rollingFile.MaxFileSize=120MB</span></span><br><span class="line"><span class="comment"># log4j.appender.rollingFile.MaxBackupIndex=50</span></span><br><span class="line"><span class="comment"># log4j.appender.rollingFile.layout=org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="comment"># log4j.appender.rollingFile.layout.ConversionPattern=%m%n</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.logger.dayroll</span> = <span class="string">INFO,DailyRolling</span></span><br><span class="line"><span class="attr">log4j.additivity.dayroll</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">log4j.appender.DailyRolling</span>=<span class="string">org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.DailyRolling.File</span>=<span class="string">/export/data/flume-example-data/gen_logdata/event_log_app</span></span><br><span class="line"><span class="attr">log4j.appender.DailyRolling.DatePattern</span>=<span class="string">yyyy-MM-dd&#x27;.log&#x27;</span></span><br><span class="line"><span class="attr">log4j.appender.DailyRolling.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.DailyRolling.layout.ConversionPattern</span>=<span class="string">%m%n</span></span><br></pre></td></tr></table></figure>

<p><strong>log_gen_wx.jar包中的配置文件修改</strong></p>
<ul>
<li><p>other.properties与上文一致</p>
</li>
<li><p>log4j.properties 其中一行修改为</p>
</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.appender.DailyRolling.File</span>=<span class="string">/export/data/flume-example-data/gen_logdata/event_log_wx</span></span><br></pre></td></tr></table></figure>

<p><strong>6.上传jar包，执行启动命令</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在/export/data/flume-example-data/loginit 中添加shell文件用以启动日志生成器</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim genapplog.sh</span><br><span class="line"></span><br><span class="line">java -Xss102400k -<span class="built_in">cp</span> log_gen_app.jar cn.doitedu.loggen.entry.GenAppLog 1 &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim genwxlog.sh</span><br><span class="line"></span><br><span class="line">java -Xss102400k -<span class="built_in">cp</span> log_gen_wx.jar cn.doitedu.loggen.entry.GenWxAppLog 1 &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sh genapplog.sh</span><br><span class="line"></span><br><span class="line">sh genwxlog.sh</span><br></pre></td></tr></table></figure>

<img src=".\md图/flume.assets\image-20230201010312246.png" alt="image-20230201010312246" style="zoom: 67%;" />

<p><strong>7.查看日志文件生成效果</strong></p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230201010531192.png" alt="image-20230201010531192"></p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230201010622186.png" alt="image-20230201010622186"></p>
<h3 id="2）上游配置文件：-node1-node2"><a href="#2）上游配置文件：-node1-node2" class="headerlink" title="2）上游配置文件：(node1 node2)"></a>2）上游配置文件：(node1 node2)</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example14-1-Comprehensive-practical.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1 k2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">TAILDIR</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.positionFile</span> = <span class="string">/export/data/flume-example-data/flumedata/taildir_position.json</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups</span> = <span class="string">g1</span></span><br><span class="line"><span class="attr">a1.sources.r1.filegroups.g1</span> =  <span class="string">/export/data/flume-example-data/gen_logdata/event_.*</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors</span> = <span class="string">i1 i2 i3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.type</span> = <span class="string">ccjz.rgzn.flume.EncryptSpecifiedFieldInterceptor$EncryptInterceptorBuilder</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i1.toEncryFieldName</span> = <span class="string">account</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i2.type</span> = <span class="string">ccjz.rgzn.flume.EventTimeStampExtractInterceptor$EventTimestampInterceptorBuilder</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i2.tsFiledName</span> = <span class="string">timeStamp</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i2.keyName</span> = <span class="string">timestamp</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#拥有openid的是wx小程序用户日志</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i3.type</span> = <span class="string">ccjz.rgzn.flume.LogTypeInterceptor$LogTypeInterceptorBuilder</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i3.flag.fieldname</span> = <span class="string">openid</span></span><br><span class="line"><span class="attr">a1.sources.r1.interceptors.i3.headerKey</span> = <span class="string">logtype</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">file</span></span><br><span class="line"><span class="attr">a1.channels.c1.checkpointDir</span> =  <span class="string">/export/data/flume-example-data/flumedata/checkpoint</span></span><br><span class="line"><span class="attr">a1.channels.c1.dataDirs</span> =  <span class="string">/export/data/flume-example-data/flumedata/data</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">2000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hostname</span> = <span class="string">node2</span></span><br><span class="line"><span class="attr">a1.sinks.k1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sinks.k1.batch-size</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k2.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k2.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sinks.k2.hostname</span> = <span class="string">node3</span></span><br><span class="line"><span class="attr">a1.sinks.k2.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sinks.k2.batch-size</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinkgroups</span> = <span class="string">g1</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.sinks</span> = <span class="string">k1 k2</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.type</span> = <span class="string">failover</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.priority.k1</span> = <span class="string">200</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.priority.k2</span> = <span class="string">100</span></span><br><span class="line"><span class="attr">a1.sinkgroups.g1.processor.maxpenalty</span> = <span class="string">5000</span></span><br></pre></td></tr></table></figure>

<h3 id="3）下游配置文件-node2-node3"><a href="#3）下游配置文件-node2-node3" class="headerlink" title="3）下游配置文件(node2 node3)"></a>3）下游配置文件(node2 node3)</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example14-2-Comprehensive-practical.conf</span></span><br><span class="line"><span class="attr">a1.sources</span> = <span class="string">r1</span></span><br><span class="line"><span class="attr">a1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks</span> = <span class="string">k1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sources.r1.type</span> = <span class="string">avro</span></span><br><span class="line"><span class="attr">a1.sources.r1.channels</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sources.r1.bind</span> = <span class="string">0.0.0.0</span></span><br><span class="line"><span class="attr">a1.sources.r1.port</span> = <span class="string">44444</span></span><br><span class="line"><span class="attr">a1.sources.r1.threads</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">a1.sources.r1.batchSize</span> = <span class="string">1000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.channels.c1.type</span> = <span class="string">file</span></span><br><span class="line"><span class="attr">a1.channels.c1.checkpointDir</span> =  <span class="string">/export/data/flume-example-data/flumedata_2/checkpoint</span></span><br><span class="line"><span class="attr">a1.channels.c1.dataDirs</span> =  <span class="string">/export/data/flume-example-data/flumedata_2/data</span></span><br><span class="line"><span class="attr">a1.channels.c1.transactionCapacity</span> = <span class="string">2000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">a1.sinks.k1.channel</span> = <span class="string">c1</span></span><br><span class="line"><span class="attr">a1.sinks.k1.type</span> = <span class="string">hdfs</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.path</span> = <span class="string">hdfs://node1:8020/gen_logdata/%&#123;logtype&#125;/%Y-%m-%d/</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.filePrefix</span> = <span class="string">logdata_</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileSuffix</span> = <span class="string">.log</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollInterval</span> = <span class="string">300</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollSize</span> = <span class="string">268435456</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.rollCount</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.batchSize</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.codeC</span> = <span class="string">gzip</span></span><br><span class="line"><span class="attr">a1.sinks.k1.hdfs.fileType</span> = <span class="string">CompressedStream</span></span><br></pre></td></tr></table></figure>



<h2 id="（4）启动测试"><a href="#（4）启动测试" class="headerlink" title="（4）启动测试"></a>（4）启动测试</h2><ol>
<li><p>先把自定义拦截器代码jar包放入上游（node1）flume的lib目录中；</p>
</li>
<li><p>将各台机器上之前的一些checkpoint、缓存等目录清除；</p>
</li>
<li><p>启动下游的两个agent（node2、node3上）；</p>
</li>
<li><p>在上游的机器上，创建日志数据目录，并写脚本模拟往3类日志中写入日志：</p>
<p><img src="/.%5Cmd%E5%9B%BE/flume.assets%5Cimage-20230131000318670.png" alt="image-20230131000318670"></p>
</li>
<li><p>在上游的所有机器上启动flume agent</p>
</li>
<li><p>到hdfs上观察结果</p>
</li>
<li><p>尝试kill掉下游node2的 agent，看是否能够故障切换</p>
</li>
</ol>

    

    
    <div class="page-reward">
      <a href="javascript:void(0);" class="page-reward-btn tooltip-top" target="_self">
        <div class="tooltip tooltip-east">
          <span class="tooltip-item">
            赏
          </span>
          <span class="tooltip-content">
            <span class="tooltip-text">
              <span class="tooltip-inner">
                <p class="reward-p"><i class="icon icon-quo-left"></i>谢谢你请我吃糖果<i
                    class="icon icon-quo-right"></i></p>
                <div class="reward-box">
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/alipay.jpg">
                    <span class="reward-type">支付宝</span>
                  </div>
                  
                  
                  <div class="reward-box-item">
                    <img class="reward-img" src="/img/weixin.png">
                    <span class="reward-type">微信</span>
                  </div>
                  
                </div>
              </span>
            </span>
          </span>
        </div>
      </a>
    </div>
    

    
    <div class="declare"> 
      <ul class="post-copyright">
        <li>
          <strong>本文作者：</strong>
          John Doe
        </li>
        <li>
          <strong>本文链接：</strong>
          <a href="http://example.com/2024/06/04/flume/" title="" target="_blank">http://example.com/2024/06/04/flume/</a>
        </li>
        
        <li>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，均采用 <a href="https://github.com/JoeyBling/hexo-theme-yilia-plus/blob/master/LICENSE" rel="external nofollow" target="_blank">MIT</a> 许可协议。转载请注明出处！
        </li>
        
      </ul>
    </div>
    

  </div>
  <div class="article-info article-info-index">
    
    
    

    

    
    
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <!-- <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a> -->
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
     <!-- <img src="//pan.baidu.com/share/qrcode?url=http://example.com/2024/06/04/flume/" alt="微信分享二维码"> -->
    </div>
</div>

<div class="mask js-mask"></div>

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>


<nav id="article-nav">
  
  
    <a href="/2024/06/04/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Hello World</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>


<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>














          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018-2024 <a href="http://example.com/" target="_blank">John Doe</a>
    	</div>
      	<div class="footer-right">
			
			
      		GitHub:<a href="https://github.com/JoeyBling/hexo-theme-yilia-plus" target="_blank">hexo-theme-yilia-plus</a> by Litten
      	</div>
    </div>
  </div>
  
  
	<script src="/lib/busuanzi.pure.js"></script>
	
  
  
	
	<span id="busuanzi_container_site_pv" style="display:none">
		本站总访问量<span id="busuanzi_value_site_pv"></span>次	
	        <span class="post-meta-divider" >|</span>
	</span>
  	<span id="busuanzi_container_site_uv" style='display:none'>
  		本站访客数<span id="busuanzi_value_site_uv"></span>人
  	</span>
  
</footer>

    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: true
	}
</script>

<script>!function(r){function e(t){if(i[t])return i[t].exports;var n=i[t]={exports:{},id:t,loaded:!1};return r[t].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};e.m=r,e.c=i,e.p="./",e(0)}([function(t,n,r){r(208),t.exports=r(205)},function(t,n,r){var d=r(3),y=r(46),g=r(26),b=r(27),x=r(47),m="prototype",S=function(t,n,r){var e,i,o,u,c=t&S.F,f=t&S.G,a=t&S.S,s=t&S.P,l=t&S.B,h=f?d:a?d[n]||(d[n]={}):(d[n]||{})[m],v=f?y:y[n]||(y[n]={}),p=v[m]||(v[m]={});for(e in f&&(r=n),r)o=((i=!c&&h&&void 0!==h[e])?h:r)[e],u=l&&i?x(o,d):s&&"function"==typeof o?x(Function.call,o):o,h&&b(h,e,o,t&S.U),v[e]!=o&&g(v,e,u),s&&p[e]!=o&&(p[e]=o)};d.core=y,S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,t.exports=S},function(t,n,r){var e=r(5);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n,r){var e=r(118)("wks"),i=r(79),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(49),i=Math.min;t.exports=function(t){return 0<t?i(e(t),9007199254740991):0}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(174),o=r(53),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(20)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(24);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(22),i=r(60),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(96),i=r(34);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(40)("wks"),i=r(25),o=r(6).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(51);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){var r=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(18);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=!0},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(11),i=r(75);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var o=r(3),u=r(26),c=r(30),f=r(79)("src"),e=r(219),i="toString",a=(""+e).split(i);r(46).inspectSource=function(t){return e.call(t)},(t.exports=function(t,n,r,e){var i="function"==typeof r;i&&(c(r,"name")||u(r,"name",n)),t[n]!==r&&(i&&(c(r,f)||u(r,f,t[n]?""+t[n]:a.join(String(n)))),t===o?t[n]=r:e?t[n]?t[n]=r:u(t,n,r):(delete t[n],u(t,n,r)))})(Function.prototype,i,function(){return"function"==typeof this&&this[f]||e.call(this)})},function(t,n,r){var e=r(1),i=r(4),u=r(51),c=/"/g,o=function(t,n,r,e){var i=String(u(t)),o="<"+n;return""!==r&&(o+=" "+r+'="'+String(e).replace(c,"&quot;")+'"'),o+">"+i+"</"+n+">"};t.exports=function(n,t){var r={};r[n]=t(o),e(e.P+e.F*i(function(){var t=""[n]('"');return t!==t.toLowerCase()||3<t.split('"').length}),"String",r)}},function(t,n,r){var e=r(65),i=r(35);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(117),i=r(75),o=r(33),u=r(53),c=r(30),f=r(174),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(30),i=r(17),o=r(154)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(116),i=r(51);t.exports=function(t){return e(i(t))}},function(t,n){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(9),o=r(16)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(25);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(19),i=r(6),o="__core-js_shared__",u=i[o]||(i[o]={});(t.exports=function(t,n){return u[t]||(u[t]=void 0!==n?n:{})})("versions",[]).push({version:e.version,mode:r(23)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?e:r)(t)}},function(t,n,r){var i=r(18);t.exports=function(t,n){if(!i(t))return t;var r,e;if(n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;if("function"==typeof(r=t.valueOf)&&!i(e=r.call(t)))return e;if(!n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(6),i=r(19),o=r(23),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(16)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){var r=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=r)},function(t,n,r){var o=r(21);t.exports=function(e,i,t){if(o(e),void 0===i)return e;switch(t){case 1:return function(t){return e.call(i,t)};case 2:return function(t,n){return e.call(i,t,n)};case 3:return function(t,n,r){return e.call(i,t,n,r)}}return function(){return e.apply(i,arguments)}}},function(t,n,r){"use strict";var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?e:r)(t)}},function(t,n,r){var x=r(47),m=r(116),S=r(17),w=r(8),e=r(138);t.exports=function(l,t){var h=1==l,v=2==l,p=3==l,d=4==l,y=6==l,g=5==l||y,b=t||e;return function(t,n,r){for(var e,i,o=S(t),u=m(o),c=x(n,r,3),f=w(u.length),a=0,s=h?b(t,f):v?b(t,0):void 0;a<f;a++)if((g||a in u)&&(i=c(e=u[a],a,o),l))if(h)s[a]=i;else if(i)switch(l){case 3:return!0;case 5:return e;case 6:return a;case 2:s.push(e)}else if(d)return!1;return y?-1:p||d?d:s}}},function(t,n){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var i=r(1),o=r(46),u=r(4);t.exports=function(t,n){var r=(o.Object||{})[t]||Object[t],e={};e[t]=n(r),i(i.S+i.F*u(function(){r(1)}),"Object",e)}},function(t,n,r){var i=r(5);t.exports=function(t,n){if(!i(t))return t;var r,e;if(n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;if("function"==typeof(r=t.valueOf)&&!i(e=r.call(t)))return e;if(!n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var d=r(6),y=r(19),g=r(93),b=r(13),x=r(9),m="prototype",S=function(t,n,r){var e,i,o,u=t&S.F,c=t&S.G,f=t&S.S,a=t&S.P,s=t&S.B,l=t&S.W,h=c?y:y[n]||(y[n]={}),v=h[m],p=c?d:f?d[n]:(d[n]||{})[m];for(e in c&&(r=n),r)(i=!u&&p&&void 0!==p[e])&&x(h,e)||(o=i?p[e]:r[e],h[e]=c&&"function"!=typeof p[e]?r[e]:s&&i?g(o,d):l&&p[e]==o?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[m]=e[m],t}(o):a&&"function"==typeof o?g(Function.call,o):o,a&&((h.virtual||(h.virtual={}))[e]=o,t&S.R&&v&&!v[e]&&b(v,e,o)))};S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,t.exports=S},function(t,n,r){var e=r(34);t.exports=function(t){return Object(e(t))}},function(t,n,r){var o=r(196),e=r(1),i=r(118)("metadata"),u=i.store||(i.store=new(r(200))),c=function(t,n,r){var e=u.get(t);if(!e){if(!r)return;u.set(t,e=new o)}var i=e.get(n);if(!i){if(!r)return;e.set(n,i=new o)}return i};t.exports={store:u,map:c,has:function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},get:function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},set:function(t,n,r,e){c(r,e,!0).set(t,n)},keys:function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},key:function(t){return void 0===t||"symbol"==typeof t?t:String(t)},exp:function(t){e(e.S,"Reflect",t)}}},function(t,n,r){"use strict";if(r(10)){var g=r(68),b=r(3),x=r(4),m=r(1),S=r(132),e=r(159),h=r(47),w=r(70),i=r(75),_=r(26),o=r(76),u=r(49),O=r(8),E=r(194),c=r(78),f=r(53),a=r(30),M=r(81),P=r(5),v=r(17),p=r(145),j=r(72),F=r(32),A=r(73).f,d=r(161),s=r(79),l=r(7),y=r(50),I=r(120),L=r(119),N=r(162),T=r(82),k=r(125),R=r(77),C=r(137),D=r(166),G=r(11),W=r(31),U=G.f,V=W.f,B=b.RangeError,q=b.TypeError,z=b.Uint8Array,K="ArrayBuffer",H="Shared"+K,J="BYTES_PER_ELEMENT",$="prototype",Y=Array[$],X=e.ArrayBuffer,Q=e.DataView,Z=y(0),tt=y(2),nt=y(3),rt=y(4),et=y(5),it=y(6),ot=I(!0),ut=I(!1),ct=N.values,ft=N.keys,at=N.entries,st=Y.lastIndexOf,lt=Y.reduce,ht=Y.reduceRight,vt=Y.join,pt=Y.sort,dt=Y.slice,yt=Y.toString,gt=Y.toLocaleString,bt=l("iterator"),xt=l("toStringTag"),mt=s("typed_constructor"),St=s("def_constructor"),wt=S.CONSTR,_t=S.TYPED,Ot=S.VIEW,Et="Wrong length!",Mt=y(1,function(t,n){return It(L(t,t[St]),n)}),Pt=x(function(){return 1===new z(new Uint16Array([1]).buffer)[0]}),jt=!!z&&!!z[$].set&&x(function(){new z(1).set({})}),Ft=function(t,n){var r=u(t);if(r<0||r%n)throw B("Wrong offset!");return r},At=function(t){if(P(t)&&_t in t)return t;throw q(t+" is not a typed array!")},It=function(t,n){if(!(P(t)&&mt in t))throw q("It is not a typed array constructor!");return new t(n)},Lt=function(t,n){return Nt(L(t,t[St]),n)},Nt=function(t,n){for(var r=0,e=n.length,i=It(t,e);r<e;)i[r]=n[r++];return i},Tt=function(t,n,r){U(t,n,{get:function(){return this._d[r]}})},kt=function(t){var n,r,e,i,o,u,c=v(t),f=arguments.length,a=1<f?arguments[1]:void 0,s=void 0!==a,l=d(c);if(null!=l&&!p(l)){for(u=l.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(s&&2<f&&(a=h(a,arguments[2],2)),n=0,r=O(c.length),i=It(this,r);n<r;n++)i[n]=s?a(c[n],n):c[n];return i},Rt=function(){for(var t=0,n=arguments.length,r=It(this,n);t<n;)r[t]=arguments[t++];return r},Ct=!!z&&x(function(){gt.call(new z(1))}),Dt=function(){return gt.apply(Ct?dt.call(At(this)):At(this),arguments)},Gt={copyWithin:function(t,n){return D.call(At(this),t,n,2<arguments.length?arguments[2]:void 0)},every:function(t){return rt(At(this),t,1<arguments.length?arguments[1]:void 0)},fill:function(t){return C.apply(At(this),arguments)},filter:function(t){return Lt(this,tt(At(this),t,1<arguments.length?arguments[1]:void 0))},find:function(t){return et(At(this),t,1<arguments.length?arguments[1]:void 0)},findIndex:function(t){return it(At(this),t,1<arguments.length?arguments[1]:void 0)},forEach:function(t){Z(At(this),t,1<arguments.length?arguments[1]:void 0)},indexOf:function(t){return ut(At(this),t,1<arguments.length?arguments[1]:void 0)},includes:function(t){return ot(At(this),t,1<arguments.length?arguments[1]:void 0)},join:function(t){return vt.apply(At(this),arguments)},lastIndexOf:function(t){return st.apply(At(this),arguments)},map:function(t){return Mt(At(this),t,1<arguments.length?arguments[1]:void 0)},reduce:function(t){return lt.apply(At(this),arguments)},reduceRight:function(t){return ht.apply(At(this),arguments)},reverse:function(){for(var t,n=this,r=At(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(At(this),t,1<arguments.length?arguments[1]:void 0)},sort:function(t){return pt.call(At(this),t)},subarray:function(t,n){var r=At(this),e=r.length,i=c(t,e);return new(L(r,r[St]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,O((void 0===n?e:c(n,e))-i))}},Wt=function(t,n){return Lt(this,dt.call(At(this),t,n))},Ut=function(t){At(this);var n=Ft(arguments[1],1),r=this.length,e=v(t),i=O(e.length),o=0;if(r<i+n)throw B(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(At(this))},keys:function(){return ft.call(At(this))},values:function(){return ct.call(At(this))}},Bt=function(t,n){return P(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return Bt(t,n=f(n,!0))?i(2,t[n]):V(t,n)},zt=function(t,n,r){return!(Bt(t,n=f(n,!0))&&P(r)&&a(r,"value"))||a(r,"get")||a(r,"set")||r.configurable||a(r,"writable")&&!r.writable||a(r,"enumerable")&&!r.enumerable?U(t,n,r):(t[n]=r.value,t)};wt||(W.f=qt,G.f=zt),m(m.S+m.F*!wt,"Object",{getOwnPropertyDescriptor:qt,defineProperty:zt}),x(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Kt=o({},Gt);o(Kt,Vt),_(Kt,bt,Vt.values),o(Kt,{slice:Wt,set:Ut,constructor:function(){},toString:yt,toLocaleString:Dt}),Tt(Kt,"buffer","b"),Tt(Kt,"byteOffset","o"),Tt(Kt,"byteLength","l"),Tt(Kt,"length","e"),U(Kt,xt,{get:function(){return this[_t]}}),t.exports=function(t,l,n,o){var h=t+((o=!!o)?"Clamped":"")+"Array",r="get"+t,u="set"+t,v=b[h],c=v||{},e=v&&F(v),i=!v||!S.ABV,f={},a=v&&v[$],p=function(t,i){U(t,i,{get:function(){return t=i,(n=this._d).v[r](t*l+n.o,Pt);var t,n},set:function(t){return n=i,r=t,e=this._d,o&&(r=(r=Math.round(r))<0?0:255<r?255:255&r),void e.v[u](n*l+e.o,r,Pt);var n,r,e},enumerable:!0})};i?(v=n(function(t,n,r,e){w(t,v,h,"_d");var i,o,u,c,f=0,a=0;if(P(n)){if(!(n instanceof X||(c=M(n))==K||c==H))return _t in n?Nt(v,n):kt.call(v,n);i=n,a=Ft(r,l);var s=n.byteLength;if(void 0===e){if(s%l)throw B(Et);if((o=s-a)<0)throw B(Et)}else if(s<(o=O(e)*l)+a)throw B(Et);u=o/l}else u=E(n),i=new X(o=u*l);for(_(t,"_d",{b:i,o:a,l:o,e:u,v:new Q(i)});f<u;)p(t,f++)}),a=v[$]=j(Kt),_(a,"constructor",v)):x(function(){v(1)})&&x(function(){new v(-1)})&&k(function(t){new v,new v(null),new v(1.5),new v(t)},!0)||(v=n(function(t,n,r,e){var i;return w(t,v,h),P(n)?n instanceof X||(i=M(n))==K||i==H?void 0!==e?new c(n,Ft(r,l),e):void 0!==r?new c(n,Ft(r,l)):new c(n):_t in n?Nt(v,n):kt.call(v,n):new c(E(n))}),Z(e!==Function.prototype?A(c).concat(A(e)):A(c),function(t){t in v||_(v,t,c[t])}),v[$]=a,g||(a.constructor=v));var s=a[bt],d=!!s&&("values"==s.name||null==s.name),y=Vt.values;_(v,mt,!0),_(a,_t,h),_(a,Ot,!0),_(a,St,v),(o?new v(1)[xt]==h:xt in a)||U(a,xt,{get:function(){return h}}),f[h]=v,m(m.G+m.W+m.F*(v!=c),f),m(m.S,h,{BYTES_PER_ELEMENT:l}),m(m.S+m.F*x(function(){c.of.call(v,1)}),h,{from:kt,of:Rt}),J in a||_(a,J,l),m(m.P,h,Gt),R(h),m(m.P+m.F*jt,h,{set:Ut}),m(m.P+m.F*!d,h,Vt),g||a.toString==yt||(a.toString=yt),m(m.P+m.F*x(function(){new v(1).slice()}),h,{slice:Wt}),m(m.P+m.F*(x(function(){return[1,2].toLocaleString()!=new v([1,2]).toLocaleString()})||!x(function(){a.toLocaleString.call([1,2])})),h,{toLocaleString:Dt}),T[h]=d?s:y,g||d||_(a,bt,y)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(18),i=r(6).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(20)(function(){return 7!=Object.defineProperty(r(59)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var x=r(23),m=r(54),S=r(66),w=r(13),_=r(36),O=r(98),E=r(38),M=r(104),P=r(16)("iterator"),j=!([].keys&&"next"in[].keys()),F="values",A=function(){return this};t.exports=function(t,n,r,e,i,o,u){O(r,n,e);var c,f,a,s=function(t){if(!j&&t in p)return p[t];switch(t){case"keys":case F:return function(){return new r(this,t)}}return function(){return new r(this,t)}},l=n+" Iterator",h=i==F,v=!1,p=t.prototype,d=p[P]||p["@@iterator"]||i&&p[i],y=d||s(i),g=i?h?s("entries"):y:void 0,b="Array"==n&&p.entries||d;if(b&&((a=M(b.call(new t)))!==Object.prototype&&a.next&&(E(a,l,!0),x||"function"==typeof a[P]||w(a,P,A))),h&&d&&d.name!==F&&(v=!0,y=function(){return d.call(this)}),x&&!u||!j&&!v&&p[P]||w(p,P,y),_[n]=y,_[l]=A,i)if(c={values:h?y:s(F),keys:o?y:s("keys"),entries:g},u)for(f in c)f in p||S(p,f,c[f]);else m(m.P+m.F*(j||v),n,c);return c}},function(t,n,e){var i=e(22),o=e(101),u=e(35),c=e(39)("IE_PROTO"),f=function(){},a="prototype",s=function(){var t,n=e(59)("iframe"),r=u.length;for(n.style.display="none",e(95).appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),s=t.F;r--;)delete s[a][u[r]];return s()};t.exports=Object.create||function(t,n){var r;return null!==t?(f[a]=i(t),r=new f,f[a]=null,r[c]=t):r=s(),void 0===n?r:o(r,n)}},function(t,n,r){var e=r(65),i=r(35).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var u=r(9),c=r(15),f=r(92)(!1),a=r(39)("IE_PROTO");t.exports=function(t,n){var r,e=c(t),i=0,o=[];for(r in e)r!=a&&u(e,r)&&o.push(r);for(;n.length>i;)u(e,r=n[i++])&&(~f(o,r)||o.push(r));return o}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;null==i[e]&&r(26)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n){t.exports=!1},function(t,n,r){var e=r(79)("meta"),i=r(5),o=r(30),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return a&&l.NEED&&f(t)&&!o(t,e)&&s(t),t}}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n,r){var h=r(47),v=r(177),p=r(145),d=r(2),y=r(8),g=r(161),b={},x={};(n=t.exports=function(t,n,r,e,i){var o,u,c,f,a=i?function(){return t}:g(t),s=h(r,e,n?2:1),l=0;if("function"!=typeof a)throw TypeError(t+" is not iterable!");if(p(a)){for(o=y(t.length);l<o;l++)if((f=n?s(d(u=t[l])[0],u[1]):s(t[l]))===b||f===x)return f}else for(c=a.call(t);!(u=c.next()).done;)if((f=v(c,s,u.value,n))===b||f===x)return f}).BREAK=b,n.RETURN=x},function(t,n,e){var i=e(2),o=e(183),u=e(141),c=e(154)("IE_PROTO"),f=function(){},a="prototype",s=function(){var t,n=e(140)("iframe"),r=u.length;for(n.style.display="none",e(143).appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),s=t.F;r--;)delete s[a][u[r]];return s()};t.exports=Object.create||function(t,n){var r;return null!==t?(f[a]=i(t),r=new f,f[a]=null,r[c]=t):r=s(),void 0===n?r:o(r,n)}},function(t,n,r){var e=r(185),i=r(141).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(185),i=r(141);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,r){var i=r(27);t.exports=function(t,n,r){for(var e in n)i(t,e,n[e],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(49),i=Math.max,o=Math.min;t.exports=function(t,n){return(t=e(t))<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(5);t.exports=function(t,n){if(!e(t)||t._t!==n)throw TypeError("Incompatible receiver, "+n+" required!");return t}},function(t,n,r){var i=r(45),o=r(7)("toStringTag"),u="Arguments"==i(function(){return arguments}());t.exports=function(t){var n,r,e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,n){try{return t[n]}catch(t){}}(n=Object(t),o))?r:u?i(n):"Object"==(e=i(n))&&"function"==typeof n.callee?"Arguments":e}},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(30),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var u=r(1),e=r(51),c=r(4),f=r(157),i="["+f+"]",o=RegExp("^"+i+i+"*"),a=RegExp(i+i+"*$"),s=function(t,n,r){var e={},i=c(function(){return!!f[t]()||"​"!="​"[t]()}),o=e[t]=i?n(l):f[t];r&&(e[r]=o),u(u.P+u.F*i,"String",e)},l=s.trim=function(t,n){return t=String(e(t)),1&n&&(t=t.replace(o,"")),2&n&&(t=t.replace(a,"")),t};t.exports=s},function(t,n,r){t.exports={default:r(88),__esModule:!0}},function(t,n,r){t.exports={default:r(89),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=e(r(86)),o=e(r(85)),u="function"==typeof o.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":typeof t};n.default="function"==typeof o.default&&"symbol"===u(i.default)?function(t){return void 0===t?"undefined":u(t)}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":void 0===t?"undefined":u(t)}},function(t,n,r){r(111),r(109),r(112),r(113),t.exports=r(19).Symbol},function(t,n,r){r(110),r(114),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var f=r(15),a=r(107),s=r(106);t.exports=function(c){return function(t,n,r){var e,i=f(t),o=a(i.length),u=s(r,o);if(c&&n!=n){for(;u<o;)if((e=i[u++])!=e)return!0}else for(;u<o;u++)if((c||u in i)&&i[u]===n)return c||u||0;return!c&&-1}}},function(t,n,r){var o=r(90);t.exports=function(e,i,t){if(o(e),void 0===i)return e;switch(t){case 1:return function(t){return e.call(i,t)};case 2:return function(t,n){return e.call(i,t,n)};case 3:return function(t,n,r){return e.call(i,t,n,r)}}return function(){return e.apply(i,arguments)}}},function(t,n,r){var c=r(29),f=r(64),a=r(37);t.exports=function(t){var n=c(t),r=f.f;if(r)for(var e,i=r(t),o=a.f,u=0;i.length>u;)o.call(t,e=i[u++])&&n.push(e);return n}},function(t,n,r){var e=r(6).document;t.exports=e&&e.documentElement},function(t,n,r){var e=r(58);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(58);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(62),i=r(24),o=r(38),u={};r(13)(u,r(16)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(25)("meta"),i=r(18),o=r(9),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(20)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return a&&l.NEED&&f(t)&&!o(t,e)&&s(t),t}}},function(t,n,r){var u=r(14),c=r(22),f=r(29);t.exports=r(12)?Object.defineProperties:function(t,n){c(t);for(var r,e=f(n),i=e.length,o=0;o<i;)u.f(t,r=e[o++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(24),o=r(15),u=r(42),c=r(9),f=r(60),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(15),i=r(63).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?function(t){try{return i(t)}catch(t){return u.slice()}}(t):i(e(t))}},function(t,n,r){var e=r(9),i=r(55),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var f=r(41),a=r(34);t.exports=function(c){return function(t,n){var r,e,i=String(a(t)),o=f(n),u=i.length;return o<0||u<=o?c?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===u||(e=i.charCodeAt(o+1))<56320||57343<e?c?i.charAt(o):r:c?i.slice(o,o+2):e-56320+(r-55296<<10)+65536}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return(t=e(t))<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return 0<t?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(91),i=r(99),o=r(36),u=r(15);t.exports=r(61)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):i(0,"keys"==n?r:"values"==n?t[r]:[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(105)(!0);r(61)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(6),u=r(9),i=r(12),o=r(54),c=r(66),f=r(100).KEY,a=r(20),s=r(40),l=r(38),h=r(25),v=r(16),p=r(44),d=r(43),y=r(94),g=r(97),b=r(22),x=r(18),m=r(55),S=r(15),w=r(42),_=r(24),O=r(62),E=r(103),M=r(102),P=r(64),j=r(14),F=r(29),A=M.f,I=j.f,L=E.f,N=e.Symbol,T=e.JSON,k=T&&T.stringify,R="prototype",C=v("_hidden"),D=v("toPrimitive"),G={}.propertyIsEnumerable,W=s("symbol-registry"),U=s("symbols"),V=s("op-symbols"),B=Object[R],q="function"==typeof N&&!!P.f,z=e.QObject,K=!z||!z[R]||!z[R].findChild,H=i&&a(function(){return 7!=O(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=A(B,n);e&&delete B[n],I(t,n,r),e&&t!==B&&I(B,n,e)}:I,J=function(t){var n=U[t]=O(N[R]);return n._k=t,n},$=q&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===B&&Y(V,n,r),b(t),n=w(n,!0),b(r),u(U,n)?(r.enumerable?(u(t,C)&&t[C][n]&&(t[C][n]=!1),r=O(r,{enumerable:_(0,!1)})):(u(t,C)||I(t,C,_(1,{})),t[C][n]=!0),H(t,n,r)):I(t,n,r)},X=function(t,n){b(t);for(var r,e=y(n=S(n)),i=0,o=e.length;i<o;)Y(t,r=e[i++],n[r]);return t},Q=function(t){var n=G.call(this,t=w(t,!0));return!(this===B&&u(U,t)&&!u(V,t))&&(!(n||!u(this,t)||!u(U,t)||u(this,C)&&this[C][t])||n)},Z=function(t,n){if(t=S(t),n=w(n,!0),t!==B||!u(U,n)||u(V,n)){var r=A(t,n);return!r||!u(U,n)||u(t,C)&&t[C][n]||(r.enumerable=!0),r}},tt=function(t){for(var n,r=L(S(t)),e=[],i=0;r.length>i;)u(U,n=r[i++])||n==C||n==f||e.push(n);return e},nt=function(t){for(var n,r=t===B,e=L(r?V:S(t)),i=[],o=0;e.length>o;)!u(U,n=e[o++])||r&&!u(B,n)||i.push(U[n]);return i};q||(c((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var n=h(0<arguments.length?arguments[0]:void 0),r=function(t){this===B&&r.call(V,t),u(this,C)&&u(this[C],n)&&(this[C][n]=!1),H(this,n,_(1,t))};return i&&K&&H(B,n,{configurable:!0,set:r}),J(n)})[R],"toString",function(){return this._k}),M.f=Z,j.f=Y,r(63).f=E.f=tt,r(37).f=Q,P.f=nt,i&&!r(23)&&c(B,"propertyIsEnumerable",Q,!0),p.f=function(t){return J(v(t))}),o(o.G+o.W+o.F*!q,{Symbol:N});for(var rt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;rt.length>et;)v(rt[et++]);for(var it=F(v.store),ot=0;it.length>ot;)d(it[ot++]);o(o.S+o.F*!q,"Symbol",{for:function(t){return u(W,t+="")?W[t]:W[t]=N(t)},keyFor:function(t){if(!$(t))throw TypeError(t+" is not a symbol!");for(var n in W)if(W[n]===t)return n},useSetter:function(){K=!0},useSimple:function(){K=!1}}),o(o.S+o.F*!q,"Object",{create:function(t,n){return void 0===n?O(t):X(O(t),n)},defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:tt,getOwnPropertySymbols:nt});var ut=a(function(){P.f(1)});o(o.S+o.F*ut,"Object",{getOwnPropertySymbols:function(t){return P.f(m(t))}}),T&&o(o.S+o.F*(!q||a(function(){var t=N();return"[null]"!=k([t])||"{}"!=k({a:t})||"{}"!=k(Object(t))})),"JSON",{stringify:function(t){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);if(r=n=e[1],(x(n)||void 0!==t)&&!$(t))return g(n)||(n=function(t,n){if("function"==typeof r&&(n=r.call(this,t,n)),!$(n))return n}),e[1]=n,k.apply(T,e)}}),N[R][D]||r(13)(N[R],D,N[R].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(108);for(var e=r(6),i=r(13),o=r(36),u=r(16)("toStringTag"),c="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),f=0;f<c.length;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(46),i=r(3),o="__core-js_shared__",u=i[o]||(i[o]={});(t.exports=function(t,n){return u[t]||(u[t]=void 0!==n?n:{})})("versions",[]).push({version:e.version,mode:r(68)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,n,r){var i=r(2),o=r(21),u=r(7)("species");t.exports=function(t,n){var r,e=i(t).constructor;return void 0===e||null==(r=i(e)[u])?n:o(r)}},function(t,n,r){var f=r(33),a=r(8),s=r(78);t.exports=function(c){return function(t,n,r){var e,i=f(t),o=a(i.length),u=s(r,o);if(c&&n!=n){for(;u<o;)if((e=i[u++])!=e)return!0}else for(;u<o;u++)if((c||u in i)&&i[u]===n)return c||u||0;return!c&&-1}}},function(t,n,r){"use strict";var g=r(3),b=r(1),x=r(27),m=r(76),S=r(69),w=r(71),_=r(70),O=r(5),E=r(4),M=r(125),P=r(83),j=r(144);t.exports=function(e,t,n,r,i,o){var u=g[e],c=u,f=i?"set":"add",a=c&&c.prototype,s={},l=function(t){var r=a[t];x(a,t,"delete"==t?function(t){return!(o&&!O(t))&&r.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!O(t))&&r.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!O(t)?void 0:r.call(this,0===t?0:t)}:"add"==t?function(t){return r.call(this,0===t?0:t),this}:function(t,n){return r.call(this,0===t?0:t,n),this})};if("function"==typeof c&&(o||a.forEach&&!E(function(){(new c).entries().next()}))){var h=new c,v=h[f](o?{}:-0,1)!=h,p=E(function(){h.has(1)}),d=M(function(t){new c(t)}),y=!o&&E(function(){for(var t=new c,n=5;n--;)t[f](n,n);return!t.has(-0)});d||(((c=t(function(t,n){_(t,c,e);var r=j(new u,t,c);return null!=n&&w(n,i,r[f],r),r})).prototype=a).constructor=c),(p||y)&&(l("delete"),l("has"),i&&l("get")),(y||v)&&l(f),o&&a.clear&&delete a.clear}else c=r.getConstructor(t,e,i,f),m(c.prototype,n),S.NEED=!0;return P(c,e),s[e]=c,b(b.G+b.W+b.F*(c!=u),s),o||r.setStrong(c,e,i),c}},function(t,n,r){"use strict";r(197);var s=r(27),l=r(26),h=r(4),v=r(51),p=r(7),d=r(152),y=p("species"),g=!h(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}),b=function(){var t=/(?:)/,n=t.exec;t.exec=function(){return n.apply(this,arguments)};var r="ab".split(t);return 2===r.length&&"a"===r[0]&&"b"===r[1]}();t.exports=function(r,t,n){var e=p(r),o=!h(function(){var t={};return t[e]=function(){return 7},7!=""[r](t)}),i=o?!h(function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===r&&(n.constructor={},n.constructor[y]=function(){return n}),n[e](""),!t}):void 0;if(!o||!i||"replace"===r&&!g||"split"===r&&!b){var u=/./[e],c=n(v,e,""[r],function(t,n,r,e,i){return n.exec===d?o&&!i?{done:!0,value:u.call(n,r,e)}:{done:!0,value:t.call(r,n,e)}:{done:!1}}),f=c[0],a=c[1];s(String.prototype,r,f),l(RegExp.prototype,e,2==t?function(t,n){return a.call(t,this,n)}:function(t){return a.call(t,this)})}}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){var e=r(5),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var o=r(7)("iterator"),u=!1;try{var e=[7][o]();e.return=function(){u=!0},Array.from(e,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!u)return!1;var r=!1;try{var e=[7],i=e[o]();i.next=function(){return{done:r=!0}},e[o]=function(){return i},t(e)}catch(t){}return r}},function(t,n,r){"use strict";t.exports=r(68)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){"use strict";var i=r(81),o=RegExp.prototype.exec;t.exports=function(t,n){var r=t.exec;if("function"==typeof r){var e=r.call(t,n);if("object"!=typeof e)throw new TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==i(t))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(t,n)}},function(t,n,r){"use strict";var e=r(1),u=r(21),c=r(47),f=r(71);t.exports=function(t){e(e.S,t,{from:function(t){var n,r,e,i,o=arguments[1];return u(this),(n=void 0!==o)&&u(o),null==t?new this:(r=[],n?(e=0,i=c(o,arguments[2],2),f(t,!1,function(t){r.push(i(t,e++))})):f(t,!1,r.push,r),new this(r))}})}},function(t,n,r){"use strict";var e=r(1);t.exports=function(t){e(e.S,t,{of:function(){for(var t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return new this(n)}})}},function(t,n,r){var f=r(49),a=r(51);t.exports=function(c){return function(t,n){var r,e,i=String(a(t)),o=f(n),u=i.length;return o<0||u<=o?c?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===u||(e=i.charCodeAt(o+1))<56320||57343<e?c?i.charAt(o):r:c?i.slice(o,o+2):e-56320+(r-55296<<10)+65536}}},function(t,n,r){for(var e,i=r(3),o=r(26),u=r(79),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n,r){var e=r(3).navigator;t.exports=e&&e.userAgent||""},function(t,n){"use strict";var r,e={versions:(r=window.navigator.userAgent,{trident:-1<r.indexOf("Trident"),presto:-1<r.indexOf("Presto"),webKit:-1<r.indexOf("AppleWebKit"),gecko:-1<r.indexOf("Gecko")&&-1==r.indexOf("KHTML"),mobile:!!r.match(/AppleWebKit.*Mobile.*/),ios:!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<r.indexOf("Android")||-1<r.indexOf("Linux"),iPhone:-1<r.indexOf("iPhone")||-1<r.indexOf("Mac"),iPad:-1<r.indexOf("iPad"),webApp:-1==r.indexOf("Safari"),weixin:-1==r.indexOf("MicroMessenger")})};t.exports=e},function(t,n,r){"use strict";var e,i=r(87),l=(e=i)&&e.__esModule?e:{default:e},h=function(){function n(t,n,r){return n||r?String.fromCharCode(n||r):o[t]||t}function r(t){return s[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,i=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},u=/\u00a0/g,c=/<br\s*\/?>/gi,f=/\r?\n/g,a=/\s/g,s={};for(var t in o)s[o[t]]=t;return o["&apos;"]="'",s["'"]="&#39;",{encode:function(t){return t?(""+t).replace(i,r).replace(f,"<br/>").replace(a,"&nbsp;"):""},decode:function(t){return t?(""+t).replace(c,"\n").replace(e,n).replace(u," "):""},encodeBase16:function(t){if(!t)return t;for(var n=[],r=0,e=(t+="").length;r<e;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;for(var n=[],r=0,e=(t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")})).length;r<e;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;for(var n=[],r=0,e=(t+="").length;r<e;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;n<r;n++)t[n]=h.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,l.default)(t)))for(var e in t)t[e]=h.encodeObject(t[e]);else if("string"==typeof t)return h.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=h},function(t,n,r){"use strict";var e=r(131)(!0);t.exports=function(t,n,r){return n+(r?e(t,n).length:1)}},function(t,n,r){"use strict";var c=r(17),f=r(78),a=r(8);t.exports=function(t){for(var n=c(this),r=a(n.length),e=arguments.length,i=f(1<e?arguments[1]:void 0,r),o=2<e?arguments[2]:void 0,u=void 0===o?r:f(o,r);i<u;)n[i++]=t;return n}},function(t,n,r){var e=r(215);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(11),i=r(75);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(5),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(n){var r=/./;try{"/./"[n](r)}catch(t){try{return r[e]=!1,!"/./"[n](r)}catch(n){}}return!0}},function(t,n,r){var e=r(3).document;t.exports=e&&e.documentElement},function(t,n,r){var o=r(5),u=r(153).set;t.exports=function(t,n,r){var e,i=n.constructor;return i!==r&&"function"==typeof i&&(e=i.prototype)!==r.prototype&&o(e)&&u&&u(t,e),t}},function(t,n,r){var e=r(82),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){"use strict";var e=r(72),i=r(75),o=r(83),u={};r(26)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var x=r(68),m=r(1),S=r(27),w=r(26),_=r(82),O=r(146),E=r(83),M=r(32),P=r(7)("iterator"),j=!([].keys&&"next"in[].keys()),F="values",A=function(){return this};t.exports=function(t,n,r,e,i,o,u){O(r,n,e);var c,f,a,s=function(t){if(!j&&t in p)return p[t];switch(t){case"keys":case F:return function(){return new r(this,t)}}return function(){return new r(this,t)}},l=n+" Iterator",h=i==F,v=!1,p=t.prototype,d=p[P]||p["@@iterator"]||i&&p[i],y=d||s(i),g=i?h?s("entries"):y:void 0,b="Array"==n&&p.entries||d;if(b&&((a=M(b.call(new t)))!==Object.prototype&&a.next&&(E(a,l,!0),x||"function"==typeof a[P]||w(a,P,A))),h&&d&&d.name!==F&&(v=!0,y=function(){return d.call(this)}),x&&!u||!j&&!v&&p[P]||w(p,P,y),_[n]=y,_[l]=A,i)if(c={values:h?y:s(F),keys:o?y:s("keys"),entries:g},u)for(f in c)f in p||S(p,f,c[f]);else m(m.P+m.F*(j||v),n,c);return c}},function(t,n){var r=Math.expm1;t.exports=!r||22025.465794806718<r(10)||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:-1e-6<t&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var c=r(3),f=r(158).set,a=c.MutationObserver||c.WebKitMutationObserver,s=c.process,l=c.Promise,h="process"==r(45)(s);t.exports=function(){var r,e,i,t=function(){var t,n;for(h&&(t=s.domain)&&t.exit();r;){n=r.fn,r=r.next;try{n()}catch(t){throw r?i():e=void 0,t}}e=void 0,t&&t.enter()};if(h)i=function(){s.nextTick(t)};else if(!a||c.navigator&&c.navigator.standalone)if(l&&l.resolve){var n=l.resolve(void 0);i=function(){n.then(t)}}else i=function(){f.call(c,t)};else{var o=!0,u=document.createTextNode("");new a(t).observe(u,{characterData:!0}),i=function(){u.data=o=!o}}return function(t){var n={fn:t,next:void 0};e&&(e.next=n),r||(r=n,i()),e=n}}},function(t,n,r){"use strict";function e(t){var r,e;this.promise=new t(function(t,n){if(void 0!==r||void 0!==e)throw TypeError("Bad Promise constructor");r=t,e=n}),this.resolve=i(r),this.reject=i(e)}var i=r(21);t.exports.f=function(t){return new e(t)}},function(t,n,r){"use strict";var e,i,u=r(115),c=RegExp.prototype.exec,f=String.prototype.replace,o=c,a="lastIndex",s=(e=/a/,i=/b*/g,c.call(e,"a"),c.call(i,"a"),0!==e[a]||0!==i[a]),l=void 0!==/()??/.exec("")[1];(s||l)&&(o=function(t){var n,r,e,i,o=this;return l&&(r=new RegExp("^"+o.source+"$(?!\\s)",u.call(o))),s&&(n=o[a]),e=c.call(o,t),s&&e&&(o[a]=o.global?e.index+e[0].length:n),l&&e&&1<e.length&&f.call(e[0],r,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(e[i]=void 0)}),e}),t.exports=o},function(t,n,i){var r=i(5),e=i(2),o=function(t,n){if(e(t),!r(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,r,e){try{(e=i(47)(Function.call,i(31).f(Object.prototype,"__proto__").set,2))(t,[]),r=!(t instanceof Array)}catch(t){r=!0}return function(t,n){return o(t,n),r?t.__proto__=n:e(t,n),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(118)("keys"),i=r(79);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(124),i=r(51);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var i=r(49),o=r(51);t.exports=function(t){var n=String(o(this)),r="",e=i(t);if(e<0||e==1/0)throw RangeError("Count can't be negative");for(;0<e;(e>>>=1)&&(n+=n))1&e&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(47),c=r(175),f=r(143),a=r(140),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=s.Dispatch,y=0,g={},b="onreadystatechange",x=function(){var t=+this;if(g.hasOwnProperty(t)){var n=g[t];delete g[t],n()}},m=function(t){x.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return g[++y]=function(){c("function"==typeof t?t:Function(t),n)},e(y),y},v=function(t){delete g[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(x,t,1))}:d&&d.now?e=function(t){d.now(u(x,t,1))}:p?(o=(i=new p).port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=b in a("script")?function(t){f.appendChild(a("script"))[b]=function(){f.removeChild(this),x.call(t)}}:function(t){setTimeout(u(x,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";function e(t,n,r){var e,i,o,u=new Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?W(2,-24)-W(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for((t=G(t))!=t||t===C?(i=t!=t?1:0,e=f):(e=U(V(t)/B),t*(o=W(2,-e))<1&&(e--,o*=2),2<=(t+=1<=e+a?s/o:s*W(2,1-a))*o&&(e++,o/=2),f<=e+a?(i=0,e=f):1<=e+a?(i=(t*o-1)*W(2,n),e+=a):(i=t*W(2,a-1)*W(2,n),e=0));8<=n;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;0<c;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u}function i(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;0<c;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;0<c;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-C:C;e+=W(2,n),s-=u}return(a?-1:1)*e*W(2,s-n)}function o(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function u(t){return[255&t]}function c(t){return[255&t,t>>8&255]}function f(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function a(t){return e(t,52,8)}function s(t){return e(t,23,4)}function l(t,n,r){M(t[I],n,{get:function(){return this[r]}})}function h(t,n,r,e){var i=O(+r);if(i+n>t[H])throw R(L);var o=t[K]._b,u=i+t[J],c=o.slice(u,u+n);return e?c:c.reverse()}function v(t,n,r,e,i,o){var u=O(+r);if(u+n>t[H])throw R(L);for(var c=t[K]._b,f=u+t[J],a=e(+i),s=0;s<n;s++)c[f+s]=a[o?s:n-s-1]}var p=r(3),d=r(10),y=r(68),g=r(132),b=r(26),x=r(76),m=r(4),S=r(70),w=r(49),_=r(8),O=r(194),E=r(73).f,M=r(11).f,P=r(137),j=r(83),F="ArrayBuffer",A="DataView",I="prototype",L="Wrong index!",N=p[F],T=p[A],k=p.Math,R=p.RangeError,C=p.Infinity,D=N,G=k.abs,W=k.pow,U=k.floor,V=k.log,B=k.LN2,q="byteLength",z="byteOffset",K=d?"_b":"buffer",H=d?"_l":q,J=d?"_o":z;if(g.ABV){if(!m(function(){N(1)})||!m(function(){new N(-1)})||m(function(){return new N,new N(1.5),new N(NaN),N.name!=F})){for(var $,Y=(N=function(t){return S(this,N),new D(O(t))})[I]=D[I],X=E(D),Q=0;X.length>Q;)($=X[Q++])in N||b(N,$,D[$]);y||(Y.constructor=N)}var Z=new T(new N(2)),tt=T[I].setInt8;Z.setInt8(0,2147483648),Z.setInt8(1,2147483649),!Z.getInt8(0)&&Z.getInt8(1)||x(T[I],{setInt8:function(t,n){tt.call(this,t,n<<24>>24)},setUint8:function(t,n){tt.call(this,t,n<<24>>24)}},!0)}else N=function(t){S(this,N,F);var n=O(t);this._b=P.call(new Array(n),0),this[H]=n},T=function(t,n,r){S(this,T,A),S(t,N,A);var e=t[H],i=w(n);if(i<0||e<i)throw R("Wrong offset!");if(e<i+(r=void 0===r?e-i:_(r)))throw R("Wrong length!");this[K]=t,this[J]=i,this[H]=r},d&&(l(N,q,"_l"),l(T,"buffer","_b"),l(T,q,"_l"),l(T,z,"_o")),x(T[I],{getInt8:function(t){return h(this,1,t)[0]<<24>>24},getUint8:function(t){return h(this,1,t)[0]},getInt16:function(t){var n=h(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=h(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return o(h(this,4,t,arguments[1]))},getUint32:function(t){return o(h(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return i(h(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return i(h(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){v(this,1,t,u,n)},setUint8:function(t,n){v(this,1,t,u,n)},setInt16:function(t,n){v(this,2,t,c,n,arguments[2])},setUint16:function(t,n){v(this,2,t,c,n,arguments[2])},setInt32:function(t,n){v(this,4,t,f,n,arguments[2])},setUint32:function(t,n){v(this,4,t,f,n,arguments[2])},setFloat32:function(t,n){v(this,4,t,s,n,arguments[2])},setFloat64:function(t,n){v(this,8,t,a,n,arguments[2])}});j(N,F),j(T,A),b(T[I],g.VIEW,!0),n[F]=N,n[A]=T},function(t,n,r){var e=r(3),i=r(46),o=r(68),u=r(195),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(81),i=r(7)("iterator"),o=r(82);t.exports=r(46).getIteratorMethod=function(t){if(null!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(67),i=r(178),o=r(82),u=r(33);t.exports=r(147)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):i(0,"keys"==n?r:"values"==n?t[r]:[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){t.exports=function(t,n){t.classList?t.classList.add(n):t.className+=" "+n}},function(t,n){t.exports=function(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var a=r(17),s=r(78),l=r(8);t.exports=[].copyWithin||function(t,n){var r=a(this),e=l(r.length),i=s(t,e),o=s(n,e),u=2<arguments.length?arguments[2]:void 0,c=Math.min((void 0===u?e:s(u,e))-o,e-i),f=1;for(o<i&&i<o+c&&(f=-1,o+=c-1,i+=c-1);0<c--;)o in r?r[i]=r[o]:delete r[i],i+=f,o+=f;return r}},function(t,n,r){var e=r(71);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var s=r(21),l=r(17),h=r(116),v=r(8);t.exports=function(t,n,r,e,i){s(n);var o=l(t),u=h(o),c=v(o.length),f=i?c-1:0,a=i?-1:1;if(r<2)for(;;){if(f in u){e=u[f],f+=a;break}if(f+=a,i?f<0:c<=f)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=f:f<c;f+=a)f in u&&(e=n(e,u[f],f,o));return e}},function(t,n,r){"use strict";var o=r(21),u=r(5),c=r(175),f=[].slice,a={};t.exports=Function.bind||function(n){var r=o(this),e=f.call(arguments,1),i=function(){var t=e.concat(f.call(arguments));return this instanceof i?function(t,n,r){if(!(n in a)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";a[n]=Function("F,a","return new F("+e.join(",")+")")}return a[n](t,r)}(r,t.length,t):c(r,t,n)};return u(r.prototype)&&(i.prototype=r.prototype),i}},function(t,n,r){"use strict";var u=r(11).f,c=r(72),f=r(76),a=r(47),s=r(70),l=r(71),e=r(147),i=r(178),o=r(77),h=r(10),v=r(69).fastKey,p=r(80),d=h?"_s":"size",y=function(t,n){var r,e=v(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,o,r,e){var i=t(function(t,n){s(t,i,o,"_i"),t._t=o,t._i=c(null),t._f=void 0,t._l=void 0,t[d]=0,null!=n&&l(n,r,t[e],t)});return f(i.prototype,{clear:function(){for(var t=p(this,o),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=p(this,o),r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){p(this,o);for(var n,r=a(t,1<arguments.length?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(p(this,o),t)}}),h&&u(i.prototype,"size",{get:function(){return p(this,o)[d]}}),i},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=v(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,r,n){e(t,r,function(t,n){this._t=p(t,r),this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?i(0,"keys"==n?r.k:"values"==n?r.v:[r.k,r.v]):(t._t=void 0,i(1))},n?"entries":"values",!n,!0),o(r)}}},function(t,n,r){var e=r(81),i=r(167);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var u=r(76),c=r(69).getWeak,i=r(2),f=r(5),a=r(70),s=r(71),e=r(50),l=r(30),h=r(80),o=e(5),v=e(6),p=0,d=function(t){return t._l||(t._l=new y)},y=function(){this.a=[]},g=function(t,n){return o(t.a,function(t){return t[0]===n})};y.prototype={get:function(t){var n=g(this,t);if(n)return n[1]},has:function(t){return!!g(this,t)},set:function(t,n){var r=g(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(n){var t=v(this.a,function(t){return t[0]===n});return~t&&this.a.splice(t,1),!!~t}},t.exports={getConstructor:function(t,r,e,i){var o=t(function(t,n){a(t,o,r,"_i"),t._t=r,t._i=p++,t._l=void 0,null!=n&&s(n,e,t[i],t)});return u(o.prototype,{delete:function(t){if(!f(t))return!1;var n=c(t);return!0===n?d(h(this,r)).delete(t):n&&l(n,this._i)&&delete n[this._i]},has:function(t){if(!f(t))return!1;var n=c(t);return!0===n?d(h(this,r)).has(t):n&&l(n,this._i)}}),o},def:function(t,n,r){var e=c(i(n),!0);return!0===e?d(t).set(n,r):e[t._i]=r,t},ufstore:d}},function(t,n,r){"use strict";var p=r(123),d=r(5),y=r(8),g=r(47),b=r(7)("isConcatSpreadable");t.exports=function t(n,r,e,i,o,u,c,f){for(var a,s,l=o,h=0,v=!!c&&g(c,f,3);h<i;){if(h in e){if(a=v?v(e[h],h,r):e[h],s=!1,d(a)&&(s=void 0!==(s=a[b])?!!s:p(a)),s&&0<u)l=t(n,r,a,y(a.length),l,u-1)-1;else{if(9007199254740991<=l)throw TypeError();n[l]=a}l++}h++}return l}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(140)("div"),"a",{get:function(){return 7}}).a})},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(5),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var o=r(2);t.exports=function(t,n,r,e){try{return e?n(o(r)[0],r[1]):n(r)}catch(n){var i=t.return;throw void 0!==i&&o(i.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var o=r(149),e=Math.pow,u=e(2,-52),c=e(2,-23),f=e(2,127)*(2-c),a=e(2,-126);t.exports=Math.fround||function(t){var n,r,e=Math.abs(t),i=o(t);return e<a?i*(e/a/c+1/u-1/u)*a*c:f<(r=(n=(1+c/u)*e)-(n-e))||r!=r?i*(1/0):i*r}},function(t,n){t.exports=Math.log1p||function(t){return-1e-8<(t=+t)&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n){t.exports=Math.scale||function(t,n,r,e,i){return 0===arguments.length||t!=t||n!=n||r!=r||e!=e||i!=i?NaN:t===1/0||t===-1/0?t:(t-n)*(i-e)/(r-n)+e}},function(t,n,r){"use strict";var h=r(10),v=r(74),p=r(127),d=r(117),y=r(17),g=r(116),i=Object.assign;t.exports=!i||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=i({},t)[r]||Object.keys(i({},n)).join("")!=e})?function(t,n){for(var r=y(t),e=arguments.length,i=1,o=p.f,u=d.f;i<e;)for(var c,f=g(arguments[i++]),a=o?v(f).concat(o(f)):v(f),s=a.length,l=0;l<s;)c=a[l++],h&&!u.call(f,c)||(r[c]=f[c]);return r}:i},function(t,n,r){var u=r(11),c=r(2),f=r(74);t.exports=r(10)?Object.defineProperties:function(t,n){c(t);for(var r,e=f(n),i=e.length,o=0;o<i;)u.f(t,r=e[o++],n[r]);return t}},function(t,n,r){var e=r(33),i=r(73).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?function(t){try{return i(t)}catch(t){return u.slice()}}(t):i(e(t))}},function(t,n,r){var u=r(30),c=r(33),f=r(120)(!1),a=r(154)("IE_PROTO");t.exports=function(t,n){var r,e=c(t),i=0,o=[];for(r in e)r!=a&&u(e,r)&&o.push(r);for(;n.length>i;)u(e,r=n[i++])&&(~f(o,r)||o.push(r));return o}},function(t,n,r){var f=r(10),a=r(74),s=r(33),l=r(117).f;t.exports=function(c){return function(t){for(var n,r=s(t),e=a(r),i=e.length,o=0,u=[];o<i;)n=e[o++],f&&!l.call(r,n)||u.push(c?[n,r[n]]:r[n]);return u}}},function(t,n,r){var e=r(73),i=r(127),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(84).trim;t.exports=1/e(r(157)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(84).trim,o=r(157),u=/^[-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,n,r){var e=r(2),i=r(5),o=r(151);t.exports=function(t,n){if(e(t),i(n)&&n.constructor===t)return n;var r=o.f(t);return(0,r.resolve)(n),r.promise}},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var s=r(8),l=r(156),h=r(51);t.exports=function(t,n,r,e){var i=String(h(t)),o=i.length,u=void 0===r?" ":String(r),c=s(n);if(c<=o||""==u)return i;var f=c-o,a=l.call(u,Math.ceil(f/u.length));return a.length>f&&(a=a.slice(0,f)),e?a+i:i+a}},function(t,n,r){var e=r(49),i=r(8);t.exports=function(t){if(void 0===t)return 0;var n=e(t),r=i(n);if(n!==r)throw RangeError("Wrong length!");return r}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(170),i=r(80);t.exports=r(121)("Map",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(i(this,"Map"),t);return n&&n.v},set:function(t,n){return e.def(i(this,"Map"),0===t?0:t,n)}},e,!0)},function(t,n,r){"use strict";var e=r(152);r(1)({target:"RegExp",proto:!0,forced:e!==/./.exec},{exec:e})},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(115)})},function(t,n,r){"use strict";var e=r(170),i=r(80);t.exports=r(121)("Set",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return e.def(i(this,"Set"),t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var o,e=r(3),i=r(50)(0),u=r(27),c=r(69),f=r(182),a=r(172),s=r(5),l=r(80),h=r(80),v=!e.ActiveXObject&&"ActiveXObject"in e,p="WeakMap",d=c.getWeak,y=Object.isExtensible,g=a.ufstore,b=function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},x={get:function(t){if(s(t)){var n=d(t);return!0===n?g(l(this,p)).get(t):n?n[this._i]:void 0}},set:function(t,n){return a.def(l(this,p),t,n)}},m=t.exports=r(121)(p,b,x,a,!0,!0);h&&v&&(f((o=a.getConstructor(b,p)).prototype,x),c.NEED=!0,i(["delete","has","get","set"],function(e){var t=m.prototype,i=t[e];u(t,e,function(t,n){if(!s(t)||y(t))return i.call(this,t,n);this._f||(this._f=new o);var r=this._f[e](t,n);return"set"==e?this:r})}))},,,,function(t,n){"use strict";t.exports={init:function(){var t=document.querySelector("#page-nav");t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new&&document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")}),yiliaConfig&&yiliaConfig.toc_hide_index&&document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n,r,e,i){var o=function(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}(t),u=function(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}(t)-n;if(u-r<=i){var c=t.$newDom;c||(c=t.cloneNode(!0),(0,a.default)(t,c),(t.$newDom=c).style.position="fixed",c.style.top=(r||u)+"px",c.style.left=o+"px",c.style.zIndex=e||2,c.style.width="100%",c.style.color="#fff"),c.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var f=t.$newDom;f&&(f.style.visibility="hidden")}}function o(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");i(t,document.body.scrollTop,-63,2,0),i(n,document.body.scrollTop,1,3,0)}var f=e(r(163)),a=e((e(r(164)),r(414))),u=e(r(134)),c=e(r(204)),s=r(135);u.default.versions.mobile&&window.screen.width<800&&(function(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var i=t[r];o=n,u=i.getAttribute("href"),c=/\/|index.html/g,o.replace(c,"")===u.replace(c,"")&&(0,f.default)(i,"active")}var o,u,c}(),document.querySelector("#container").addEventListener("scroll",function(t){o()}),window.addEventListener("scroll",function(t){o()}),o()),(0,s.addLoadEvent)(function(){c.default.init()}),t.exports={}},,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object.defineProperty(t,n,{writable:!0,configurable:!0,value:r})}if(r(413),r(209),r(211),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},function(L,t){(function(t){!function(t){"use strict";function o(t,n,r,e){var o,u,c,f,i=n&&n.prototype instanceof h?n:h,a=Object.create(i.prototype),s=new p(e||[]);return a._invoke=(o=t,u=r,c=s,f=_,function(t,n){if(f===E)throw new Error("Generator is already running");if(f===M){if("throw"===t)throw n;return d()}for(c.method=t,c.arg=n;;){var r=c.delegate;if(r){var e=v(r,c);if(e){if(e===P)continue;return e}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(f===_)throw f=M,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);f=E;var i=l(o,u,c);if("normal"===i.type){if(f=c.done?M:O,i.arg===P)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(f=M,c.method="throw",c.arg=i.arg)}}),a}function l(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function h(){}function r(){}function n(){}function e(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function u(c){function f(t,n,r,e){var i=l(c[t],c,n);if("throw"!==i.type){var o=i.arg,u=o.value;return u&&"object"==typeof u&&y.call(u,"__await")?Promise.resolve(u.__await).then(function(t){f("next",t,r,e)},function(t){f("throw",t,r,e)}):Promise.resolve(u).then(function(t){o.value=t,r(o)},e)}e(i.arg)}var n;"object"==typeof t.process&&t.process.domain&&(f=t.process.domain.bind(f)),this._invoke=function(r,e){function t(){return new Promise(function(t,n){f(r,e,t,n)})}return n=n?n.then(t,t):t()}}function v(t,n){var r=t.iterator[n.method];if(r===a){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=a,v(t,n),"throw"===n.method))return P;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return P}var e=l(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,P;var i=e.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=a),n.delegate=null,P):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,P)}function i(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function c(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(i,this),this.reset(!0)}function f(n){if(n){var t=n[b];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var r=-1,e=function t(){for(;++r<n.length;)if(y.call(n,r))return t.value=n[r],t.done=!1,t;return t.value=a,t.done=!0,t};return e.next=e}}return{next:d}}function d(){return{value:a,done:!0}}var a,s=Object.prototype,y=s.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},b=g.iterator||"@@iterator",x=g.asyncIterator||"@@asyncIterator",m=g.toStringTag||"@@toStringTag",S="object"==typeof L,w=t.regeneratorRuntime;if(w)S&&(L.exports=w);else{(w=t.regeneratorRuntime=S?L.exports:{}).wrap=o;var _="suspendedStart",O="suspendedYield",E="executing",M="completed",P={},j={};j[b]=function(){return this};var F=Object.getPrototypeOf,A=F&&F(F(f([])));A&&A!==s&&y.call(A,b)&&(j=A);var I=n.prototype=h.prototype=Object.create(j);r.prototype=I.constructor=n,n.constructor=r,n[m]=r.displayName="GeneratorFunction",w.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===r||"GeneratorFunction"===(n.displayName||n.name))},w.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,n):(t.__proto__=n,m in t||(t[m]="GeneratorFunction")),t.prototype=Object.create(I),t},w.awrap=function(t){return{__await:t}},e(u.prototype),u.prototype[x]=function(){return this},w.AsyncIterator=u,w.async=function(t,n,r,e){var i=new u(o(t,n,r,e));return w.isGeneratorFunction(n)?i:i.next().then(function(t){return t.done?t.value:i.next()})},e(I),I[m]="Generator",I[b]=function(){return this},I.toString=function(){return"[object Generator]"},w.keys=function(r){var e=[];for(var t in r)e.push(t);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},w.values=f,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(c),!t)for(var n in this)"t"===n.charAt(0)&&y.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=a)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){function t(t,n){return o.type="throw",o.arg=r,e.next=t,n&&(e.method="next",e.arg=a),!!n}if(this.done)throw r;for(var e=this,n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var u=y.call(i,"catchLoc"),c=y.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;0<=r;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&y.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,P):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),P},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),c(r),P}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;c(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:f(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=a),P}}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,function(){return this}())},,function(t,n,r){r(221),t.exports=r(46).RegExp.escape},,,,function(t,n,r){var e=r(5),i=r(123),o=r(7)("species");t.exports=function(t){var n;return i(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&(null===(n=n[o])&&(n=void 0))),void 0===n?Array:n}},function(t,n,r){"use strict";var e=r(4),i=Date.prototype.getTime,o=Date.prototype.toISOString,u=function(t){return 9<t?t:"0"+t};t.exports=e(function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-5e13-1))})||!e(function(){o.call(new Date(NaN))})?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":9999<n?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(99<r?r:"0"+u(r))+"Z"}:o},function(t,n,r){"use strict";var e=r(2),i=r(53);t.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),"number"!=t)}},function(t,n,r){var c=r(74),f=r(127),a=r(117);t.exports=function(t){var n=c(t),r=f.f;if(r)for(var e,i=r(t),o=a.f,u=0;i.length>u;)o.call(t,e=i[u++])&&n.push(e);return n}},function(t,n,r){t.exports=r(118)("native-function-to-string",Function.toString)},function(t,n){t.exports=function(n,r){var e=r===Object(r)?function(t){return r[t]}:r;return function(t){return String(t).replace(n,e)}}},function(t,n,r){var e=r(1),i=r(220)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(166)}),r(67)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(50)(4);e(e.P+e.F*!r(48)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(137)}),r(67)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(50)(2);e(e.P+e.F*!r(48)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)(o)},function(t,n,r){"use strict";var e=r(1),i=r(50)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)(o)},function(t,n,r){"use strict";var e=r(1),i=r(50)(0),o=r(48)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var h=r(47),e=r(1),v=r(17),p=r(177),d=r(145),y=r(8),g=r(139),b=r(161);e(e.S+e.F*!r(125)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,e,i,o=v(t),u="function"==typeof this?this:Array,c=arguments.length,f=1<c?arguments[1]:void 0,a=void 0!==f,s=0,l=b(o);if(a&&(f=h(f,2<c?arguments[2]:void 0,2)),null==l||u==Array&&d(l))for(r=new u(n=y(o.length));s<n;s++)g(r,s,a?f(o[s],s):o[s]);else for(i=l.call(o),r=new u;!(e=i.next()).done;s++)g(r,s,a?p(i,f,[e.value,s],!0):e.value);return r.length=s,r}})},function(t,n,r){"use strict";var e=r(1),i=r(120)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(48)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(123)})},function(t,n,r){"use strict";var e=r(1),i=r(33),o=[].join;e(e.P+e.F*(r(116)!=Object||!r(48)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(33),o=r(49),u=r(8),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(48)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(1<arguments.length&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);0<=e;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(1);e(e.P+e.F*!r(48)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(139);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);t<n;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(168);e(e.P+e.F*!r(48)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(168);e(e.P+e.F*!r(48)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(143),a=r(45),s=r(78),l=r(8),h=[].slice;e(e.P+e.F*r(4)(function(){i&&h.call(i)}),"Array",{slice:function(t,n){var r=l(this.length),e=a(this);if(n=void 0===n?r:n,"Array"==e)return h.call(this,t,n);for(var i=s(t,r),o=s(n,r),u=l(o-i),c=new Array(u),f=0;f<u;f++)c[f]="String"==e?this.charAt(i+f):this[i+f];return c}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(3);e(e.P+e.F*!r(48)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(21),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(48)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(77)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){var e=r(1),i=r(216);e(e.P+e.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(26)(i,e,r(217))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(27)(e,o,function(){var t=c.call(this);return t==t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(169)})},function(t,n,r){"use strict";var e=r(5),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||r(10)&&e(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(180),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:94906265.62425156<t?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){var e=r(1),i=Math.asinh;e(e.S+e.F*!(i&&0<1/i(0)),"Math",{asinh:function t(n){return isFinite(n=+n)&&0!=n?n<0?-t(-n):Math.log(n+Math.sqrt(n*n+1)):n}})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(149);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(148);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1);e(e.S,"Math",{fround:r(179)})},function(t,n,r){var e=r(1),f=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,i=0,o=0,u=arguments.length,c=0;o<u;)c<(r=f(arguments[o++]))?(i=i*(e=c/r)*e+1,c=r):0<r?i+=(e=r/c)*e:i+=r;return c===1/0?1/0:c*Math.sqrt(i)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(180)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(149)})},function(t,n,r){var e=r(1),i=r(148),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(148),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(0<t?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(30),o=r(45),u=r(144),s=r(53),c=r(4),f=r(73).f,a=r(31).f,l=r(11).f,h=r(84).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(72)(y))==v,b="trim"in String.prototype,x=function(t){var n=s(t,!1);if("string"==typeof n&&2<n.length){var r,e,i,o=(n=b?n.trim():h(n,3)).charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,c=n.slice(2),f=0,a=c.length;f<a;f++)if((u=c.charCodeAt(f))<48||i<u)return NaN;return parseInt(c,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?c(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(x(n)),r,p):x(n)};for(var m,S=r(10)?f(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;S.length>w;w++)i(d,m=S[w])&&!i(p,m)&&l(p,m,a(d,m));(p.prototype=y).constructor=p,r(27)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(176)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(176),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(188);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(189);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),a=r(49),s=r(165),l=r(156),i=1..toFixed,o=Math.floor,u=[0,0,0,0,0,0],h="Number.toFixed: incorrect invocation!",v=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*u[r],u[r]=e%1e7,e=o(e/1e7)},p=function(t){for(var n=6,r=0;0<=--n;)r+=u[n],u[n]=o(r/t),r=r%t*1e7},d=function(){for(var t=6,n="";0<=--t;)if(""!==n||0===t||0!==u[t]){var r=String(u[t]);n=""===n?r:n+l.call("0",7-r.length)+r}return n},y=function(t,n,r){return 0===n?r:n%2==1?y(t,n-1,r*t):y(t*t,n/2,r)};e(e.P+e.F*(!!i&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){i.call({})})),"Number",{toFixed:function(t){var n,r,e,i,o=s(this,h),u=a(t),c="",f="0";if(u<0||20<u)throw RangeError(h);if(o!=o)return"NaN";if(o<=-1e21||1e21<=o)return String(o);if(o<0&&(c="-",o=-o),1e-21<o)if(r=(n=function(t){for(var n=0,r=t;4096<=r;)n+=12,r/=4096;for(;2<=r;)n+=1,r/=2;return n}(o*y(2,69,1))-69)<0?o*y(2,-n,1):o/y(2,n,1),r*=4503599627370496,0<(n=52-n)){for(v(0,r),e=u;7<=e;)v(1e7,0),e-=7;for(v(y(10,e,1),0),e=n-1;23<=e;)p(1<<23),e-=23;p(1<<e),v(1,1),p(2),f=d()}else v(0,r),v(1<<-n,0),f=d()+l.call("0",u);return f=0<u?c+((i=f.length)<=u?"0."+l.call("0",u-i)+f:f.slice(0,i-u)+"."+f.slice(i-u)):c+f}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(165),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(182)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(72)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(183)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("freeze",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(33),i=r(31).f;r(52)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(52)("getOwnPropertyNames",function(){return r(184).f})},function(t,n,r){var e=r(17),i=r(32);r(52)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(5);r(52)("isExtensible",function(n){return function(t){return!!e(t)&&(!n||n(t))}})},function(t,n,r){var e=r(5);r(52)("isFrozen",function(n){return function(t){return!e(t)||!!n&&n(t)}})},function(t,n,r){var e=r(5);r(52)("isSealed",function(n){return function(t){return!e(t)||!!n&&n(t)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(192)})},function(t,n,r){var e=r(17),i=r(74);r(52)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("preventExtensions",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("seal",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(153).set})},function(t,n,r){"use strict";var e=r(81),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(27)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(188);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(189);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u,c=r(68),f=r(3),a=r(47),s=r(81),l=r(1),h=r(5),v=r(21),p=r(70),d=r(71),y=r(119),g=r(158).set,b=r(150)(),x=r(151),m=r(190),S=r(133),w=r(191),_="Promise",O=f.TypeError,E=f.process,M=E&&E.versions,P=M&&M.v8||"",j=f[_],F="process"==s(E),A=function(){},I=i=x.f,L=!!function(){try{var t=j.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(A,A)};return(F||"function"==typeof PromiseRejectionEvent)&&t.then(A)instanceof n&&0!==P.indexOf("6.6")&&-1===S.indexOf("Chrome/66")}catch(t){}}(),N=function(t){var n;return!(!h(t)||"function"!=typeof(n=t.then))&&n},T=function(s,r){if(!s._n){s._n=!0;var e=s._c;b(function(){for(var f=s._v,a=1==s._s,t=0,n=function(t){var n,r,e,i=a?t.ok:t.fail,o=t.resolve,u=t.reject,c=t.domain;try{i?(a||(2==s._h&&C(s),s._h=1),!0===i?n=f:(c&&c.enter(),n=i(f),c&&(c.exit(),e=!0)),n===t.promise?u(O("Promise-chain cycle")):(r=N(n))?r.call(n,o,u):o(n)):u(f)}catch(t){c&&!e&&c.exit(),u(t)}};e.length>t;)n(e[t++]);s._c=[],s._n=!1,r&&!s._h&&k(s)})}},k=function(o){g.call(f,function(){var t,n,r,e=o._v,i=R(o);if(i&&(t=m(function(){F?E.emit("unhandledRejection",e,o):(n=f.onunhandledrejection)?n({promise:o,reason:e}):(r=f.console)&&r.error&&r.error("Unhandled promise rejection",e)}),o._h=F||R(o)?2:1),o._a=void 0,i&&t.e)throw t.v})},R=function(t){return 1!==t._h&&0===(t._a||t._c).length},C=function(n){g.call(f,function(){var t;F?E.emit("rejectionHandled",n):(t=f.onrejectionhandled)&&t({promise:n,reason:n._v})})},D=function(t){var n=this;n._d||(n._d=!0,(n=n._w||n)._v=t,n._s=2,n._a||(n._a=n._c.slice()),T(n,!0))},G=function(t){var r,e=this;if(!e._d){e._d=!0,e=e._w||e;try{if(e===t)throw O("Promise can't be resolved itself");(r=N(t))?b(function(){var n={_w:e,_d:!1};try{r.call(t,a(G,n,1),a(D,n,1))}catch(t){D.call(n,t)}}):(e._v=t,e._s=1,T(e,!1))}catch(t){D.call({_w:e,_d:!1},t)}}};L||(j=function(t){p(this,j,_,"_h"),v(t),e.call(this);try{t(a(G,this,1),a(D,this,1))}catch(t){D.call(this,t)}},(e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(76)(j.prototype,{then:function(t,n){var r=I(y(this,j));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=F?E.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&T(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new e;this.promise=t,this.resolve=a(G,t,1),this.reject=a(D,t,1)},x.f=I=function(t){return t===j||t===u?new o(t):i(t)}),l(l.G+l.W+l.F*!L,{Promise:j}),r(83)(j,_),r(77)(_),u=r(46)[_],l(l.S+l.F*!L,_,{reject:function(t){var n=I(this);return(0,n.reject)(t),n.promise}}),l(l.S+l.F*(c||!L),_,{resolve:function(t){return w(c&&this===u?j:this,t)}}),l(l.S+l.F*!(L&&r(125)(function(t){j.all(t).catch(A)})),_,{all:function(t){var u=this,n=I(u),c=n.resolve,f=n.reject,r=m(function(){var e=[],i=0,o=1;d(t,!1,function(t){var n=i++,r=!1;e.push(void 0),o++,u.resolve(t).then(function(t){r||(r=!0,e[n]=t,--o||c(e))},f)}),--o||c(e)});return r.e&&f(r.v),n.promise},race:function(t){var n=this,r=I(n),e=r.reject,i=m(function(){d(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i.e&&e(i.v),r.promise}})},function(t,n,r){var e=r(1),o=r(21),u=r(2),c=(r(3).Reflect||{}).apply,f=Function.apply;e(e.S+e.F*!r(4)(function(){c(function(){})}),"Reflect",{apply:function(t,n,r){var e=o(t),i=u(r);return c?c(e,n,i):f.call(e,n,i)}})},function(t,n,r){var e=r(1),c=r(72),f=r(21),a=r(2),s=r(5),i=r(4),l=r(169),h=(r(3).Reflect||{}).construct,v=i(function(){function t(){}return!(h(function(){},[],t)instanceof t)}),p=!i(function(){h(function(){})});e(e.S+e.F*(v||p),"Reflect",{construct:function(t,n){f(t),a(n);var r=arguments.length<3?t:f(arguments[2]);if(p&&!v)return h(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(l.apply(t,e))}var i=r.prototype,o=c(s(i)?i:Object.prototype),u=Function.apply.call(t,o,n);return s(u)?u:o}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(53);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(146)(o,"Object",function(){var t,n=this._k;do{if(this._i>=n.length)return{value:void 0,done:!0}}while(!((t=n[this._i++])in this._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){var u=r(31),c=r(32),f=r(30),e=r(1),a=r(5),s=r(2);e(e.S,"Reflect",{get:function t(n,r){var e,i,o=arguments.length<3?n:arguments[2];return s(n)===o?n[r]:(e=u.f(n,r))?f(e,"value")?e.value:void 0!==e.get?e.get.call(o):void 0:a(i=c(n))?t(i,r,o):void 0}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(187)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(153);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){var f=r(11),a=r(31),s=r(32),l=r(30),e=r(1),h=r(75),v=r(2),p=r(5);e(e.S,"Reflect",{set:function t(n,r,e){var i,o,u=arguments.length<4?n:arguments[3],c=a.f(v(n),r);if(!c){if(p(o=s(n)))return t(o,r,e,u);c=h(0)}if(l(c,"value")){if(!1===c.writable||!p(u))return!1;if(i=a.f(u,r)){if(i.get||i.set||!1===i.writable)return!1;i.value=e,f.f(u,r,i)}else f.f(u,r,h(0,e));return!0}return void 0!==c.set&&(c.set.call(u,e),!0)}})},function(t,n,r){var e=r(3),o=r(144),i=r(11).f,u=r(73).f,c=r(124),f=r(115),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),i=void 0===n;return!r&&e&&t.constructor===a&&i?t:o(p?new s(e&&!i?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&i?f.call(t):n),r?this:l,a)};for(var d=function(n){n in a||i(a,n,{configurable:!0,get:function(){return s[n]},set:function(t){s[n]=t}})},y=u(s),g=0;y.length>g;)d(y[g++]);(l.constructor=a).prototype=l,r(27)(e,"RegExp",a)}r(77)("RegExp")},function(t,n,r){"use strict";var l=r(2),h=r(8),v=r(136),p=r(128);r(122)("match",1,function(e,i,a,s){return[function(t){var n=e(this),r=null==t?void 0:t[i];return void 0!==r?r.call(t,n):new RegExp(t)[i](String(n))},function(t){var n=s(a,t,this);if(n.done)return n.value;var r=l(t),e=String(this);if(!r.global)return p(r,e);for(var i,o=r.unicode,u=[],c=r.lastIndex=0;null!==(i=p(r,e));){var f=String(i[0]);""===(u[c]=f)&&(r.lastIndex=v(e,h(r.lastIndex),o)),c++}return 0===c?null:u}]})},function(t,n,r){"use strict";var O=r(2),e=r(17),E=r(8),M=r(49),P=r(136),j=r(128),F=Math.max,A=Math.min,h=Math.floor,v=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;r(122)("replace",2,function(i,o,S,w){function _(o,u,c,f,a,t){var s=c+o.length,l=f.length,n=p;return void 0!==a&&(a=e(a),n=v),S.call(t,n,function(t,n){var r;switch(n.charAt(0)){case"$":return"$";case"&":return o;case"`":return u.slice(0,c);case"'":return u.slice(s);case"<":r=a[n.slice(1,-1)];break;default:var e=+n;if(0===e)return t;if(l<e){var i=h(e/10);return 0===i?t:i<=l?void 0===f[i-1]?n.charAt(1):f[i-1]+n.charAt(1):t}r=f[e-1]}return void 0===r?"":r})}return[function(t,n){var r=i(this),e=null==t?void 0:t[o];return void 0!==e?e.call(t,r,n):S.call(String(r),t,n)},function(t,n){var r=w(S,t,this,n);if(r.done)return r.value;var e=O(t),i=String(this),o="function"==typeof n;o||(n=String(n));var u,c=e.global;if(c){var f=e.unicode;e.lastIndex=0}for(var a=[];;){var s=j(e,i);if(null===s)break;if(a.push(s),!c)break;""===String(s[0])&&(e.lastIndex=P(i,E(e.lastIndex),f))}for(var l="",h=0,v=0;v<a.length;v++){s=a[v];for(var p=String(s[0]),d=F(A(M(s.index),i.length),0),y=[],g=1;g<s.length;g++)y.push(void 0===(u=s[g])?u:String(u));var b=s.groups;if(o){var x=[p].concat(y,d,i);void 0!==b&&x.push(b);var m=String(n.apply(void 0,x))}else m=_(p,i,d,y,b,n);h<=d&&(l+=i.slice(h,d)+m,h=d+p.length)}return l+i.slice(h)}]})},function(t,n,r){"use strict";var f=r(2),a=r(192),s=r(128);r(122)("search",1,function(e,i,u,c){return[function(t){var n=e(this),r=null==t?void 0:t[i];return void 0!==r?r.call(t,n):new RegExp(t)[i](String(n))},function(t){var n=c(u,t,this);if(n.done)return n.value;var r=f(t),e=String(this),i=r.lastIndex;a(i,0)||(r.lastIndex=0);var o=s(r,e);return a(r.lastIndex,i)||(r.lastIndex=i),null===o?-1:o.index}]})},function(t,n,r){"use strict";var l=r(124),x=r(2),m=r(119),S=r(136),w=r(8),_=r(128),h=r(152),e=r(4),O=Math.min,v=[].push,u="split",p="length",d="lastIndex",E=4294967295,M=!e(function(){RegExp(E,"y")});r(122)("split",2,function(i,o,y,g){var b;return b="c"=="abbc"[u](/(b)*/)[1]||4!="test"[u](/(?:)/,-1)[p]||2!="ab"[u](/(?:ab)*/)[p]||4!="."[u](/(.?)(.?)/)[p]||1<"."[u](/()()/)[p]||""[u](/.?/)[p]?function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!l(t))return y.call(r,t,n);for(var e,i,o,u=[],c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),f=0,a=void 0===n?E:n>>>0,s=new RegExp(t.source,c+"g");(e=h.call(s,r))&&!(f<(i=s[d])&&(u.push(r.slice(f,e.index)),1<e[p]&&e.index<r[p]&&v.apply(u,e.slice(1)),o=e[0][p],f=i,u[p]>=a));)s[d]===e.index&&s[d]++;return f===r[p]?!o&&s.test("")||u.push(""):u.push(r.slice(f)),u[p]>a?u.slice(0,a):u}:"0"[u](void 0,0)[p]?function(t,n){return void 0===t&&0===n?[]:y.call(this,t,n)}:y,[function(t,n){var r=i(this),e=null==t?void 0:t[o];return void 0!==e?e.call(t,r,n):b.call(String(r),t,n)},function(t,n){var r=g(b,t,this,n,b!==y);if(r.done)return r.value;var e=x(t),i=String(this),o=m(e,RegExp),u=e.unicode,c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(M?"y":"g"),f=new o(M?e:"^(?:"+e.source+")",c),a=void 0===n?E:n>>>0;if(0===a)return[];if(0===i.length)return null===_(f,i)?[i]:[];for(var s=0,l=0,h=[];l<i.length;){f.lastIndex=M?l:0;var v,p=_(f,M?i:i.slice(l));if(null===p||(v=O(w(f.lastIndex+(M?0:l)),i.length))===s)l=S(i,l,u);else{if(h.push(i.slice(s,l)),h.length===a)return h;for(var d=1;d<=p.length-1;d++)if(h.push(p[d]),h.length===a)return h;l=s=v}}return h.push(i.slice(s)),h}]})},function(t,n,r){"use strict";r(198);var e=r(2),i=r(115),o=r(10),u="toString",c=/./[u],f=function(t){r(27)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(28)("anchor",function(n){return function(t){return n(this,"a","name",t)}})},function(t,n,r){"use strict";r(28)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(28)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(28)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(131)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),u=r(8),c=r(155),f="endsWith",a=""[f];e(e.P+e.F*r(142)(f),"String",{endsWith:function(t){var n=c(this,t,f),r=1<arguments.length?arguments[1]:void 0,e=u(n.length),i=void 0===r?e:Math.min(u(r),e),o=String(t);return a?a.call(n,o,i):n.slice(i-o.length,i)===o}})},function(t,n,r){"use strict";r(28)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(28)("fontcolor",function(n){return function(t){return n(this,"font","color",t)}})},function(t,n,r){"use strict";r(28)("fontsize",function(n){return function(t){return n(this,"font","size",t)}})},function(t,n,r){var e=r(1),o=r(78),u=String.fromCharCode,i=String.fromCodePoint;e(e.S+e.F*(!!i&&1!=i.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,i=0;i<e;){if(n=+arguments[i++],o(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?u(n):u(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(155);e(e.P+e.F*r(142)("includes"),"String",{includes:function(t){return!!~i(this,t,"includes").indexOf(t,1<arguments.length?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(28)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(131)(!0);r(147)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(28)("link",function(n){return function(t){return n(this,"a","href",t)}})},function(t,n,r){var e=r(1),u=r(33),c=r(8);e(e.S,"String",{raw:function(t){for(var n=u(t.raw),r=c(n.length),e=arguments.length,i=[],o=0;o<r;)i.push(String(n[o++])),o<e&&i.push(String(arguments[o]));return i.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(156)})},function(t,n,r){"use strict";r(28)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(8),o=r(155),u="startsWith",c=""[u];e(e.P+e.F*r(142)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(1<arguments.length?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(28)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(28)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(28)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(84)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),u=r(30),i=r(10),o=r(1),c=r(27),f=r(69).KEY,a=r(4),s=r(118),l=r(83),h=r(79),v=r(7),p=r(195),d=r(160),y=r(218),g=r(123),b=r(2),x=r(5),m=r(17),S=r(33),w=r(53),_=r(75),O=r(72),E=r(184),M=r(31),P=r(127),j=r(11),F=r(74),A=M.f,I=j.f,L=E.f,N=e.Symbol,T=e.JSON,k=T&&T.stringify,R="prototype",C=v("_hidden"),D=v("toPrimitive"),G={}.propertyIsEnumerable,W=s("symbol-registry"),U=s("symbols"),V=s("op-symbols"),B=Object[R],q="function"==typeof N&&!!P.f,z=e.QObject,K=!z||!z[R]||!z[R].findChild,H=i&&a(function(){return 7!=O(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=A(B,n);e&&delete B[n],I(t,n,r),e&&t!==B&&I(B,n,e)}:I,J=function(t){var n=U[t]=O(N[R]);return n._k=t,n},$=q&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===B&&Y(V,n,r),b(t),n=w(n,!0),b(r),u(U,n)?(r.enumerable?(u(t,C)&&t[C][n]&&(t[C][n]=!1),r=O(r,{enumerable:_(0,!1)})):(u(t,C)||I(t,C,_(1,{})),t[C][n]=!0),H(t,n,r)):I(t,n,r)},X=function(t,n){b(t);for(var r,e=y(n=S(n)),i=0,o=e.length;i<o;)Y(t,r=e[i++],n[r]);return t},Q=function(t){var n=G.call(this,t=w(t,!0));return!(this===B&&u(U,t)&&!u(V,t))&&(!(n||!u(this,t)||!u(U,t)||u(this,C)&&this[C][t])||n)},Z=function(t,n){if(t=S(t),n=w(n,!0),t!==B||!u(U,n)||u(V,n)){var r=A(t,n);return!r||!u(U,n)||u(t,C)&&t[C][n]||(r.enumerable=!0),r}},tt=function(t){for(var n,r=L(S(t)),e=[],i=0;r.length>i;)u(U,n=r[i++])||n==C||n==f||e.push(n);return e},nt=function(t){for(var n,r=t===B,e=L(r?V:S(t)),i=[],o=0;e.length>o;)!u(U,n=e[o++])||r&&!u(B,n)||i.push(U[n]);return i};q||(c((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var n=h(0<arguments.length?arguments[0]:void 0),r=function(t){this===B&&r.call(V,t),u(this,C)&&u(this[C],n)&&(this[C][n]=!1),H(this,n,_(1,t))};return i&&K&&H(B,n,{configurable:!0,set:r}),J(n)})[R],"toString",function(){return this._k}),M.f=Z,j.f=Y,r(73).f=E.f=tt,r(117).f=Q,P.f=nt,i&&!r(68)&&c(B,"propertyIsEnumerable",Q,!0),p.f=function(t){return J(v(t))}),o(o.G+o.W+o.F*!q,{Symbol:N});for(var rt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;rt.length>et;)v(rt[et++]);for(var it=F(v.store),ot=0;it.length>ot;)d(it[ot++]);o(o.S+o.F*!q,"Symbol",{for:function(t){return u(W,t+="")?W[t]:W[t]=N(t)},keyFor:function(t){if(!$(t))throw TypeError(t+" is not a symbol!");for(var n in W)if(W[n]===t)return n},useSetter:function(){K=!0},useSimple:function(){K=!1}}),o(o.S+o.F*!q,"Object",{create:function(t,n){return void 0===n?O(t):X(O(t),n)},defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:tt,getOwnPropertySymbols:nt});var ut=a(function(){P.f(1)});o(o.S+o.F*ut,"Object",{getOwnPropertySymbols:function(t){return P.f(m(t))}}),T&&o(o.S+o.F*(!q||a(function(){var t=N();return"[null]"!=k([t])||"{}"!=k({a:t})||"{}"!=k(Object(t))})),"JSON",{stringify:function(t){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);if(r=n=e[1],(x(n)||void 0!==t)&&!$(t))return g(n)||(n=function(t,n){if("function"==typeof r&&(n=r.call(this,t,n)),!$(n))return n}),e[1]=n,k.apply(T,e)}}),N[R][D]||r(26)(N[R],D,N[R].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(132),o=r(159),a=r(2),s=r(78),l=r(8),u=r(5),c=r(3).ArrayBuffer,h=r(119),v=o.ArrayBuffer,p=o.DataView,f=i.ABV&&c.isView,d=v.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(c!==v),{ArrayBuffer:v}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return f&&f(t)||u(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new v(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(a(this),t);for(var r=a(this).byteLength,e=s(t,r),i=s(void 0===n?r:n,r),o=new(h(this,v))(l(i-e)),u=new p(this),c=new p(o),f=0;e<i;)c.setUint8(f++,u.getUint8(e++));return o}}),r(77)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(132).ABV,{DataView:r(159).DataView})},function(t,n,r){r(57)("Float32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Float64",8,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}},!0)},function(t,n,r){"use strict";var e=r(172),i=r(80);r(121)("WeakSet",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return e.def(i(this,"WeakSet"),t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(173),o=r(17),u=r(8),c=r(21),f=r(138);e(e.P,"Array",{flatMap:function(t){var n,r,e=o(this);return c(t),n=u(e.length),r=f(e,0),i(r,e,e,n,0,1,t,arguments[1]),r}}),r(67)("flatMap")},function(t,n,r){"use strict";var e=r(1),i=r(173),o=r(17),u=r(8),c=r(49),f=r(138);e(e.P,"Array",{flatten:function(){var t=arguments[0],n=o(this),r=u(n.length),e=f(n,0);return i(e,n,n,r,0,void 0===t?1:c(t)),e}}),r(67)("flatten")},function(t,n,r){"use strict";var e=r(1),i=r(120)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)("includes")},function(t,n,r){var e=r(1),i=r(150)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.G,{global:r(3)})},function(t,n,r){r(129)("Map")},function(t,n,r){r(130)("Map")},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(171)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{clamp:function(t,n,r){return Math.min(r,Math.max(n,t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(t,n,r){var e=r(1),i=180/Math.PI;e(e.S,"Math",{degrees:function(t){return t*i}})},function(t,n,r){var e=r(1),o=r(181),u=r(179);e(e.S,"Math",{fscale:function(t,n,r,e,i){return u(o(t,n,r,e,i))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=r>>>0;return(n>>>0)+(e>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=+t,e=+n,i=65535&r,o=65535&e,u=r>>16,c=e>>16,f=(u*o>>>0)+(i*o>>>16);return u*c+(f>>16)+((i*c>>>0)+(65535&f)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=r>>>0;return(n>>>0)-(e>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(t,n,r){var e=r(1),i=Math.PI/180;e(e.S,"Math",{radians:function(t){return t*i}})},function(t,n,r){var e=r(1);e(e.S,"Math",{scale:r(181)})},function(t,n,r){var e=r(1);e(e.S,"Math",{signbit:function(t){return(t=+t)!=t?t:0==t?1/t==1/0:0<t}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=+t,e=+n,i=65535&r,o=65535&e,u=r>>>16,c=e>>>16,f=(u*o>>>0)+(i*o>>>16);return u*c+(f>>>16)+((i*c>>>0)+(65535&f)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(21),u=r(11);r(10)&&e(e.P+r(126),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(21),u=r(11);r(10)&&e(e.P+r(126),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(186)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),f=r(187),a=r(33),s=r(31),l=r(139);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r,e=a(t),i=s.f,o=f(e),u={},c=0;o.length>c;)void 0!==(r=i(e,n=o[c++]))&&l(u,n,r);return u}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53),u=r(32),c=r(31).f;r(10)&&e(e.P+r(126),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53),u=r(32),c=r(31).f;r(10)&&e(e.P+r(126),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(186)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),o=r(3),u=r(46),i=r(150)(),c=r(7)("observable"),f=r(21),a=r(2),s=r(70),l=r(76),h=r(26),v=r(71),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},x=function(t,n){a(t),this._c=void 0,this._o=t,t=new m(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};x.prototype=l({},{unsubscribe:function(){b(this)}});var m=function(t){this._s=t};m.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var S=function(t){s(this,S,"Observable","_f")._f=f(t)};l(S.prototype,{subscribe:function(t){return new x(t,this._f)},forEach:function(e){var i=this;return new(u.Promise||o.Promise)(function(t,n){f(e);var r=i.subscribe({next:function(t){try{return e(t)}catch(t){n(t),r.unsubscribe()}},error:n,complete:t})})}}),l(S,{from:function(t){var n="function"==typeof this?this:S,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return i(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,e=new Array(n);t<n;)e[t]=arguments[t++];return new("function"==typeof this?this:S)(function(n){var r=!1;return i(function(){if(!r){for(var t=0;t<e.length;++t)if(n.next(e[t]),r)return;n.complete()}}),function(){r=!0}})}}),h(S.prototype,c,function(){return this}),e(e.G,{Observable:S}),r(77)("Observable")},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(3),u=r(119),c=r(191);e(e.P+e.R,"Promise",{finally:function(n){var r=u(this,i.Promise||o.Promise),t="function"==typeof n;return this.then(t?function(t){return c(r,n()).then(function(){return t})}:n,t?function(t){return c(r,n()).then(function(){throw t})}:n)}})},function(t,n,r){"use strict";var e=r(1),i=r(151),o=r(190);e(e.S,"Promise",{try:function(t){var n=i.f(this),r=o(t);return(r.e?n.reject:n.resolve)(r.v),n.promise}})},function(t,n,r){var e=r(56),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(56),o=r(2),u=e.key,c=e.map,f=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:u(arguments[2]),e=c(o(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var i=f.get(n);return i.delete(r),!!i.size||f.delete(n)}})},function(t,n,r){var o=r(199),u=r(167),e=r(56),i=r(2),c=r(32),f=e.keys,a=e.key,s=function(t,n){var r=f(t,n),e=c(t);if(null===e)return r;var i=s(e,n);return i.length?r.length?u(new o(r.concat(i))):i:r};e.exp({getMetadataKeys:function(t){return s(i(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(21),u=e.key,c=e.set;e.exp({metadata:function(r,e){return function(t,n){c(r,e,(void 0!==n?i:o)(t),u(n))}}})},function(t,n,r){r(129)("Set")},function(t,n,r){r(130)("Set")},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(171)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(131)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(51),o=r(8),u=r(124),c=r(115),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(146)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(193),o=r(133),u=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);e(e.P+e.F*u,"String",{padEnd:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(193),o=r(133),u=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);e(e.P+e.F*u,"String",{padStart:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(84)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(84)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(160)("asyncIterator")},function(t,n,r){r(160)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){r(129)("WeakMap")},function(t,n,r){r(130)("WeakMap")},function(t,n,r){r(129)("WeakSet")},function(t,n,r){r(130)("WeakSet")},function(t,n,r){for(var e=r(162),i=r(74),o=r(27),u=r(3),c=r(26),f=r(82),a=r(7),s=a("iterator"),l=a("toStringTag"),h=f.Array,v={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(v),d=0;d<p.length;d++){var y,g=p[d],b=v[g],x=u[g],m=x&&x.prototype;if(m&&(m[s]||c(m,s,h),m[l]||c(m,l,g),f[g]=h,b))for(y in e)m[y]||o(m,y,e[y],!0)}},function(t,n,r){var e=r(1),i=r(158);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(133),u=[].slice,c=/MSIE .\./.test(o),f=function(i){return function(t,n){var r=2<arguments.length,e=!!r&&u.call(arguments,2);return i(r?function(){("function"==typeof t?t:Function(t)).apply(this,e)}:t,n)}};i(i.G+i.B+i.F*c,{setTimeout:f(e.setTimeout),setInterval:f(e.setInterval)})},function(t,n,r){r(341),r(280),r(282),r(281),r(284),r(286),r(291),r(285),r(283),r(293),r(292),r(288),r(289),r(287),r(279),r(290),r(294),r(295),r(247),r(249),r(248),r(297),r(296),r(267),r(277),r(278),r(268),r(269),r(270),r(271),r(272),r(273),r(274),r(275),r(276),r(250),r(251),r(252),r(253),r(254),r(255),r(256),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(266),r(328),r(333),r(340),r(331),r(323),r(324),r(329),r(334),r(336),r(319),r(320),r(321),r(322),r(325),r(326),r(327),r(330),r(332),r(335),r(337),r(338),r(339),r(242),r(244),r(243),r(246),r(245),r(231),r(229),r(235),r(232),r(238),r(240),r(228),r(234),r(225),r(239),r(223),r(237),r(236),r(230),r(233),r(222),r(224),r(227),r(226),r(241),r(162),r(313),r(197),r(318),r(198),r(314),r(315),r(316),r(317),r(298),r(196),r(199),r(200),r(353),r(342),r(343),r(348),r(351),r(352),r(346),r(349),r(347),r(350),r(344),r(345),r(299),r(300),r(301),r(302),r(303),r(306),r(304),r(305),r(307),r(308),r(309),r(310),r(312),r(311),r(356),r(354),r(355),r(397),r(400),r(399),r(401),r(402),r(398),r(403),r(404),r(378),r(381),r(377),r(375),r(376),r(379),r(380),r(362),r(396),r(361),r(395),r(407),r(409),r(360),r(394),r(406),r(408),r(359),r(405),r(358),r(363),r(364),r(365),r(366),r(367),r(369),r(368),r(370),r(371),r(372),r(374),r(373),r(383),r(384),r(385),r(386),r(388),r(387),r(390),r(389),r(391),r(392),r(393),r(357),r(382),r(412),r(411),r(410),t.exports=r(46)},function(t,n){t.exports=function(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}}])</script><script src="/./main.a5fda8.js"></script><script>!function(){var e,t;e="/slider.27463f.js",t=document.createElement("script"),document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}()</script>



<!--  -->

<script>
  /* 标签页标题切换 */
  var originTitle = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function () {
    if (document.hidden) {
      document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
      titleTime = setTimeout(function () {
        document.title = originTitle;
      }, 2000);
    }
  });
</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">基础环境，JDK，Hadoop，Zookeeper</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia-plus根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="https://zhousiwei.gitee.io/ibooks/" target="_blank" 
                class="search-title" title="记录工作和学习过程中的笔记：Java、前端开发、Hexo博客、聚合支付、Linux笔记、ElasticSearch、ELK日志分析">
                
                  <img src="https://zhousiwei.gitee.io/ibooks/favicon.ico">
                
                技术笔记
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://github.com/JoeyBling" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                GitHub
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://gitee.com/zhousiwei" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                码云
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://www.jianshu.com/u/02cbf31a043a" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                简书
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://blog.csdn.net/qq_30930805" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                CSDN
              </a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
        
          
  	  		<div class="aboutme-wrap" id="aboutme">主要涉及技术：<br>Java后端开发、聚合支付、<br>公众号开发、开源爱好者、Linux<br><br>联系QQ:2434387555<br><br>很惭愧<br><br>只做了一点微小的工作<br>谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>

  
  
<script type="text/javascript" src="/plugins/activate-power-mode/activate-power-mode.js"></script>
<script>
  POWERMODE.colorful = true; // make power mode colorful
  POWERMODE.shake = false; // turn off shake
  document.body.addEventListener('input', POWERMODE);
</script>

  
  <!-- <script async type="text/javascript" size="90" alpha="0.2" zIndex="0" src="/plugins/ribbon.js/ribbon.min.js"></script> -->
  
  
  
</body>

</html>
